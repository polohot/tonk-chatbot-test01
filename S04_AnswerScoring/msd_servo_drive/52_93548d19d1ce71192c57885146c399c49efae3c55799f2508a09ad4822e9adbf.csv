,NODE_FILE_NAME,NODE_NUMBER,NODE_HASH,NODE_TEXT,Q,A_NUMBER,A,helpfulness,correctness,coherence,complexity,verbosity
0,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the d and q current values of the LUT be accessed in the 'MSD ServoDrive - DeviceHelp'?,A1,"Access is via P 421 for table selection and indices, P 422 for d current (CON_FM_FWTabId), and P 423 for q current (CON_FM_FWTabIq).",2.5625,2.71875,3.71875,1.625,0.62109375
1,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the d and q current values of the LUT be accessed in the 'MSD ServoDrive - DeviceHelp'?,A2,"The document describes accessing LUT values through P 421 (selection/indices), P 422 (d current), and P 423 (q current).",1.859375,2.03125,3.515625,1.609375,0.55078125
2,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the d and q current values of the LUT be accessed in the 'MSD ServoDrive - DeviceHelp'?,A3,"Per 'MSD ServoDrive - DeviceHelp', P 421 controls access, P 422 holds d current, and P 423 contains q current values.",1.375,1.546875,3.40625,1.2890625,0.50390625
3,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the d and q current values of the LUT be accessed in the 'MSD ServoDrive - DeviceHelp'?,A4,"LUT values are accessed via P 421's selection and indices, with d and q currents in P 422 and P 423, respectively, as detailed in the document.",2.28125,2.546875,3.609375,1.6640625,0.67578125
4,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the d and q current values of the LUT be accessed in the 'MSD ServoDrive - DeviceHelp'?,A5,"The document outlines accessing LUT's d and q currents through P 422 and P 423, with P 421 managing selection and indices.",1.5859375,1.7578125,3.40625,1.5234375,0.490234375
5,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the large LookUp Table (LUT) be saved to ROM according to the 'MSD ServoDrive - DeviceHelp'?,A1,The large LUT can be saved to ROM via Moog DRIVEADMINISTRATOR 5 (MDA5) using 'Save setting persistently in device' or by setting P 421[3] - CON_FM_FW_TabIdx[3].Command to WriteToROM(2).,2.46875,2.46875,3.546875,1.953125,0.921875
6,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the large LookUp Table (LUT) be saved to ROM according to the 'MSD ServoDrive - DeviceHelp'?,A2,"Two methods: using MDA5's save function or setting P 421[3]'s Command to WriteToROM(2), as described in 'MSD ServoDrive - DeviceHelp'.",2.125,2.40625,3.640625,1.640625,0.62890625
7,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the large LookUp Table (LUT) be saved to ROM according to the 'MSD ServoDrive - DeviceHelp'?,A3,The document specifies saving the large LUT to ROM can be done through MDA5 or by executing the WriteToROM command via P 421[3].,2.03125,2.140625,3.484375,1.5390625,0.7421875
8,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the large LookUp Table (LUT) be saved to ROM according to the 'MSD ServoDrive - DeviceHelp'?,A4,"Saving to ROM is achievable either via MDA5's persistent save option or by issuing the WriteToROM command in P 421[3], per the document.",2.0,2.078125,3.296875,1.8125,0.83984375
9,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How can the large LookUp Table (LUT) be saved to ROM according to the 'MSD ServoDrive - DeviceHelp'?,A5,"Per 'MSD ServoDrive - DeviceHelp', the large LUT is saved to ROM using MDA5's save feature or the WriteToROM command in parameter P 421[3].",2.578125,2.828125,3.875,1.609375,0.69921875
10,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the field-weakening current component specified in Variant 5 (TABLE2) according to the 'MSD ServoDrive - DeviceHelp'?,A1,"In Variant 5 (TABLE2), the field-weakening current component is specified via P 343 - CON_FM_ImagTab[0..7], standardized to sqrt(2)*CON_FM_Imag, with linear interpolation between 8 equidistant data points.",2.953125,3.046875,3.625,1.90625,1.0078125
11,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the field-weakening current component specified in Variant 5 (TABLE2) according to the 'MSD ServoDrive - DeviceHelp'?,A2,"The 'MSD ServoDrive - DeviceHelp' states that for TABLE2 mode, the field-weakening current component is defined by P 343 - CON_FM_ImagTab array, using linear interpolation across 8 points.",2.671875,2.921875,3.765625,1.8828125,0.9140625
12,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the field-weakening current component specified in Variant 5 (TABLE2) according to the 'MSD ServoDrive - DeviceHelp'?,A3,"P 343 - CON_FM_ImagTab[0..7] values, standardized to sqrt(2)*CON_FM_Imag, specify the field-weakening current in TABLE2 mode, with linear interpolation.",2.234375,2.40625,3.484375,1.7890625,0.73046875
13,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the field-weakening current component specified in Variant 5 (TABLE2) according to the 'MSD ServoDrive - DeviceHelp'?,A4,"In TABLE2 mode, the document details that the field-weakening current is set through P 343 parameters, with 8 values for CON_FM_ImagTab, interpolated linearly.",2.625,2.671875,3.625,1.8125,0.96484375
14,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the field-weakening current component specified in Variant 5 (TABLE2) according to the 'MSD ServoDrive - DeviceHelp'?,A5,"For Variant 5 (TABLE2), the 'MSD ServoDrive - DeviceHelp' explains that the field-weakening current is configured via P 343's CON_FM_ImagTab, spanning 8 points with linear interpolation.",2.859375,3.046875,3.765625,1.7890625,0.98828125
15,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the interpolation handled in Variant 5 (TABLE2) for field-weakening according to the 'MSD ServoDrive - DeviceHelp'?,A1,Interpolation values in TABLE2 are calculated using linear interpolation between the 8 specified data points for the field-weakening current component.,2.46875,2.515625,3.609375,1.765625,0.5703125
16,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the interpolation handled in Variant 5 (TABLE2) for field-weakening according to the 'MSD ServoDrive - DeviceHelp'?,A2,The document states linear interpolation is applied between the 8 data points in TABLE2 for field-weakening current.,2.40625,2.453125,3.53125,1.5078125,0.56640625
17,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the interpolation handled in Variant 5 (TABLE2) for field-weakening according to the 'MSD ServoDrive - DeviceHelp'?,A3,"In TABLE2 mode, 'MSD ServoDrive - DeviceHelp' specifies linear interpolation for calculating field-weakening current between 8 points.",2.09375,2.0625,3.484375,1.625,0.58203125
18,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the interpolation handled in Variant 5 (TABLE2) for field-weakening according to the 'MSD ServoDrive - DeviceHelp'?,A4,"Linear interpolation is the method used in TABLE2 to determine field-weakening current values between the 8 data points, per the document.",2.484375,2.453125,3.5,1.7109375,0.671875
19,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",How is the interpolation handled in Variant 5 (TABLE2) for field-weakening according to the 'MSD ServoDrive - DeviceHelp'?,A5,"For TABLE2, the document details that field-weakening current is linearly interpolated across the 8 configured data points.",2.203125,2.484375,3.671875,1.6640625,0.6015625
20,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the key features of the small and large LookUp Tables (LUTs) in the 'MSD ServoDrive - DeviceHelp'?,A1,"The small LUT has a fixed [16x40] size, is internally calculated, supports only positive torques. The large LUT is variable ([3x3] to [128x128]), specified externally, supports negative torques.",3.078125,3.1875,3.828125,1.6171875,0.73828125
21,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the key features of the small and large LookUp Tables (LUTs) in the 'MSD ServoDrive - DeviceHelp'?,A2,"Small LUT: fixed [16x40], internal, positive torques. Large LUT: variable size, external, negative torques, as per 'MSD ServoDrive - DeviceHelp'.",2.1875,2.21875,3.453125,1.578125,0.6015625
22,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the key features of the small and large LookUp Tables (LUTs) in the 'MSD ServoDrive - DeviceHelp'?,A3,"According to the document, the small LUT is [16x40], internal, positive-only; the large LUT ranges from [3x3] to [128x128], external, includes negative torques.",2.734375,2.8125,3.71875,1.5234375,0.7265625
23,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the key features of the small and large LookUp Tables (LUTs) in the 'MSD ServoDrive - DeviceHelp'?,A4,"The 'MSD ServoDrive - DeviceHelp' outlines the small LUT as internally calculated, [16x40], positive torques, and the large LUT as externally defined, size-variable, accommodating negative torques.",2.34375,2.359375,3.640625,1.5390625,0.78125
24,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the key features of the small and large LookUp Tables (LUTs) in the 'MSD ServoDrive - DeviceHelp'?,A5,"Key differences: small LUT is [16x40], internal, positive torques; large LUT is size-flexible, external, handles negative torques, detailed in the document.",1.8984375,1.796875,3.4375,1.4453125,0.66796875
25,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the possible modes for field-weakening of synchronous motors as described in the 'MSD ServoDrive - DeviceHelp' document?,A1,"The possible modes are NONE (0) for disabled field-weakening, TABLE (1) for Isd set by PI controller and table, CALC (2) for Isd set by PI controller and table internally, REL (3) for internal LookUp Table, TABLE_MOT_GEN (4) for table with differentiation for motor or regenerative mode, TABLE2 (5) for table with 8 data points, LUText (6) for external LookUp Table, and LUT (7) which is reserved.",2.9375,3.0625,3.734375,1.9140625,1.359375
26,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the possible modes for field-weakening of synchronous motors as described in the 'MSD ServoDrive - DeviceHelp' document?,A2,"In the 'MSD ServoDrive - DeviceHelp', field-weakening modes include NONE (0), TABLE (1), CALC (2), REL (3), TABLE_MOT_GEN (4), TABLE2 (5), LUText (6), and LUT (7).",2.8125,2.953125,3.890625,1.6796875,0.96875
27,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the possible modes for field-weakening of synchronous motors as described in the 'MSD ServoDrive - DeviceHelp' document?,A3,"The document lists NONE (0), TABLE (1), CALC (2), REL (3), TABLE_MOT_GEN (4), TABLE2 (5), LUText (6), and LUT (7) as the field-weakening modes for synchronous motors.",3.09375,3.15625,3.875,1.8203125,0.92578125
28,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the possible modes for field-weakening of synchronous motors as described in the 'MSD ServoDrive - DeviceHelp' document?,A4,"Field-weakening modes in the 'MSD ServoDrive - DeviceHelp' are: 0-NONE, 1-TABLE, 2-CALC, 3-REL, 4-TABLE_MOT_GEN, 5-TABLE2, 6-LUText, and 7-LUT.",2.703125,2.96875,3.921875,1.734375,0.95703125
29,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What are the possible modes for field-weakening of synchronous motors as described in the 'MSD ServoDrive - DeviceHelp' document?,A5,"For synchronous motors, the 'MSD ServoDrive - DeviceHelp' specifies eight field-weakening modes: NONE (disabled), TABLE, CALC, REL, TABLE_MOT_GEN, TABLE2, LUText, and LUT (reserved).",3.09375,3.28125,4.0,1.8828125,1.0234375
30,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What distinguishes Variant 4 (TableMotGen) in the 'MSD ServoDrive - DeviceHelp' document?,A1,"Variant 4 (TableMotGen) uses a table that differentiates between motor and regenerative mode, configurable via P-343 CON_FM_ImagTab with 16 elements.",2.015625,2.1875,3.359375,1.5,0.392578125
31,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What distinguishes Variant 4 (TableMotGen) in the 'MSD ServoDrive - DeviceHelp' document?,A2,"The 'MSD ServoDrive - DeviceHelp' highlights TableMotGen's unique feature: a table differentiating motor and regenerative modes, adjustable through P-343 CON_FM_ImagTab's 16 elements.",1.8359375,2.015625,3.390625,1.59375,0.796875
32,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What distinguishes Variant 4 (TableMotGen) in the 'MSD ServoDrive - DeviceHelp' document?,A3,"TableMotGen mode is characterized by its use of a dual-mode table (motor and regenerative) in the 'MSD ServoDrive - DeviceHelp', configurable with 16 elements in P-343.",1.46875,1.6953125,3.3125,1.5234375,0.4296875
33,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What distinguishes Variant 4 (TableMotGen) in the 'MSD ServoDrive - DeviceHelp' document?,A4,"In the document, Variant 4 stands out for employing a table that separates motor and regenerative operations, using P-343 CON_FM_ImagTab's 16 configurable elements.",1.984375,2.234375,3.484375,1.46875,0.5625
34,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What distinguishes Variant 4 (TableMotGen) in the 'MSD ServoDrive - DeviceHelp' document?,A5,"The 'MSD ServoDrive - DeviceHelp' describes Variant 4 as utilizing a table for motor and regenerative differentiation, with settings in P-343 CON_FM_ImagTab across 16 elements.",2.0625,2.171875,3.5,1.4921875,0.546875
35,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the purpose of the scaling parameter P 436[0] - CON_FW_SpeedScale in the 'MSD ServoDrive - DeviceHelp'?,A1,P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds when continuous oscillation occurs due to voltage limit.,2.046875,2.21875,3.453125,1.8828125,0.6640625
36,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the purpose of the scaling parameter P 436[0] - CON_FW_SpeedScale in the 'MSD ServoDrive - DeviceHelp'?,A2,The document explains that P 436[0] adjusts map evaluation for higher speeds during voltage limit-induced oscillations.,2.0625,2.171875,3.5625,1.6796875,0.5234375
37,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the purpose of the scaling parameter P 436[0] - CON_FW_SpeedScale in the 'MSD ServoDrive - DeviceHelp'?,A3,"For addressing oscillation at voltage limits, P 436[0] scales map evaluation to higher speeds, per 'MSD ServoDrive - DeviceHelp'.",1.9453125,2.0625,3.515625,1.71875,0.55078125
38,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the purpose of the scaling parameter P 436[0] - CON_FW_SpeedScale in the 'MSD ServoDrive - DeviceHelp'?,A4,"P 436[0]'s role, as per the document, is to scale map evaluation upwards for higher speeds in oscillation scenarios.",2.234375,2.4375,3.453125,1.625,0.55859375
39,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the purpose of the scaling parameter P 436[0] - CON_FW_SpeedScale in the 'MSD ServoDrive - DeviceHelp'?,A5,The 'MSD ServoDrive - DeviceHelp' assigns P 436[0] the task of scaling map evaluation to higher speeds under voltage limit conditions.,2.390625,2.515625,3.578125,1.671875,0.61328125
40,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the significance of the nominal torque TNom and nominal speed SNom in the 'MSD ServoDrive - DeviceHelp'?,A1,"TNom and SNom, along with scaling parameters TMax and SMax, are used for scaling the map for d and q current reference values.",2.078125,2.1875,3.421875,1.84375,0.4453125
41,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the significance of the nominal torque TNom and nominal speed SNom in the 'MSD ServoDrive - DeviceHelp'?,A2,"The document indicates TNom and SNom, plus TMax and SMax, scale the map for current reference values.",1.1953125,1.09375,3.15625,1.4921875,0.404296875
42,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the significance of the nominal torque TNom and nominal speed SNom in the 'MSD ServoDrive - DeviceHelp'?,A3,"Scaling the performance map for current references relies on TNom, SNom, TMax, and SMax, as per 'MSD ServoDrive - DeviceHelp'.",1.7109375,1.921875,3.25,1.78125,0.56640625
43,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the significance of the nominal torque TNom and nominal speed SNom in the 'MSD ServoDrive - DeviceHelp'?,A4,"In the document, TNom and SNom's role, alongside TMax and SMax, is to scale the map for d and q current references.",2.125,2.109375,3.4375,1.7265625,0.55078125
44,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What is the significance of the nominal torque TNom and nominal speed SNom in the 'MSD ServoDrive - DeviceHelp'?,A5,"The 'MSD ServoDrive - DeviceHelp' explains that TNom and SNom, with TMax and SMax, facilitate the scaling of the current reference map.",2.046875,2.03125,3.390625,1.7734375,0.5703125
45,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What parameters specify the inductances of the d and q axis in the 'MSD ServoDrive - DeviceHelp'?,A1,"P 471[0] - MOT_Lsig for d axis inductance and P 480[0] - MOT_Lsq for q axis inductance, as per the document.",2.328125,2.40625,3.625,1.6328125,0.7578125
46,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What parameters specify the inductances of the d and q axis in the 'MSD ServoDrive - DeviceHelp'?,A2,The document identifies P 471[0] (MOT_Lsig) for d axis and P 480[0] (MOT_Lsq) for q axis inductances.,2.15625,2.28125,3.6875,1.5546875,0.5625
47,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What parameters specify the inductances of the d and q axis in the 'MSD ServoDrive - DeviceHelp'?,A3,"d axis inductance is set by P 471[0] - MOT_Lsig, and q axis by P 480[0] - MOT_Lsq, according to 'MSD ServoDrive - DeviceHelp'.",2.609375,2.875,3.796875,1.75,0.67578125
48,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What parameters specify the inductances of the d and q axis in the 'MSD ServoDrive - DeviceHelp'?,A4,"In the 'MSD ServoDrive - DeviceHelp', d and q axis inductances are specified by P 471[0] and P 480[0], respectively.",2.296875,2.375,3.8125,1.5703125,0.625
49,msd_servo_drive.txt,52,93548d19d1ce71192c57885146c399c49efae3c55799f2508a09ad4822e9adbf,"# Features

- Very fast adaptations, with high dynamism, are possible (open-loop control method).
- Motor parameters must be known quite precisely.
- If continuous oscillation occurs (voltage limit) the preset negative d-current value is then not sufficient. Scaling parameter P 436[0] - CON_FW_SpeedScale > 100% is used to evaluate the map at higher speeds.

The voltage controller overlaid over the map (setting as described in variant 1). The set combination of voltage controller and map entails more commissioning commitment, but it enables the best stationary behaviour (highest torque relative to current) and the best dynamic response to be achieved.

**Table 7.28: Parameters for selecting field weakening**
|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|435|0|CON_FM_FWMode| |Selection mode for field-weakening of synchronous motors|
| | |NONE (0) = Field weakening disabled| |Field-weakening is off, regardless of other settings.|
| | |TABLE (1) = Isd set by PI controller and table| |Field-weakening is effected by a characteristic which specifies the d-current (P 343[0] - CON_FM_ImagTab) dependent on the speed (P 342[0] - CON_FM_SpeedTab).|
| | |CALC (2) = Isd set by PI controller and table| |Field-weakening is effected by way of a characteristic which is set internally via the parameter|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 148

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 149

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
| |0-7|Motor or classic table, motor parameters.| |The d-current reference is then calculated dependent on the speed AND the required q-current: isd = f(n, isq_ref). The selection concerning as of what power the operation mode is “motor-oriented” or “regenerative” is defined by P-459 MOT_PNom * P-348 CON_FM_SlipCon (%).|
|REL (3)| |Internal LookUp Table (small table)| |The voltage controller overlaid over the map (setting as described in variant 1).|
|TABLE_MOT_GEN(4)| |Table with a differentiation for motor or regenerative mode| | |
|TABLE2(5)| |Table with 8 data points at equidistant spacing| | |
|LUText(6)| |External LookUp Table (large table)| | |
|LUT(7)| |reserved| | |

# 7.7.4 Variant 5 (TABLE2)

“Table 2” has 8 data points for the field-weakening current component with an equidistant spacing between two limit speeds.

Activate table: P 435[0] - CON_FM_FWMode = TABLE2(5)

The lower limit speed is P 342[0] - CON_FM_SpeedTab[0], and the upper limit speed is P 342[1] - CON_FM_SpeedTab[1]. Both numerical values for the limits speeds are standardized relative to the nominal speed of the motor (MOT_SNom).

The table values for the field-weakening current component (-id) are specified via P 343 - CON_FM_ImagTab[0..7] and standardized to sqrt(2)*CON_FM_Imag. The interpolation values are calculated using linear interpolation.

P 343 - CON_FM_ImagTab[0] and CON_FM_ImagTab[7] are used for extrapolation outside of the limit speeds.

# 7.7.3 Variant 4 (TableMotGen)

A table that differentiates between motor and regenerative mode is used.

Activate table: P 435[0] - CON_FM_FWMode = TABLE_MOT_GEN(4)

Parameter P-343 CON_FM_ImagTab can be used to configure 16 elements.

# 7.7.5 Variants 3 and 6 (LUT)

For motors with different inductances on the d and q axis, such as an IPMSM (interior permanent magnet synchronous machine), a reluctance torque which is dependent on the d and q current can be built up. A result of the exploitation of this torque is that the control by means of q current alone (id is reduced to 0) (typical for non-salient pole PMSM) is no longer adequate to make use of the machine’s full potential. Consequently, special control structures are implemented in the MSD Servo Drive to ensure optimal control for motors of this nature.

The control works in almost the same way as for the standard control circuit of a PMSM, except that the direct axis ref. current is no longer zero, but instead, both currents are dependent on the reference torque and the actual speed. To accomplish this, the standard control circuit is enhanced to include generation of a current reference value in the form of a LookUpTable (LUT). The current reference value is generated by specifying the associated d and q currents based on the target specification for the torque and the actual speed.

|nSoll|Speed|TSoll Current reference value|id, soll Current|ud, soll|Pulse controller (LUT)|iq, soll control|uq, soll inverter|iα, ist|εist|iβ, ist|
|---|---|---|---|---|---|---|---|---|---|---|
|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|Image 7.35: Example of 8 data points with equidistant spacing over the speed|

Notes:

1. If you do not want to have field weakening (id=0) for low speeds |n| <= P 342 - CON_FM_SpeedTab[0], then P 343 - CON_FM_ImagTab[0] must be set to 0% (extrapolation below P 342 - CON_FM_SpeedTab[0] with a value of 0).
2. The values in P 342 - CON_FM_SpeedTab[2..7] and P 343 - CON_FM_ImagTab[8..15] are not used in this mode.

Image 7.36: Structure of the field weakening for a synchronous motor LookUp Table

These d and q-current reference values can

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 150

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Be calculated internally by the firmware (small table), OR

Be specified externally, for example using a higher-order control (large table), OR

Be loaded via the file system (large table)

The large table has a variable size for the performance map which can be set for a minimum of [3x3] to a maximum of [128x128] table entries. It is specified externally to the servo drive. Negative torques are also possible.

Two LUTs of different sizes (small and large table) are implemented for this purpose. Activate large LUT: P 435[0] - CON_FM_FWMode = LUText(6)

Each of these tables has two performance maps, one for the direct axis ref. current and one for the q-current reference values. Each are dependent on the actual speed ‘nact’ (x-direction) and the target torque ‘Tset’ (y-direction): field[x*y].

# Small table

The small table has a fixed size for the performance map of [16x40] table entries. It is calculated internally by the servo drive. Only positive torques.

Activate small LUT: P 435[0] - CON_FM_FWMode = REL(3)

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 1965|0|LUT: Use of speed|Table size in the speed direction|Factory setting: 121 Minimum: 3 Maximum: 128|
|P 1965|1|LUT: Use of torque|Table size in the torque direction|Factory setting: 31 Minimum: 3 Maximum: 128|

# Table 7.30: Specifying the size of the performance map for the large table

The scaling of the map for the d and q current reference results from the nominal torque TNom and the nominal speed SNom as well as the associated scaling parameters TMax and SMax.

The values for the two inductances must be taken from the motor data sheet or can be determined by means of the motor identification (see also section ""Motor identification"" on page 45).

# Table 7.29: Specifying the inductances of the d and q axis

|ID|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|P 471|0|MOT_Lsig|mH|d axis inductance|
|P 480|0|MOT_Lsq|mH|q axis inductance|

|Example:|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|---|
|P 1966| |0|LUT: Tab speed maximum|3600|rpm|
|P 1966| |1|LUT: Tab speed minimum|Always 0 (**)|rpm|
|P 1966| |2|LUT: Tab torque maximum|0.45|Nm|
|P 1966| |3|LUT: Tab torque minimum|-0.45 (*)|Nm|

Table 7.31: Size of the map for the size of the table

(**) Map values with a negative torque are not supported. (The range of negative torques is mapped on the range of the positive torques by means of sign manipulation.)

Image 7.37: Example

# 7.7.5.1 Internal calculation of the small table

The possible performance maps for the q and d current reference result from this:

Select: Internal calculation of the small table

| |0.45 Nm|0.45|127| | |
|---|---|---|---|---|---|
| |Nm|...|...| | |
|Torque|...|0|...| | |
|...|...|...|...| | |
| | | |0|-0.45|0|

Nm (*) Performing initialization

| |0|1|2|3|...|127|
|---|---|---|---|---|---|---|
| |...|...|...|...|3600|rpm|
| |...|...|...|...|rpm| |

(**)

Speed Parameter P 149[0] - MPRO_DRVCOM_Init = START(1).

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 149| |MPRO_DRVCOM_Init|1: Start re-initialization| |

Table 7.33: P 149, perform re-initialization

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 152

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

The d/q current values are now calculated and the small table is filled with the results. Afterwards, access to the table entries of the respective table field is possible.

The small table is not saved to the controller’s ROM. Instead, it is re-calculated when the servo drive is started or a re-initialization takes place and the results are saved to RAM.

# 7.7.5.2 Parameter interface for accessing the d/q current values of the LUT

Access to the values of the LUT can be carried out via parameters P 421, P 422 and P423:

Selecting the small table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 0 (internal LUT).

Selecting the large table:

- Parameter P 421[2] - CON_FM_FW_TabIdx[2].Table select = 1 (external LUT).

Selecting the index for the speed:

- Parameter P 421[0] - CON_FM_FW_TabIdx[0].Speed index select.

Selecting the index for the torque:

- Parameter P 421[1] - CON_FM_FW_TabIdx[1].Torque index select.

Table value of the LUT for the d current:

- Parameter P 422[0] - CON_FM_FW_TabId - Id in A.

Table value of the LUT for the q current:

- Parameter P 423[0] - CON_FM_FW_TabIq - Iq in A.

|ID|Index|Name / Setting|Description|Unit|
|---|---|---|---|---|
|P 421|CON_FM_FWTabIdx| | | |
|P 421|0|Speed index select|Selects index for speed| |
|P 421|1|Torque index select|Selects index for torque| |
|P 421|2|Table select|0: Selects small table 1: Selects large table| |
|P 421|3|Command|0: None 1: ClearTable 2: WriteToRom| |
|P 422|CON_FM_FWTabId| |d current table entry|A|
|P 423|CON_FM_FWTabIq| |q current table entry|A|

Table 7.34: Parameter interface for accessing the LUT

The large table is not generated in the servo drive. It must be provided to the servo drive from an external source (referred to as an “external LUT”). This can be accomplished via the parameter interface described here.

For further procedure, see also section ""Internal calculation of the small table"" on page 152.

# NOTE

During the internal calculation of the small table, only map fields for positive speeds and torques are calculated.

# 7.7.5.3 Saving the large table to ROM

The large table can be transferred from the volatile RAM memory of the device to the non-volatile FLASH memory in the servo drive in two ways. The next time the device is started up, the reverse process is then carried out so that the large table is available immediately.

A.) Save the parameters, for example via Moog DRIVEADMINISTRATOR 5 (MDA5)

Saving the large table to the flash memory takes place concurrently to the process of saving the device parameters, for example using the “Save setting persistently in device (RAM to ROM)” button in the MDA5.

The parameter behind this procedure is P 11[0]:

Parameter P11[0] - PARA_SetCmd[0].Save = Active(1)

In contrast to the parameter values that are transferred to the NVRAM in the servo drive, the values of the large table are transferred to the flash memory in the servo drive.

# B.) Targeted saving of a special parameter using a save command

Command: Save large table to flash memory:

Parameter P 421[3] - CON_FM_FW_TabIdx[3].Command = WriteToROM(2)

This command only works for the large table: Select the table using parameter P 421[2] - CON_FM_FW_TabIdx[2]. Table select (small or large) is redundant in this case.

",What parameters specify the inductances of the d and q axis in the 'MSD ServoDrive - DeviceHelp'?,A5,"The document notes that P 471[0] defines d axis inductance, while P 480[0] sets q axis inductance.",2.109375,2.25,3.703125,1.484375,0.57421875
