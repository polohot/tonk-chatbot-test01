,NODE_FILE_NAME,NODE_NUMBER,NODE_HASH,NODE_TEXT,Q,A_NUMBER,A,helpfulness,correctness,coherence,complexity,verbosity
0,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the process controller's setpoint be selected in the 'MSD ServoDrive - DeviceHelp' document?,A1,The setpoint can be selected via P 2683[0] - CON_PRC_REFSEL from predefined sources.,1.875,2.046875,3.5,1.34375,0.419921875
1,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the process controller's setpoint be selected in the 'MSD ServoDrive - DeviceHelp' document?,A2,Selection is made using the CON_PRC_REFSEL parameter from available setpoint sources.,2.40625,2.515625,3.625,1.4453125,0.36328125
2,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the process controller's setpoint be selected in the 'MSD ServoDrive - DeviceHelp' document?,A3,The document specifies that CON_PRC_REFSEL is used to choose the setpoint source.,2.203125,2.3125,3.59375,1.390625,0.41015625
3,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the process controller's setpoint be selected in the 'MSD ServoDrive - DeviceHelp' document?,A4,"By configuring CON_PRC_REFSEL, users can select the desired setpoint source.",2.359375,2.375,3.625,1.4375,0.515625
4,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the process controller's setpoint be selected in the 'MSD ServoDrive - DeviceHelp' document?,A5,Setpoint selection is facilitated through the CON_PRC_REFSEL parameter.,2.046875,2.15625,3.515625,1.2890625,0.25
5,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the test signal generator's output be selected in the 'MSD ServoDrive - DeviceHelp' document?,A1,The output is selected using parameter P 1501 - SCD_TSIG_OutSel.,2.109375,2.34375,3.703125,1.2578125,0.193359375
6,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the test signal generator's output be selected in the 'MSD ServoDrive - DeviceHelp' document?,A2,"By setting the SCD_TSIG_OutSel parameter, users can choose the desired output.",2.109375,2.28125,3.625,1.375,0.4609375
7,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the test signal generator's output be selected in the 'MSD ServoDrive - DeviceHelp' document?,A3,"Output selection is done via the SCD_TSIG_OutSel parameter, as detailed in the document.",2.171875,2.46875,3.671875,1.4453125,0.296875
8,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the test signal generator's output be selected in the 'MSD ServoDrive - DeviceHelp' document?,A4,The document specifies that the test signal generator's output is selected through the SCD_TSIG_OutSel parameter.,2.75,2.921875,3.78125,1.3984375,0.490234375
9,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How can the test signal generator's output be selected in the 'MSD ServoDrive - DeviceHelp' document?,A5,Selection of the output signal is controlled by the SCD_TSIG_OutSel parameter.,1.9140625,2.140625,3.65625,1.265625,0.26953125
10,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the process controller activated in the 'MSD ServoDrive - DeviceHelp' document?,A1,It can be activated via the control word P 2681[0] - CON_PRC_CtrlWord or a digital input.,2.015625,2.28125,3.5,1.4140625,0.5078125
11,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the process controller activated in the 'MSD ServoDrive - DeviceHelp' document?,A2,Activation is possible through the CON_PRC_CtrlWord parameter or a digital input.,1.96875,2.15625,3.609375,1.28125,0.44921875
12,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the process controller activated in the 'MSD ServoDrive - DeviceHelp' document?,A3,The document states activation occurs via CON_PRC_CtrlWord or directly through a digital input.,2.34375,2.515625,3.515625,1.2578125,0.416015625
13,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the process controller activated in the 'MSD ServoDrive - DeviceHelp' document?,A4,Either the CON_PRC_CtrlWord parameter or a digital input can activate the process controller.,2.078125,2.265625,3.5625,1.3671875,0.40234375
14,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the process controller activated in the 'MSD ServoDrive - DeviceHelp' document?,A5,Process controller activation is achieved by setting CON_PRC_CtrlWord or using a digital input.,2.140625,2.328125,3.625,1.3203125,0.5078125
15,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the sweep signal generated in the 'MSD ServoDrive - DeviceHelp' document?,A1,A sine signal of variable frequency is generated by setting P 1510 - SCD_TSIG_SignalType to Sweep (2).,1.2890625,1.1875,2.890625,1.4609375,0.341796875
16,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the sweep signal generated in the 'MSD ServoDrive - DeviceHelp' document?,A2,"By selecting Sweep (2) in SCD_TSIG_SignalType, a variable frequency sine signal is produced.",1.21875,1.078125,2.90625,1.375,0.314453125
17,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the sweep signal generated in the 'MSD ServoDrive - DeviceHelp' document?,A3,The document explains that setting the signal type to Sweep creates a sine wave with changing frequency.,1.2890625,1.3828125,2.953125,1.2734375,0.330078125
18,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the sweep signal generated in the 'MSD ServoDrive - DeviceHelp' document?,A4,Generation of a sweep signal involves configuring SCD_TSIG_SignalType to Sweep.,1.0,1.09375,2.828125,1.3046875,0.12158203125
19,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",How is the sweep signal generated in the 'MSD ServoDrive - DeviceHelp' document?,A5,"To generate a sweep signal, one must set the SCD_TSIG_SignalType parameter to Sweep.",1.3125,1.3984375,2.9375,1.484375,0.322265625
20,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the consequences of an excessively high gain in the control system as described in the 'MSD ServoDrive - DeviceHelp' document?,A1,An excessively high gain will result in oscillation and noise.,2.625,2.703125,3.765625,1.2109375,0.33203125
21,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the consequences of an excessively high gain in the control system as described in the 'MSD ServoDrive - DeviceHelp' document?,A2,Oscillation and noise are the direct outcomes of setting the gain too high in the control system.,2.59375,2.609375,3.703125,1.3828125,0.51171875
22,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the consequences of an excessively high gain in the control system as described in the 'MSD ServoDrive - DeviceHelp' document?,A3,The document specifies that oscillation and noise are caused by an excessively high gain.,2.84375,2.90625,3.828125,1.25,0.453125
23,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the consequences of an excessively high gain in the control system as described in the 'MSD ServoDrive - DeviceHelp' document?,A4,"In the 'MSD ServoDrive - DeviceHelp', it is mentioned that too high a gain leads to undesirable oscillation and noise.",2.90625,3.140625,3.9375,1.3125,0.53125
24,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the consequences of an excessively high gain in the control system as described in the 'MSD ServoDrive - DeviceHelp' document?,A5,"Setting the gain excessively high, as per the document, results in the system oscillating and generating noise.",2.828125,2.890625,3.734375,1.3828125,0.59765625
25,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the features of the process controller described in the 'MSD ServoDrive - DeviceHelp' document?,A1,"Features include PI controller with Kp adaptation, selectable actual value, and usability in all control modes.",1.75,1.6875,3.5625,1.140625,0.3515625
26,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the features of the process controller described in the 'MSD ServoDrive - DeviceHelp' document?,A2,"The controller offers Kp adaptation, actual value selection, and operates in any control mode.",1.359375,1.34375,3.390625,1.078125,0.296875
27,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the features of the process controller described in the 'MSD ServoDrive - DeviceHelp' document?,A3,Its features encompass a PI controller with adaptable Kp and flexibility across control modes.,1.1875,1.0546875,3.078125,1.0859375,0.2734375
28,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the features of the process controller described in the 'MSD ServoDrive - DeviceHelp' document?,A4,"The document highlights its PI controller design, Kp adaptation, and mode versatility.",1.7734375,1.8359375,3.46875,1.109375,0.333984375
29,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What are the features of the process controller described in the 'MSD ServoDrive - DeviceHelp' document?,A5,"Among its features are a PI controller, Kp adaptation, and compatibility with all control modes.",1.765625,1.796875,3.515625,1.1015625,0.376953125
30,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What does the status word P 2682[0] indicate in the 'MSD ServoDrive - DeviceHelp' document?,A1,"It indicates the process controller’s current state, including if it's active or if the integral term reset is complete.",2.328125,2.484375,3.671875,1.2734375,0.734375
31,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What does the status word P 2682[0] indicate in the 'MSD ServoDrive - DeviceHelp' document?,A2,The status word shows whether the controller is active and if the integral term has been reset.,1.234375,1.2109375,3.296875,1.046875,0.333984375
32,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What does the status word P 2682[0] indicate in the 'MSD ServoDrive - DeviceHelp' document?,A3,"According to the document, P 2682[0] reveals the controller's active status and reset completion.",2.453125,2.609375,3.671875,1.3515625,0.70703125
33,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What does the status word P 2682[0] indicate in the 'MSD ServoDrive - DeviceHelp' document?,A4,It provides information on the controller's activity and integral term reset status.,1.953125,2.078125,3.578125,1.3359375,0.4375
34,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What does the status word P 2682[0] indicate in the 'MSD ServoDrive - DeviceHelp' document?,A5,The status word displays the process controller's operational state and reset status.,1.3046875,1.5703125,3.515625,1.171875,0.287109375
35,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the function of the rate limiter in the process controller according to the 'MSD ServoDrive - DeviceHelp' document?,A1,It limits the changes to the control variable per sampling segment to prevent abrupt changes.,2.671875,2.75,3.703125,1.3515625,0.482421875
36,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the function of the rate limiter in the process controller according to the 'MSD ServoDrive - DeviceHelp' document?,A2,The rate limiter controls how quickly the control variable can change each sampling segment.,2.40625,2.5625,3.609375,1.28125,0.48046875
37,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the function of the rate limiter in the process controller according to the 'MSD ServoDrive - DeviceHelp' document?,A3,"According to the document, it restricts the rate of change of the control variable.",2.625,2.6875,3.671875,1.21875,0.474609375
38,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the function of the rate limiter in the process controller according to the 'MSD ServoDrive - DeviceHelp' document?,A4,Its role is to ensure smooth changes in the control variable by limiting its rate of change.,2.453125,2.5,3.546875,1.4765625,0.44140625
39,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the function of the rate limiter in the process controller according to the 'MSD ServoDrive - DeviceHelp' document?,A5,The rate limiter prevents sudden changes in the control variable by imposing limits.,1.8203125,2.015625,3.5,1.34375,0.39453125
40,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the purpose of the PRBS signal in the 'MSD ServoDrive - DeviceHelp' document?,A1,The PRBS signal is suitable for system excitation with high bandwidth using a test signal.,2.75,2.765625,3.609375,1.5234375,0.431640625
41,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the purpose of the PRBS signal in the 'MSD ServoDrive - DeviceHelp' document?,A2,It is used to excite the system with a high bandwidth test signal.,2.390625,2.4375,3.625,1.2890625,0.25390625
42,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the purpose of the PRBS signal in the 'MSD ServoDrive - DeviceHelp' document?,A3,"For high bandwidth system excitation, the PRBS signal is utilized.",2.328125,2.265625,3.53125,1.265625,0.283203125
43,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the purpose of the PRBS signal in the 'MSD ServoDrive - DeviceHelp' document?,A4,The document mentions that the PRBS signal excites the system across a high bandwidth.,1.953125,1.8828125,3.28125,1.3359375,0.416015625
44,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What is the purpose of the PRBS signal in the 'MSD ServoDrive - DeviceHelp' document?,A5,System excitation with high bandwidth is achieved through the PRBS signal.,2.140625,2.171875,3.375,1.5078125,0.384765625
45,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What types of signals can the test signal generator in the 'MSD ServoDrive - DeviceHelp' document produce?,A1,"The test signal generator can produce various signal types including sine, triangle, sweep, and PRBS signals.",2.78125,2.921875,3.796875,1.5078125,0.6171875
46,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What types of signals can the test signal generator in the 'MSD ServoDrive - DeviceHelp' document produce?,A2,"It generates sine, triangle, sweep, and PRBS signals, among others.",2.203125,2.296875,3.5625,1.171875,0.53515625
47,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What types of signals can the test signal generator in the 'MSD ServoDrive - DeviceHelp' document produce?,A3,"According to the document, signal types like sine, triangle, and sweep can be formed and combined.",2.453125,2.46875,3.53125,1.359375,0.703125
48,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What types of signals can the test signal generator in the 'MSD ServoDrive - DeviceHelp' document produce?,A4,"The generator is capable of creating sine, triangle, and sweep signals, with PRBS also being an option.",2.625,2.640625,3.640625,1.265625,0.66796875
49,msd_servo_drive.txt,56,567bcf264dc30b038aa793e4b1fab07943e8a84bc6ecc60cab7797ab1de3a9e1,"An excessively high gain will result in oscillation and noise. In both methods (1) and (4), the flux forming current ""Isdref"" is injected as a test signal.

# 7.8.4 Test signal generator

It is possible to form various signal types and transfer them to the control. This function is independent of the control mode and has a direct effect on the control. Signal types can also be combined. The delta signal form is additionally available, though at present it is only accessible via the parameter editor. The parameters are recorded in the parameter list.

# 7.8.4.1 Overview of test signal generator

Image 7.42: TSIG output: Signal curve of TG

Image 7.41: “Test signal generator” screen

# 7 Control

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|1500|SCD_TSIG_Con|Control word of test signal generator|The parameter is reset to the value 0 on completion of the stop procedure.|
| |OFF (0)|Test signal generator deactivated| |
| |Stop(1)|Stop test signal| |
| |Start(2)|Start test signal| |
| |STOP-Cycle(3)|TG stops at end of current square cycle|TG stops next time|
| |Stop-Zero(4)|reference value passes through zero| |
|1501|SCD_TSIG_OutSel|Test signal generator output selector| |
| |OFF (0)|Not used| |
| |isdref(1)|Flux-forming current| |
| |mref(2)|Torque| |
| |sref(3)|Speed| |
| |epsref(4)|Position| |
| |sramp(5)|Speed (ramp)| |
| |ISQREF(6)|q-current reference| |
| |ISDQREF(7)|d-current q-current reference| |

Image 7.43: Test signal generator for square signal

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 162

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

163

|ID|Parameter / Setting|Function|Info|
|---|---|---|---|
|USDQREF(8)|Setpoint voltage feed-forward control| | |
|PRCREF(9)|Process controller| | |
|1502|SCD_TSIG_|Number of repeat cycles|Cycles|
|1503|SCD_TSIG_|Offset of square signal| |
| |Offset| | |
|0|Offset of square signal (Stage 1)| | |
|1|Offset of square signal (Stage 2)| | |
|2| | | |
|3| | | |
|1504|SCD_TSIG_|Period of square signal|Time|
|0|Time (t1)| | |
|1|Time (t2)| | |
|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|Table 7.38: Parameters of test signal generator for square and sine signal (continue)|
|1505|SCD_TSIG_|Amplitude of sine signal|Amp (a)|
|1506|SCD_TSIG_|Frequency of the sine signal (f); Lower frequency of the sweep signal| |
|1507|SCD_TSIG_|Starting phase of current space phasor in VFCON and ICON mode|SetPhase|
|1508|SCD_TSIG_|PRBS signal generator, sampling time|PRBSTime|
|1509|SCD_TSIG_|PRBS signal generator, amplitude|PRBSAmp|

|ID|Parameter / Setting|Function|Info|alternating frequency.|
|---|---|---|---|---|
|1510|SCD_TSIG_SignalType|SINUS(0)|Sine wave generator| |
| | |TRIANGLE(1)|Triangle wave generator| |
| | |Sweep (2)|Sweep signal (sine wave)| |
| | |TriSweep (3)|Sweep signal (triangle wave)| |
|1511|SCD_TSIG_BreakTime|0|Break (ms) before signal cycle| |
| | |1|Break (ms) between positive and negative signal cycle segment| |
|1512|SCD_TSIG_SymVal| |Symmetry value for delta signal| |
|1513|SCD_TSIG_Freq2| |Upper frequency of the sweep signal (f)| |

Table 7.38: Parameters of test signal generator for square and sine signal (continue)

# 7.8.4.2 PRBS signal

The PRBS signal is suitable for system excitation with high bandwidth using a test signal. A feedback shift register is used to generate a binary output sequence with an amplitude that can be set in P 1509 - SCD_TSIG_PRBSAmp and a ""random""

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 164

# 7 Control

# 7 Control

# 7.8.4.3 Sweep signal

Use P 1510 - SCD_TSIG_SignalType = Sweep (2) to generate a sine signal of variable frequency.

Define the lower frequency with P 1506 - SCD_TSIG_Freq and the upper frequency with P 1513 - SCD_TSIG_Freq2.

Executing a test signal from the lower to the upper frequency. Set P 1504[0] - SCD_TSIG_Time equal to the desired signal duration and P 1504[1] - SCD_TSIG_Time = 0. One pass from the lower frequency to the upper frequency is carried out.

Executing a test signal from the lower to the upper frequency and back. Alternatively you can set P 1504[1] - SCD_TSIG_Time = P 1504[0] - SCD_TSIG_Time. A pass is then made from the lower frequency to the upper frequency and back again to the lower frequency.

For repeating the test signal, use P 1502 - SCD_TSIG_Cycles.

Use P 1510 - SCD_TSIG_SignalType = TriSweep (3) to generate a triangle signal with the same frequency behaviour.

# 7.9 V/Hz mode

A simple function test can be carried out in V/Hz mode. This test will show users whether a motor is connected correctly and whether the right direction of movement will be followed.

- The direction of movement is the wrong one
- The motor is at a standstill,
- Uncontrollable motion occurs,

then the connection and the motor data need to be checked.

For testing purposes, a V/Hz control system is implemented in such a way that the closed-loop speed control circuit will be replaced by the V/Hz control. The reference is the speed reference; the actual speed is set equal to the reference. A linear characteristic with two interpolation points is implemented, with a fixed boost voltage setting P 313[0] - CON_VFC_VBoost at 0 Hertz. Starting from the rated frequency P 314[0] - CON_VFC_FNom, the output voltage will remain constant at P 315[0] - CON_VFC_VNom. This means that an asynchronous motor will automatically be driven to field weakening as the frequency rises.

# Image 7.45: “V/Hz mode” screen

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |313|0|CON_VFC_VBoost|V|V/Hz characteristic: Boost voltage|
| |314|0|CON_VFC_FNom|Hz|V/Hz characteristic: Nominal frequency|
| |315|0|CON_VFC_VNom|V|V/Hz characteristic: Nominal voltage|

# Table 7.39: “V/Hz mode” parameters

# 7.10 Process controller

|ID|Index Name|Unit|Description|
|---|---|---|---|
|19|epsRS| |Pole width Rotor/stator electrical angle|
|20|freqRS|Hz|Rotor/stator electrical frequency|
|21|freqFS|Hz|Field/stator electrical frequency|
|29|vmot|V|Current motor voltage|
|312|CON_CCON_VMot|V|Current motor voltage (rms, phase-to-phase)|

# 7.10.1 Features

- Process controller calculation in speed controller cycle
- Process controller as PI controller with Kp adaptation
- Process controller actual value selectable via selector
- Filtering and offset correct of reference and actual values
- Process controller output can be connected to different points in the general control structure
- Process controller is usable in all control modes
- Cycle time: 125 μs (if the switching frequency is 4 kHz: 250 μs)
- The process controller state is changed with a control word
- The process controller state is indicated with a status word
- The process controller’s integral term can be reduced in a targeted manner with a control command

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 166

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 167

# 7.10.2 Description of control structure

The status word, P 2682[0] - CON_PRC_StatWord, indicates the process controller’s current state.

|Bit|Name|Description|
|---|---|---|
|0|On|Process controller active|
|1|ResetIReady|Integral term reset complete|

Table 7.42: Status word P 2682[0]

Image 7.46: Schematic of process controller

# 7.10.2.1 Control and status word of process controller

The process controller can be activated either with the control word, P 2681[0] - CON_PRC_CtrlWord, or directly via a digital input (for more information on how to select a function for the digital inputs, see Section ""Digital inputs"" on page 290, ""START_PRC(48) = Start process controller” setting).

|Bit|Name|Description|
|---|---|---|
|0|On|Enabling the process controller|
|1|Reset|Resets the integral term with a ramp (P 2680[1])|

Table 7.41: Control word P 2681[0]

Image 7.47: Process controller state machine

In addition to the process controller status word, bit 8 of the device status word, P 702[0] - MON_State, will be set when the setpoint is reached. P 2679[0] - CON_PRC_RefReached can be used to configure the “Reference value attained” window for this purpose. Bit 8 will be set to TRUE if the process controller’s deviation is less than 50% of the configured “Reference value attained” window.

# 7.10.2.2 Reference values

The process control circuit setpoint can be selected via pre-defined setpoint sources. P 2683[0] - CON_PRC_REFSEL can be used to select these setpoint sources.

|Setting|Name|Description|
|---|---|---|
|0|USER|User input via CON_PRC_REFVAL_User - P2684|
| | |Setpoint for rack and pinion control.|
|1|RPDC|Automatic input of transmitted RPDC current value|
|2|ISA00|Setpoint via analog input ISA00. Analog input ISA00 (CON_ANA_Isaf[0])|
|3|ISA01|Setpoint via analog input ISA01. Analog input ISA01 (CON_ANA_Isaf[1])|
|4|IEA02|Analog input IEA02.|
|5|IEA03|Analog input IEA03.|

* See Section ""Mapping parameters and scope values"" on page 169

NOTE: If the target value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

Once the setpoint source is selected, the process controller setpoint can be set with P 2666[0] - CON_PRC_REFVAL. This setpoint can then be scaled further with P 2667[0] - CON_PRC_REFSCALE in order, for example, to incorporate decimal places and/or unit conversions.

# 7.10.2.3 Actual values

The process control circuit actual value can be selected via a number of pre-defined actual value sources. P 2668[0] - CON_PRC_ACTSEL can be used to select these actual value sources.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 168

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|Setting|Name|Description|Setting|Name|Description|
|---|---|---|---|---|---|
|0|ANA0|Analog input ISA00 (CON_ANA_Isaf[0])|12|POS|Actual position normalized. Position in user units|
|1|ANA1|Analog input ISA01 (CON_ANA_Isaf[1])|13|P 2981|Mappable parameter P-2981 *|
|2|FIELDBUS|CON_PRC_ACTVAL_FIELDBUS P 2677|14|P 2982|Mappable parameter P-2982 *|
|3|REFSPEED|Current speed (internal) Current speed from encoder for unfiltered speed control|15|P 2983|Mappable parameter P-2983 *|
|4|REFPOS|Current position from encoder for unfiltered position control|16|P 2984|Mappable parameter P-2984 *|
|5|ISQREF_SCON|Present setpoint for current from speed controller| | | |
|6|IEA02|Analog input IEA02| | | |
|7|IEA03|Analog input IEA03| | | |
|8|P_ACT|Actual pressure.| | | |
|9|-|not used| | | |
|10|-|not used| | | |
|11|SPEED|Actual speed normalized. Speed in user units.| | | |

Table 7.44: Selector for actual value (P 2668[0]) (continue)

NOTE: If the actual value source is selected, the respective input must also have a function assigned to it. see also section ""Function selectors"" on page 304

The selected actual value will be output in P 2673[0] - CON_PRC_RAW_ACTVAL. In addition, a configurable offset, P 2669[0] - CON_PRC_ACTOFFSET, can be superimposed on the actual value. The actual value can be smoothed with a configurable PT-1 filter. To use this option, the user can use P 2670[0]- CON_PRC_ACTTF to set a filter time in milliseconds. If the filter time is set to 0 ms, the filter will be disabled. Moreover, the filtered actual value can be scaled with P 2671[0] - CON_PRC_ACTSCALE in order to incorporate decimal places or unit conversions. The resulting actual value for the process controller will be indicated in P 2674[0] - CON_PRC_ACTVAL.

Mapping parameters and scope values

For scope values or other process parameter values, it is possible to carry out a mapping operation for general, readable process parameters (for fieldbus or CoDeSys access). An example would be the mapping of a process value from a parameter list or range list for SERCOS Access as an input value for the process control because no allocation of sub-indexes is possible.

# Table 7.46: Allocation of P 2980 MPRO_DATA_Map to MPRO_DATA_REAL_x

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2980|MPRO_DATA_Map|Data parameter for real-time scope/parameter mapping.| |- Parameter|
| | | | |- Scope|
| |Bit 0:|Mapping of a process parameter value.| | |
| |1:|Mapping of a scope value.| | |
| |Bit 2..7:|Not used.| | |
| |Bits 8..15:|Parameter sub ID; not used for mapping a scope value.| | |
| |Bits 16..31:|Parameter ID or scope ID (from the scope list)| | |
| |Example, mapping of the device temperature P 704 to P 2981| | | |
| |Bit 0 →|0|P 2668|13|
| |Bit 1..7 →|0000 000|CON_PRC_ACTSEL|14|
| |Bits 8..15 (Sub-ID: 0) →|0000 0000| |15|
| |Bits 16..31 (P704) →|0000 0010 1100 0000|IST|16|
| |Result →|0000 0010 1100 0000 0000 0000 0000 0000| | |

# Table 7.45: Parameter MPRO_DATA_Map

|ID|Index|Name|Description|
|---|---|---|---|
|2980 1|MAP_REAL_1|Mapping of REAL_1 parameter|P 2683|
|2980 2|MAP_REAL_2|Mapping of REAL_2 parameter|CON_PRC_REFSEL|
|2980 3|MAP_REAL_3|Mapping of REAL_3 parameter|SOLL|
|2980 4|MAP_REAL_4|Mapping of REAL_4 parameter| |

In dependence on the index of P 2980 [1…4] used, automatic allocation is then carried out to the parameters P 2981…. P 2984 MPRO_DATA_REAL_1..4.

The following allocation is specified:

P-2985..2988 MPRO_DATA_DINT_1..4

P-2989..2992 MPRO_DATA_UDINT_1..4

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 170

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.10.2.4 PI process controller

Deviation P 2675[0] - CON_PRC_CDIFF will be the difference between the scaled process controller setpoint and the scaled and filtered actual value. The sign for this deviation can be inverted with P 2665[0] - CON_PRC_CDIFF_SIGN (CON_PRC_CDIFF_SIGN = -1).

This deviation will be passed on to the process controller. This controller is implemented as a PI controller with output limiting and an anti-windup function. Users can set a Kp gain with P 2659[0] - CON_PRC_KP, Kp scaling with P 2660[0] - CON_PRC_KPSCALE and a reset time with P 2661[0] - CON_PRC_TN. If the integral-action time is set to the maximum parameter value, the I-component of the controller is inactive. (CON_PRC_TN = 10000 [ms]).

Moreover, an offset can be added to the signal at the controller’s output by using P 2662[0] - CON_PRC_REFOFFSET. After this, the totalled manipulated variable will be passed through a limiter. The user can parameterize the limitation via parameter P 2663[0] - CON_PRC_LIMPOS for the positive limit and P 2664[0] - CON_PRC_LIMNEG for the negative limit.

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By way of field parameter P 2680 - CON_PRC_RateLimiter the limitation of the control variable steepness per millisecond can be parameterized. Subindex 0 is for the limiting used for standard process controller operation and subindex 1 is for reducing the process controller’s integral term. For more details on how to set the rate limiting, see Section ""Rate Limiter"" on page 171.

# 7.10.2.5 Manipulated variable

The process controller’s manipulated variable downstream of the rate limiter (P 2676[0] - CON_PRC_OUTVAL) can be mapped to various internal drive setpoint or feed-forward control values. The selection is made via P 2672[0] - CON_PRC_OUTSEL.

|Setting|Name|Description|
|---|---|---|
|0|OFF|No intervention point|
|1|REFTORQUE|Additive torque reference|
|2|REFVEL|Additive speed reference value|
|3|REFPOS|Additive position reference|
|4|MPPRO|Reference value for MotionProfile via P 2678[0] - CON_OUTSEL_MOPRO|
|5|REFVEL_RAMP|Additive speed setpoint on ramp|

When selecting the additive setpoints (1-3 and 5), it is important to make sure that they are connected to the respective position in the control structure using internal units (see ""Image 7.46: Schematic of process controller"").

The conversion details for converting internal units to user-specific units must be gathered from the configured user units. ",What types of signals can the test signal generator in the 'MSD ServoDrive - DeviceHelp' document produce?,A5,"Multiple signal types, such as sine and triangle waves, as well as sweep and PRBS signals, can be produced.",2.484375,2.5625,3.59375,1.4296875,0.59375
