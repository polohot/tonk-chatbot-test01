,NODE_FILE_NAME,NODE_NUMBER,NODE_HASH,NODE_TEXT,Q,A_NUMBER,A,helpfulness,correctness,coherence,complexity,verbosity
0,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How does the 'MSD ServoDrive - DeviceHelp' document describe the position control of a hydraulic cylinder?,A1,"Position control is achieved by directly influencing the cylinder's position with controlled volumetric flow rate, using a position sensor for accuracy.",1.546875,1.7734375,3.421875,1.3984375,0.359375
1,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How does the 'MSD ServoDrive - DeviceHelp' document describe the position control of a hydraulic cylinder?,A2,"The document explains that hydraulic cylinder position is controlled via volumetric flow rate, with position sensors providing precise location feedback.",1.4765625,1.6328125,3.375,1.4140625,0.484375
2,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How does the 'MSD ServoDrive - DeviceHelp' document describe the position control of a hydraulic cylinder?,A3,"According to 'MSD ServoDrive - DeviceHelp', position control involves adjusting volumetric flow rate based on feedback from a mounted position sensor.",1.6796875,2.0625,3.578125,1.3671875,0.326171875
3,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How does the 'MSD ServoDrive - DeviceHelp' document describe the position control of a hydraulic cylinder?,A4,"Position control, as detailed in the document, utilizes volumetric flow rate adjustments guided by sensor feedback to achieve desired cylinder positioning.",1.6640625,1.828125,3.390625,1.6015625,0.3984375
4,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How does the 'MSD ServoDrive - DeviceHelp' document describe the position control of a hydraulic cylinder?,A5,The 'MSD ServoDrive - DeviceHelp' describes hydraulic cylinder position control as managing volumetric flow rate with sensor inputs for exact positioning.,1.1484375,1.3984375,3.28125,1.3984375,0.296875
5,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is position monitoring implemented in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A1,Position monitoring involves setting a tracking error limit and defining a position window to stop motion and indicate completion status.,1.4296875,1.4609375,3.265625,1.2734375,0.388671875
6,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is position monitoring implemented in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A2,The document outlines position monitoring by establishing tracking error limits and position windows for motion control and status feedback.,1.34375,1.4921875,3.25,1.34375,0.3671875
7,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is position monitoring implemented in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A3,"According to 'MSD ServoDrive - DeviceHelp', monitoring is achieved through tracking error settings and position windows to manage motion and feedback.",1.4609375,1.75,3.453125,1.390625,0.3984375
8,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is position monitoring implemented in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A4,"In the document, position monitoring uses tracking error thresholds and defined windows to control movement and provide completion indicators.",1.390625,1.4140625,3.234375,1.359375,0.458984375
9,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is position monitoring implemented in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A5,The 'MSD ServoDrive - DeviceHelp' describes position monitoring with tracking error and window settings to regulate motion and signal positioning status.,1.21875,1.1796875,3.15625,1.4140625,0.3203125
10,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is the speed of a hydraulic cylinder controlled according to the 'MSD ServoDrive - DeviceHelp' document?,A1,"The speed is controlled by adjusting the volumetric flow rate into the cylinder, with precision set via a linear position sensor.",2.15625,2.25,3.71875,1.3984375,0.435546875
11,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is the speed of a hydraulic cylinder controlled according to the 'MSD ServoDrive - DeviceHelp' document?,A2,"According to the document, cylinder speed is directly influenced by the controlled volumetric flow rate, with adjustments based on sensor feedback.",1.984375,2.1875,3.578125,1.5234375,0.51171875
12,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is the speed of a hydraulic cylinder controlled according to the 'MSD ServoDrive - DeviceHelp' document?,A3,The 'MSD ServoDrive - DeviceHelp' explains that cylinder speed is determined by the volumetric flow rate and monitored via a position sensor for accuracy.,1.8515625,2.03125,3.625,1.4375,0.625
13,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is the speed of a hydraulic cylinder controlled according to the 'MSD ServoDrive - DeviceHelp' document?,A4,"Speed control of a hydraulic cylinder involves setting the volumetric flow rate, as detailed in the document, with sensor inputs ensuring precise adjustments.",1.6796875,1.8359375,3.484375,1.453125,0.5625
14,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",How is the speed of a hydraulic cylinder controlled according to the 'MSD ServoDrive - DeviceHelp' document?,A5,"In the document, hydraulic cylinder speed is managed through volumetric flow rate control, enhanced by feedback from a linear position sensor.",1.5625,1.7109375,3.484375,1.359375,0.345703125
15,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the digital filters used for in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A1,"Digital filters are used for special applications, such as feeding back acceleration to the position controller, enhancing system response.",2.359375,2.359375,3.65625,1.3984375,0.4375
16,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the digital filters used for in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A2,"The document mentions digital filters for specific needs, like acceleration feedback to the position controller, improving control dynamics.",1.609375,1.7109375,3.40625,1.2734375,0.38671875
17,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the digital filters used for in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A3,"According to 'MSD ServoDrive - DeviceHelp', digital filters serve specialized functions, including acceleration feedback for refined position control.",2.015625,2.0625,3.53125,1.359375,0.416015625
18,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the digital filters used for in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A4,"In the document, digital filters are applied for unique requirements, such as integrating acceleration feedback into the position control loop.",2.265625,2.21875,3.625,1.34375,0.4375
19,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the digital filters used for in the 'MSD ServoDrive - DeviceHelp' hydraulic system?,A5,"The 'MSD ServoDrive - DeviceHelp' highlights digital filters' role in advanced applications, like enhancing position control with acceleration feedback.",1.2734375,1.4140625,3.265625,1.34375,0.423828125
20,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the two alternative control structures for cylinder speed control mentioned in 'MSD ServoDrive - DeviceHelp'?,A1,The document describes controlling cylinder speed via a PI controller and through a model-based approach with feed-forward control.,2.84375,2.984375,3.84375,1.578125,0.56640625
21,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the two alternative control structures for cylinder speed control mentioned in 'MSD ServoDrive - DeviceHelp'?,A2,Two methods are outlined: direct control via a PI controller and using the cylinder model with displacement volume for feed-forward control.,1.9296875,1.9453125,3.484375,1.515625,0.58984375
22,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the two alternative control structures for cylinder speed control mentioned in 'MSD ServoDrive - DeviceHelp'?,A3,"According to 'MSD ServoDrive - DeviceHelp', alternatives include a PI controller for direct speed control and a model-based method incorporating feed-forward calculations.",3.15625,3.21875,3.75,1.6875,0.8203125
23,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the two alternative control structures for cylinder speed control mentioned in 'MSD ServoDrive - DeviceHelp'?,A4,The document presents PI controller-based speed control and a feed-forward control method utilizing cylinder model and displacement volume as the two structures.,2.640625,2.8125,3.671875,1.5703125,0.68359375
24,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What are the two alternative control structures for cylinder speed control mentioned in 'MSD ServoDrive - DeviceHelp'?,A5,"In 'MSD ServoDrive - DeviceHelp', cylinder speed can be controlled either strictly by a PI controller or through a model and feed-forward control approach.",2.75,2.84375,3.625,1.6640625,0.69140625
25,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What does the 'MSD ServoDrive - DeviceHelp' document say about position control without volumetric flow control?,A1,"It mentions using a PI controller and constant speed feed-forward control when cylinder geometry is unknown, adjusting for different cylinder surfaces.",1.2578125,1.1796875,3.21875,1.34375,0.5234375
26,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What does the 'MSD ServoDrive - DeviceHelp' document say about position control without volumetric flow control?,A2,"The document describes a method using PI control and constant speed feed-forward for position control in absence of volumetric flow control, adapting to cylinder areas.",1.7265625,1.828125,3.359375,1.640625,0.6015625
27,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What does the 'MSD ServoDrive - DeviceHelp' document say about position control without volumetric flow control?,A3,"For unknown cylinder geometries, 'MSD ServoDrive - DeviceHelp' suggests a PI controller with constant speed feed-forward, modified for surface differences.",1.203125,1.203125,3.1875,1.3671875,0.474609375
28,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What does the 'MSD ServoDrive - DeviceHelp' document say about position control without volumetric flow control?,A4,"Position control without volumetric flow control, per the document, employs a PI controller and feed-forward, with parameters adjusted for cylinder surface variations.",1.6171875,1.7421875,3.390625,1.671875,0.5546875
29,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What does the 'MSD ServoDrive - DeviceHelp' document say about position control without volumetric flow control?,A5,"The 'MSD ServoDrive - DeviceHelp' details using a PI controller and constant speed feed-forward for position control when volumetric flow control isn't feasible, accounting for cylinder geometry.",1.7890625,1.9375,3.390625,1.53125,0.8125
30,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What example does the 'MSD ServoDrive - DeviceHelp' document provide for configuring a servo pump?,A1,"It provides an example of configuring parameters for pressure and pump speed control, starting with motor and encoder settings.",2.046875,2.21875,3.484375,1.46875,0.515625
31,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What example does the 'MSD ServoDrive - DeviceHelp' document provide for configuring a servo pump?,A2,"The document includes an example detailing the setup for pressure and speed control of a servo pump, beginning with basic motor configurations.",2.171875,2.25,3.546875,1.453125,0.5078125
32,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What example does the 'MSD ServoDrive - DeviceHelp' document provide for configuring a servo pump?,A3,"An example in 'MSD ServoDrive - DeviceHelp' walks through parameter settings for servo pump operation, focusing on pressure and speed control.",1.671875,1.796875,3.390625,1.40625,0.44921875
33,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What example does the 'MSD ServoDrive - DeviceHelp' document provide for configuring a servo pump?,A4,"For servo pump configuration, the document presents an example emphasizing pressure and speed control parameters after initial motor setup.",1.9296875,2.03125,3.390625,1.5078125,0.515625
34,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What example does the 'MSD ServoDrive - DeviceHelp' document provide for configuring a servo pump?,A5,"The 'MSD ServoDrive - DeviceHelp' offers a configuration example for servo pumps, outlining steps for pressure and speed control following motor adjustments.",1.625,1.859375,3.46875,1.4453125,0.58203125
35,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is required for position control with pressure limitation in the 'MSD ServoDrive - DeviceHelp' system?,A1,The system requires a properly adjusted pressure control and the selection of a specific control mode for pressure limitation during positioning.,1.59375,1.5703125,3.375,1.34375,0.515625
36,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is required for position control with pressure limitation in the 'MSD ServoDrive - DeviceHelp' system?,A2,"For position control with pressure limitation, the document specifies the need for adjusted pressure control and activation of a particular control structure.",1.671875,1.7421875,3.390625,1.5,0.53125
37,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is required for position control with pressure limitation in the 'MSD ServoDrive - DeviceHelp' system?,A3,"According to 'MSD ServoDrive - DeviceHelp', implementing position control with pressure limitation involves configuring pressure control and choosing the correct mode.",1.3125,1.6171875,3.34375,1.296875,0.388671875
38,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is required for position control with pressure limitation in the 'MSD ServoDrive - DeviceHelp' system?,A4,The document outlines that position control with pressure limitation necessitates pre-set pressure controls and the selection of an appropriate operational mode.,1.828125,1.890625,3.484375,1.484375,0.51171875
39,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is required for position control with pressure limitation in the 'MSD ServoDrive - DeviceHelp' system?,A5,"In 'MSD ServoDrive - DeviceHelp', achieving position control with pressure limits requires properly adjusted pressure settings and mode selection for limitation.",1.515625,1.5625,3.296875,1.4140625,0.44921875
40,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is the purpose of the pressure regulator in the 'MSD ServoDrive - DeviceHelp' document?,A1,"The pressure regulator is used to limit the maximum permissible pressure during operations, ensuring system safety and efficiency.",2.625,2.640625,3.71875,1.3828125,0.57421875
41,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is the purpose of the pressure regulator in the 'MSD ServoDrive - DeviceHelp' document?,A2,"In the 'MSD ServoDrive - DeviceHelp', the pressure regulator's role is to control and limit pressure within specified parameters to protect the hydraulic system.",2.6875,2.71875,3.765625,1.4609375,0.74609375
42,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is the purpose of the pressure regulator in the 'MSD ServoDrive - DeviceHelp' document?,A3,"To provide safety and control, the pressure regulator in the document ensures pressure does not exceed maximum permissible levels during hydraulic operations.",2.328125,2.375,3.578125,1.390625,0.61328125
43,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is the purpose of the pressure regulator in the 'MSD ServoDrive - DeviceHelp' document?,A4,"The document specifies the pressure regulator's function as maintaining pressure within safe and operational limits, crucial for system integrity.",2.390625,2.4375,3.59375,1.3125,0.59375
44,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What is the purpose of the pressure regulator in the 'MSD ServoDrive - DeviceHelp' document?,A5,"As detailed in 'MSD ServoDrive - DeviceHelp', the pressure regulator is implemented to manage and restrict pressure levels during hydraulic system operations.",2.171875,2.265625,3.671875,1.3359375,0.50390625
45,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What prerequisites are needed for speed control in the hydraulic system described in 'MSD ServoDrive - DeviceHelp'?,A1,"Prerequisites include proper parametrization of volumetric flow rate control, leakage compensation, and knowledge of cylinder geometries.",1.9453125,1.921875,3.53125,1.6171875,0.3359375
46,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What prerequisites are needed for speed control in the hydraulic system described in 'MSD ServoDrive - DeviceHelp'?,A2,"The document states that speed control requires configured volumetric flow rate and leakage compensation, along with set cylinder geometries.",2.421875,2.46875,3.609375,1.4296875,0.490234375
47,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What prerequisites are needed for speed control in the hydraulic system described in 'MSD ServoDrive - DeviceHelp'?,A3,"For speed control, 'MSD ServoDrive - DeviceHelp' mentions the need for adjusted volumetric flow rate control, leakage settings, and cylinder area parameters.",1.8046875,1.96875,3.65625,1.4765625,0.57421875
48,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What prerequisites are needed for speed control in the hydraulic system described in 'MSD ServoDrive - DeviceHelp'?,A4,"Effective speed control in the hydraulic system, as per the document, depends on pre-set volumetric flow rate controls, leakage compensations, and cylinder dimensions.",2.046875,2.0,3.484375,1.625,0.546875
49,msd_servo_drive.txt,64,3378a1ee5698d0addd882b0306f74c4d77ea7753bb7fec0dc0cf78b1f4d1dd8a,"Moreover, the pressure regulator does not need to be parametrized for this control mode.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 200

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive   - DeviceHelp      201

| | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|
| | |2850|4|Tp|ms|Integral-action time|
| | |2850|5|pMin|bar|Minimum permissible pressure|
| | |2850|6|pMax|bar|Maximum permissible pressure|
| | |2850|7|QMin|l/min|Minimum flow rate|
| | |2850|8|QMax|l/min|Maximum flow rate|
| | |2850|9|PressWindow|bar|Pressure control parameters|
| | |2850|10|decmpLvl|bar|Level for active decompression|
| | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | |2850|12|pActScale| |Scaling for pAct|
| | |2850|13|pAct2Scale| |Scaling for pAct2|
| | |2850|14|pRange_k|%|Pressure range threshold|
| | |2850|15|pRange_midpoint|bar|Pressure range midpoint|

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters (continue)

# 7.11.9 Speed control

The speed of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate that is flowing in. The cylinder speed can be determined by means of a linear position sensor which is coupled to the cylinder. The values from the cylinder model and the cylinder speed allow the steady-state volumetric flow rate to be set with precision. (P 2840.13 - AltSpdCon = 0)

| | | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|---|
|2849| |HYD_Lfe| |Leakage flow estimate| | | | |
|2849|0|lfe_Qmin|l/min|Leakage flow estimate: minimum value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage flow estimate: maximum value| | | | |
|2849|2|lfe_K|1/ms|Leakage flow estimate: gain| | | | |
|2849|3|lfe_Tn|ms|Leakage flow estimate: integration time constant| | | | |
|2850| |HYD_PressCon| |Hydraulic pressure control parameters| | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |
|2850|2|Tn|ms|Integration time constant| | | | |
|2850|3|Tv|ms|Differential time constant| | | | |

Table 7.82:   “Hydraulic - Volumetric flow rate” parameters

Within this context, it is important to take into account that the sign will be reversed in the relationship between the volumetric flow rate and the speed and that, due to the different piston/annulus area, the relationship will change as well. The actuation of a changeover valve, as well as its consideration for the cylinder positioning, are part of the hydraulic package.

The prerequisite for speed control is that the volumetric flow rate control and the leakage compensation be set and parametrized. The SpeedCon(2) control mode must be selected to allow activation of the speed control mode. In addition, the cylinder geometries (P 2852[0] -cylArea1, P 2852[2] - cylArea2) must be known and set accordingly.

To provide speed control with pressure limitation, a special mode with a downstream pressure regulator has been implemented. In this case, the pressure limitation as well as the scaling of the pressure limitation are in effect for the individual motion blocks (P 2840.13 - AltSpdCon = 1). The prerequisite for cylinder speed control with active pressure limitation is that the pressure control be properly adjusted.

For cylinder speed control, there is a choice of two further control structures. These two alternative control types are described below. A further option is to control the cylinder speed directly via a PI controller (P 2840.13 AltSpdCon = 2). In this case, the speed is not calculated using the cylinder model and the displacement volume with feed-forward control, but is governed strictly by the PI controller. In order to take the different cylinder volumes for the ring and piston sides of the cylinder into account, two scaling factors.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

7 Control

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp 203

(P 2852.10 KpScale, P 2852.11 KpScaleNeg) for the positive and negative cylinder directions can be used to influence the gain of the controller. KpScaleNeg becomes active with the bit for the negative cylinder volume (P 2863 Hyd_TabCtrl Bit 0).

# NOTE

In this control mode, the volumetric flow rate and pressure limitation are not active.

| | | | |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|---|---|---|
| | | | |2850|2|Tn|ms|Integration time constant|
| | | | |2850|3|Tv|ms|Differential time constant|
| | | | |2850|4|Tp|ms|Integral-action time|
| | | | |2850|5|pMin|bar|Minimum permissible pressure|
| | | | |2850|6|pMax|bar|Maximum permissible pressure|
| | | | |2850|7|QMin|l/min|Minimum flow rate|
| | | | |2850|8|QMax|l/min|Maximum flow rate|
| | | | |2850|9|PressWindow|bar|Pressure control parameters|
| | | | |2850|10|decmpLvl|bar|Level for active decompression|
| | | | |2850|11|decmpRate|bar/s|Rate for active decompression|
| | | | |2850|12|pActScale| |Scaling for pAct|
| | | | |2850|13|pAct2Scale| |Scaling for pAct2|
| | | | |2850|14|pRange_k|%|Pressure range threshold|
| | | | |2850|15|pRange_midpoint|bar|Pressure range midpoint|
| | | | |2852| |HYD_SpdCon| |Speed Controller Parameters|
| | | | |2852|0|cylArea1|cm^2|Speed control parameter|
| | | | |2852|1|lfe_K_scale| |Leakage Flow Estimator: Gain scaling|
| | | | |2852|2|cylArea2|cm^2|Cylinder displacement (option 2, use neg. value for neg. direction)|
| | | | |2852|3|lfe_K_scale2| |Leakage Flow Estimator: Gain scaling (option 2)|
| | | | |2852|4|res| |Reserved|
| | | | |2852|5|res| |Reserved|
| | | | |2852|6|res| |Reserved|
| | | | |2852|7|unit_scale|um/rev|Hydraulic physical unit scaling|
| | | | |2852|8|Kp|1/min|Speed control integration time constant|
|2849|HYD_Lfe| |Leakage flow estimation| | | | | |
|2849|0|lfe_Qmin|l/min|Leakage Flow Estimator: Min value| | | | |
|2849|1|lfe_Qmax|l/min|Leakage Flow Estimator: Max value| | | | |
|2849|2|lfe_K|1/ms|Leakage Flow Estimator: Gain| | | | |
|2849|3|lfe_Tn|ms|Leakage Flow Estimator: Integrator time constant| | | | |
|2850|HYD_PressCon| |Pressure control parameters| | | | | |
|2850|0|Kp|rpm/bar|Gain| | | | |
|2850|1|KpScale| |Gain scaling| | | | |

# Table 7.83: “Hydraulic - Speed control” parameters

# 7.11.10 Position control

Position control with volumetric flow feed forward control:

The position of a hydraulic cylinder can be influenced directly with the controlled volumetric flow rate. If a position sensor is mounted on the cylinder, it can be used to determine the exact position of the cylinder. The position is preset roughly by means of a volumetric flow control. The feed-forward control variable is calculated in the hydraulic motion profile using the cylinder model and the displacement volume of the pump. Alternatively, the feed-forward control variable can also be specified in mm/s via a higher-level control system P 2881[0] HYD_AddValues. For this, selector P 2880[0] PosCon_RefSpdFF must be switched to ""(1) from EXTERNAL"". For better optimization and analysis, the feed forward control value can be viewed in P 2843[30] RefSpdFF as the actual value or can be recorded in the scope. The scaling factor of the feed-forward control variable P2842[2] SFF remains active. The remaining control difference can then be stabilized accurately using a steady-state PI controller.

If, in the case of double-acting cylinders, positioning is to be performed in both the positive and negative directions, the simplest application will require at least one changeover valve. Care must be taken to ensure that the force direction and valve position are compatible because otherwise an inadmissibly high volumetric flow rate and pressure will be generated by the position controller due to the unchanged control deviation. The actuating valves can be controlled in different modes (see Section ""Hydraulic Motion profile"" on page 190). Moreover, the volumetric flow rate control must be parametrized and the cylinder geometries must be configured.

# Position control with pressure limitation:

If it is necessary to limit the maximum permissible pressure during the positioning operation, the control structure can be expanded to include a higher-order pressure regulator (P 2840.12 - AltPosCon = PosCon_pLimit(2)). The control structure of the pressure limiting controller differs from that of the standard pressure controller, but the same parameters are used for gain and integral-action time. The structure does not allow the controller to be operated without the integrating part. Consequently, it makes sense to work with a gain factor that is not too high so as to avoid exciting the control circuit. If the pressure needs to be restricted for a certain positioning operation, a partial process or an individual motion block, a scaling factor P 2872 - HYD_TabLimit can be used to adapt the pressure limitation for each motion block.

NOTE

- To simplify the control circuit, the I component (P 2848[1] - Tn) of the controller must be set to 10000 ms and thereby has no influence on the control. The position control can thus be operated by means of feed forward control and P controller.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 204

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 205

# Image 7.75: “Hydraulic - position control” screen PosCon_pLimit(2)

# Image 7.76: “Hydraulic - position control” screen PosCon(1)

# Position control without volumetric flow control:

If the cylinder geometry is unknown, then no feed-forward control value can be calculated for the volumetric feed-forward control. In this case, a PI controller and a constant speed feed-forward control can be used to represent the position control (P 2840.12 AltPosCon = PosCon_nFF(1)). However, the different surfaces of the cylinder geometry must be taken into account because the different volumes of the cylinder chambers cause different control paths. To do so, the control parameters of the position control must be adapted. The control can be designed to suit the different cylinder surface sizes using parameters P 2870.3 KpScale and P 2870.5 KpScaleNeg.

# Position control with tracking error switchover:

For special applications, the control parameters can be changed as a function of a tracking error limit. To do so, a switchover limit (P 2878.2 PosWindowP) must be configured in which the controller gain is influenced by means of a second scaling factor (P 2878.1 KpScale2). In addition, the I-component can also be influenced by means of a scaling factor which becomes active as of a certain switchover limit. The feed forward control as well as the pressure limitation continue to remain active for this control structure.

# 7 Control

PosHysLo, P 2870.7 PosHysUp). The position controller then positions into the position window but only corrects the position again after a departure from the set hysteresis range.

Image 7.77: Hydraulic - “position control"" PosCon_TrackingError(3))

Image 7.78: Position tracking error and position window

# Position monitoring:

A tracking error can be set to monitor the positioning operation. If this tracking error is exceeded due to an increased load or an error in the system, the controller switches off and reports an error reaction. Moreover, continuous readjustment of the position can be prevented by defining a position window (P 2870.0 PosWindowLo, P 2870.1 PosWindowUp). When the actual position reaches this window, the motion is stopped and the cylinder is tensioned by switching off the directional valves. In addition, the “InWindow” bit is set in the status word to provide feedback concerning the completion of the positioning operation. It is important to bear in mind that the position window is turned in dependence on the direction of the positioning operation (see Image 7.79: Position window and position hysteresis). If no readjustment of the position is desired, it is also possible to define a hysteresis in addition to the position window (P 2870.6).

Image 7.79: Position window and position hysteresis

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 206

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description| |
|---|---|---|---|---|
|2848|HYD_PosCon|Position Controller Parameters| | |
|2848|0|Kp|1/min|Gain of position controller|
|2848|1|Tn|ms|Position control integration time constant|
|2848|2|SFF|%|Speed feedforward scaling|
|2848|3|PosDiffMax|um|Position tracking error monitoring|

Table 7.84: “Hydraulic - position control” parameters

# 7.11.11 Digital filter Hydraulics

For special applications the hydraulics firmware has two biquad filters connected in series with different input and output variables. For example, acceleration can be fed back to the position controller.

Image 7.80: Digital Filter Hydraulics Screen

Via P 2876 HYD_AdvFilSel the filter can be activated and the input and output sizes can be selected.

The actual pressure value P 2843.1 pressAct in bar or the cylinder speed P 2843.23 ActSpd in rpm (Cyl_nAct(2)) or in mm/s (Cyl_ActSpd(3)) are available as input variables.

An additive speed setpoint (nFF(1)) or volume flow rate setpoint (volFF(2)) can be selected at the filter output. The speed reference value is connected to the output of the pressure control and the cylinder speed control. Selecting volFF(2) acts at the output of the pressure control with volumetric flow rate output and the subordinate.

# 7 Control

volumetric flow rate control of the position controller. In addition, the filter can be switched active or inactive for every control type via 6 bits in parameter P 2884 HYD_AdvFilCtrl (filter output is active if respective bit=1).

**Table 7.85: Advanced filter settings**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2877|HYD_AdvFilCoeff| |Advanced Filter Coefficients (electronic damping)|
|2877|0| |BiQuad filter 1: a1 Hydraulic advanced filter coefficient: filter 1, a1|
|2877|1| |BiQuad filter 1: a2 Hydraulic advanced filter coefficient: filter 1, a2|
|2877|2| |BiQuad filter 1: b0 Hydraulic advanced filter coefficient: filter 1, b0|
|2877|3| |BiQuad filter 1: b1 Hydraulic advanced filter coefficient: filter 1, b1|
|2877|4| |BiQuad filter 1: b2 Hydraulic advanced filter coefficient: filter 1, b2|
|2877|5| |BiQuad filter 1: c0 Hydraulic advanced filter coefficient: filter 1, c0|
|2877|6| |BiQuad filter 2: a1 Hydraulic advanced filter coefficient: filter 2, a1|
|2877|7| |BiQuad filter 2: a2 Hydraulic advanced filter coefficient: filter 2, a2|
|2877|8| |BiQuad filter 2: b0 Hydraulic advanced filter coefficient: filter 2, b0|
|2877|9| |BiQuad filter 2: b1 Hydraulic advanced filter coefficient: filter 2, b1|
|2877|10| |BiQuad filter 2: b2 Hydraulic advanced filter coefficient: filter 2, b2|
|2877|11| |BiQuad filter 2: c0 Hydraulic advanced filter coefficient: filter 2, c0|

The coefficients a1 to b2 can be calculated using a mathematical software tool or a coefficient calculator. The coefficients c0 serve as gain factors at the output of the respective filter. To evaluate the quality of the filter, two scope variables are available for input and output variables (P 2843.24 AdvFilterOut, P 2843.31 AdvFilterIn).

# 7.11.12 Example: Pressure and pump speed control

This example shows which parameter settings need to be configured in order to operate a servo pump with pressure and pump speed control. Before configuring the parameters for the hydraulic system, the settings for the motor and encoder need to be configured first. After this, “Torque control/Hydraulic control” must be selected as the control mode and the selection of the reference setpoint must be set to “Hydraulic profile” in the hydraulic basic settings.

**Table 7.86: Parameter P 2876 HYD_AdvFilSel**
|ID|Index Name|Unit|Description|
|---|---|---|---|
|2876|HYD_AdvFilSel| |Advanced Filter Selection|
|2876|0| |Type Hydraulic advanced filter: type (0=off), (electronic damping)|
|2876|1| |Source (input filter 1) Selector of input to filter 1|
| | | |OFF (0) = no effect on control|
| | | |PressAct (1) = actual pressure value in bar|
| | | |cyl_nACT (2) = cylinder speed in rpm|
| | | |CylSpeedAct (3) = cylinder speed in mm/s|
|2876|2| |Sink (output filter 2) Selector to output from filter 2|
| | | |OFF (0) = no effect on control|
| | | |nFF (1) = Additive speed setpoint in rpm|
| | | |VolFF (2) = Additive volumetric flow rate setpoint in rpm|

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 208

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 209

# Image 7.81: “Hydraulic basic settings” screen

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|300|0|CON_CfgCon|TCON (1)| |Select control mode|uint16|x|
|159|0|MPRO_CTRL_SEL|DS402 (5)| |Motion profile: selection|uint16|x|
|165|0|MPRO_REF_SEL|HYDRAULIC| |Motion profile: selection|uint16|x|

# Image 7.82: “Pump settings” screen

# Table 7.88: Settings for control mode and motion profile

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851| |HYD_Pump| | |Pump parameters| | |
|2851|0|displ|5.4|ccm/rev|Offset|float32| |
|2851|1|cTorque|0.0859437|Nm/bar|Torque constant|float32| |
|2851|2|pNom|250|bar|Nominal pressure|float32| |
|2851|3|nNom|1500|rpm|Rated speed|float32| |
|2851|4|etaVol|80|%|Volumetric efficiency at nominal pressure, rated speed|float32| |
|2851|5|nMin|0|rpm|Minimum speed|float32| |
|2851|6|nMax|2000|rpm|Maximum speed|float32| |
|2851|7|nCritical|200|rpm|Critical speed (@ nominal pressure)|float32| |
|2851|8|TCritical|10|s|Max. permissible time at low|float32| |

# Table 7.89: Pump data settings

# Table 7.90: analog inputs settings

|ID|Index|Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|---|
|2851|9|iGearPump|-1| |Gear ratio between pump and motor|float32| |
|2851|10|p0|20|bar|Max. permissible stationary pressure at a standstill|float32|ISA01|
|2851|11|cLeakage| |(l/min)/bar|Leakage constant|float32| |
|2851|12|stopramp| |(1/min)/s|Stop ramp (during valve switching etc.)|float32| |
|2851|13|tSwValve| |ms|Valve switching time|float32| |
|2851|14|pMin| |bar|Minimum pressure (depending on pump protection function)|float32| |
|2851|15|pMax| |bar|Maximum pressure (depending on pump protection function)|float32| |

In this example, the actual pressure values will be evaluated using analog inputs ISA00 and ISA01.

# Image 7.83: “Standard analog inputs” screen

# Image 7.84: Signal settings screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 210

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      211

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|2840|HYD_Cfg| | |Configure Hydraulic System Control| | |
|2850|HYD_PressCon|Hydraulics: Pressure regulation| | | | |
|1|pRefSrc|PROFILE (1)| |Hydraulics: Selection of pressure reference source|uint16| |
|3|pActCalc|PACTSEL (5)| |Hydraulic: Pressure actual value calculation method|uint16| |
|4|pMinSrc|PressCon (0)| |Minimum pressure source selector|uint16| |
|5|pMaxSrc|PressCon (0)| |Maximum pressure source selector|uint16| |
|6|QMinSrc|PressCon (0)| |Minimum flow rate source selector|uint16| |
|7|QMaxSrc|PressCon (0)| |Maximum flow rate source selector|uint16| |
|8|QActCalc|NONE (0)| |Flow rate calculation method|uint16| |
|9|QLeakEst|MEAS (0)| |Flow rate leakage estimation method| | |
|10|nRefSrc|PROFILE (1)| |Pump speed reference source|uint16| |

Table 7.91: Selectors settings

Table 7.92: Dynamism and limitation settings

The “Signal configuration” area is used to scale and limit the input variables for the selector from P 2845 - HYD_Input_Val again by using P 2846 - HYD_Input_Adapt. The results can be seen in P 2847 - HYD_Val.

The control dynamic performance and the pressure and volumetric flow rate limits for the pressure control are configured in P 2850 - HYD_PressCon.

Image 7.85: “Pressure control” screen

# Table 7.93: Scaling settings (continue)

|ID|Index Name|Value|Unit|Description|Type|PDO|
|---|---|---|---|---|---|---|
|8|pRef_Scale|1|bar|Scaling|float32| |
|9|pRef_Offset|0|bar|Offset|float32| |
|10|pRef_Min|-100|bar|Min|float32| |
|11|pRef_Max|100|bar|Max|float32| |
|20|nRef_Scale|1|1/min|Scaling|float32| |
|21|nRef_Offset|0|1/min|Offset|float32| |
|22|nRef_Min|-500|1/min|Min|float32| |
|23|nRef_Max|500|1/min|Max|float32| |

The hydraulic motion profile settings are configured using the motion block table. In this example, table index 0 is used for pressure control and table index 1 for pump speed control. ",What prerequisites are needed for speed control in the hydraulic system described in 'MSD ServoDrive - DeviceHelp'?,A5,"The 'MSD ServoDrive - DeviceHelp' outlines that speed control necessitates parametrized flow rate and leakage controls, plus accurate cylinder geometry settings.",1.8515625,1.8828125,3.53125,1.5,0.640625
