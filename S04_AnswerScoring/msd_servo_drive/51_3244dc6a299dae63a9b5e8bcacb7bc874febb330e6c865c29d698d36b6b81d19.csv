,NODE_FILE_NAME,NODE_NUMBER,NODE_HASH,NODE_TEXT,Q,A_NUMBER,A,helpfulness,correctness,coherence,complexity,verbosity
0,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document describe the procedure for using the speed observer?,A1,"The procedure involves ensuring the mass inertia of the system is known, setting P 350[0] - SEL_ObserverMethod and P 354[0] - CON_SCALC_ObsDesignAssi, and starting the control with the observer time constant P 353[0] - Tf.",2.25,2.6875,3.65625,1.7421875,0.8125
1,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document describe the procedure for using the speed observer?,A2,"It requires knowing the system's mass inertia, selecting the observer method and design assistant, and configuring the observer time constant based on the previously used speed filter's time constant.",2.59375,2.84375,3.6875,1.6796875,0.87109375
2,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document describe the procedure for using the speed observer?,A3,"The document outlines starting with the mass inertia known, selecting appropriate observer settings, and initializing the control with a specified observer time constant.",1.5625,1.59375,3.34375,1.4609375,0.57421875
3,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document describe the procedure for using the speed observer?,A4,"Steps include verifying the mass inertia, setting observer parameters, and initiating control with an initial observer time constant value.",1.46875,1.4765625,3.375,1.3515625,0.48828125
4,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document describe the procedure for using the speed observer?,A5,"The procedure details configuring the observer by first ensuring the mass inertia is known, then setting the observer method and design assistant, and finally adjusting the observer time constant.",1.921875,2.140625,3.59375,1.578125,0.703125
5,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document suggest optimizing the speed controller?,A1,"By means of step responses, ensuring the motor model is precisely adapted to the individual motor and adjusting the controller to the moment of inertia and rigidity of the mechanism.",2.78125,2.84375,3.765625,1.453125,0.609375
6,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document suggest optimizing the speed controller?,A2,"Optimization involves using step responses for adjustment, with precise adaptation of the motor model and consideration of the system's moment of inertia and rigidity.",2.015625,2.09375,3.53125,1.59375,0.66015625
7,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document suggest optimizing the speed controller?,A3,"The document recommends optimizing through step responses, adapting the motor model accurately, and tailoring the speed controller to the mechanical system's characteristics.",2.34375,2.59375,3.671875,1.4453125,0.60546875
8,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document suggest optimizing the speed controller?,A4,"It suggests step response optimization, requiring accurate motor model adaptation and controller adjustment based on mechanical properties.",1.8828125,2.0,3.515625,1.46875,0.51171875
9,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How does the 'MSD ServoDrive - DeviceHelp' document suggest optimizing the speed controller?,A5,"Optimization is achieved by step responses, with emphasis on motor model accuracy and controller settings reflecting the mechanical system's inertia and rigidity.",1.84375,2.03125,3.546875,1.5,0.52734375
10,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How is pre-control of the acceleration torque described in the 'MSD ServoDrive - DeviceHelp' document?,A1,"Pre-control relieves the speed controller by using the known mass inertia referred to the motor shaft, automatically applied if P 1516[0] - SCD_Jsum is not zero.",2.0625,2.171875,3.4375,1.6875,0.66796875
11,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How is pre-control of the acceleration torque described in the 'MSD ServoDrive - DeviceHelp' document?,A2,"It optimizes control response by pre-controlling acceleration torque based on the system's mass inertia, automatically utilized when P 1516[0] - SCD_Jsum is set.",2.515625,2.625,3.5625,1.703125,0.7734375
12,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How is pre-control of the acceleration torque described in the 'MSD ServoDrive - DeviceHelp' document?,A3,"The document explains that acceleration torque pre-control eases the speed controller's load, leveraging the system's mass inertia when specified.",2.109375,2.234375,3.578125,1.546875,0.58984375
13,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How is pre-control of the acceleration torque described in the 'MSD ServoDrive - DeviceHelp' document?,A4,"Pre-control involves utilizing the system's mass inertia for acceleration torque, automatically activated with a non-zero P 1516[0] - SCD_Jsum value.",1.859375,1.9296875,3.375,1.640625,0.68359375
14,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",How is pre-control of the acceleration torque described in the 'MSD ServoDrive - DeviceHelp' document?,A5,"It details how pre-control improves response by applying acceleration torque based on mass inertia, automatically when P 1516[0] - SCD_Jsum is configured.",2.140625,2.171875,3.421875,1.625,0.7109375
15,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the considerations for field weakening in asynchronous motors according to the 'MSD ServoDrive - DeviceHelp' document?,A1,"Considerations include accurate motor parameters, especially main inductance dependency on magnetizing current, and performing motor identification and optimization in the basic setting range.",2.09375,2.140625,3.484375,1.5,0.56640625
16,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the considerations for field weakening in asynchronous motors according to the 'MSD ServoDrive - DeviceHelp' document?,A2,The document emphasizes the need for precise motor parameters and initial optimization and identification for effective field weakening.,1.53125,1.6484375,3.46875,1.3828125,0.4140625
17,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the considerations for field weakening in asynchronous motors according to the 'MSD ServoDrive - DeviceHelp' document?,A3,Field weakening requires detailed motor parameter knowledge and preliminary optimization and identification steps for proper implementation.,1.5390625,1.671875,3.390625,1.328125,0.326171875
18,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the considerations for field weakening in asynchronous motors according to the 'MSD ServoDrive - DeviceHelp' document?,A4,It highlights the importance of accurate motor data and initial setup procedures for successful field weakening application.,1.25,1.296875,3.28125,1.265625,0.4296875
19,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the considerations for field weakening in asynchronous motors according to the 'MSD ServoDrive - DeviceHelp' document?,A5,The document advises thorough motor parameter understanding and preparatory optimization and identification for field weakening in asynchronous motors.,1.3828125,1.46875,3.359375,1.3515625,0.41015625
20,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the key parameters for setting the speed control loop in the 'MSD ServoDrive - DeviceHelp' document?,A1,"The key parameters include speed controller gain (P 320 - CON_SCON_Kp), speed control integration time constant (P 321 - CON_SCON_Tn), and speed control gain scaling factor (P 322 - CON_SCON_KpScale).",2.890625,3.140625,3.828125,1.671875,0.76171875
21,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the key parameters for setting the speed control loop in the 'MSD ServoDrive - DeviceHelp' document?,A2,"To set the speed control loop, adapt the speed controller gain to the existing external mass inertia and use the automatic mass inertia definition function if necessary.",1.3203125,1.1875,3.21875,1.28125,0.34765625
22,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the key parameters for setting the speed control loop in the 'MSD ServoDrive - DeviceHelp' document?,A3,"Key parameters involve adapting the speed controller gain to the moment of inertia and the rigidity of the mechanism, with all parameters taking effect online.",1.484375,1.34375,3.234375,1.25,0.408203125
23,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the key parameters for setting the speed control loop in the 'MSD ServoDrive - DeviceHelp' document?,A4,"The document specifies adapting the speed controller gain to the external mass inertia, either using known data or the automatic mass inertia definition function.",1.703125,1.71875,3.359375,1.3984375,0.37890625
24,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the key parameters for setting the speed control loop in the 'MSD ServoDrive - DeviceHelp' document?,A5,"For speed control loop setting, the document emphasizes the importance of adapting the speed controller gain to the system's moment of inertia, reduced to the motor if defined manually.",1.5703125,1.609375,3.296875,1.5625,0.44921875
25,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the steps for configuring the digital filter in the 'MSD ServoDrive - DeviceHelp' document?,A1,"Steps include setting the scope to isq, selecting the shortest sampling time, creating a scope plot without notch filtering, performing FFT analysis, selecting a filter, entering middle/limit frequency and width, and creating a filtered scope plot.",2.03125,2.1875,3.453125,1.5,0.74609375
26,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the steps for configuring the digital filter in the 'MSD ServoDrive - DeviceHelp' document?,A2,"Configuring involves initial scope settings, FFT analysis for disturbance frequency, filter selection, frequency and width entry, and final filtered plot creation.",1.4453125,1.6796875,3.4375,1.4375,0.6171875
27,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the steps for configuring the digital filter in the 'MSD ServoDrive - DeviceHelp' document?,A3,"The document outlines a process starting with scope setup, followed by FFT analysis, filter selection and configuration, and concluding with filtered plot generation.",1.4375,1.625,3.40625,1.3515625,0.6015625
28,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the steps for configuring the digital filter in the 'MSD ServoDrive - DeviceHelp' document?,A4,"It details a method beginning with scope configuration, disturbance frequency identification via FFT, filter choice and setup, and ending with the production of a filtered plot.",1.2109375,1.375,3.296875,1.296875,0.60546875
29,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What are the steps for configuring the digital filter in the 'MSD ServoDrive - DeviceHelp' document?,A5,"The configuration steps encompass initial scope adjustments, FFT-based frequency analysis, precise filter selection and parameter entry, and the creation of a filtered output plot.",1.296875,1.4296875,3.359375,1.3984375,0.6015625
30,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What does the 'MSD ServoDrive - DeviceHelp' document say about the speed controller's execution?,A1,"It is executed as a PI controller with programmable gain (P-component) and integral-action time (I-component), optimized through rectangular reference steps and automatic controller optimization tools.",2.59375,2.734375,3.640625,1.6796875,0.546875
31,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What does the 'MSD ServoDrive - DeviceHelp' document say about the speed controller's execution?,A2,"The speed controller operates as a PI controller, featuring adjustable gain and integral-action time, and is optimized using predefined steps and automated tools.",1.8515625,2.0625,3.53125,1.359375,0.47265625
32,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What does the 'MSD ServoDrive - DeviceHelp' document say about the speed controller's execution?,A3,"Executed as a PI controller, it allows for programmable gain and integral-action time settings, with optimization facilitated by reference steps and wizard tools.",2.375,2.578125,3.671875,1.4609375,0.5859375
33,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What does the 'MSD ServoDrive - DeviceHelp' document say about the speed controller's execution?,A4,"The document describes the speed controller as a PI type with configurable components, optimized via step responses and automated optimization features.",2.03125,2.21875,3.53125,1.421875,0.46875
34,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What does the 'MSD ServoDrive - DeviceHelp' document say about the speed controller's execution?,A5,"It specifies that the speed controller functions as a PI controller, with adjustable parameters and optimization through step responses and automated processes.",2.109375,2.375,3.5625,1.390625,0.56640625
35,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the purpose of reducing gain at low speeds according to the 'MSD ServoDrive - DeviceHelp' document?,A1,To prevent undesirable oscillation of the speed controller at low or zero speeds by adjusting P 336 - CON_SCON_KpScaleSpeedZero.,2.25,2.34375,3.609375,1.453125,0.51171875
36,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the purpose of reducing gain at low speeds according to the 'MSD ServoDrive - DeviceHelp' document?,A2,"Reducing gain at low speeds helps mitigate oscillation tendencies in the speed controller, achieved through specific parameter settings.",2.734375,2.78125,3.875,1.5390625,0.64453125
37,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the purpose of reducing gain at low speeds according to the 'MSD ServoDrive - DeviceHelp' document?,A3,"The document explains that reducing gain at low speeds is necessary to avoid oscillations, with P 336 - CON_SCON_KpScaleSpeedZero playing a key role.",2.40625,2.6875,3.78125,1.5,0.6328125
38,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the purpose of reducing gain at low speeds according to the 'MSD ServoDrive - DeviceHelp' document?,A4,"It aims to stabilize the speed controller by reducing gain at low speeds, preventing oscillations through parameter adjustment.",2.578125,2.625,3.828125,1.40625,0.68359375
39,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the purpose of reducing gain at low speeds according to the 'MSD ServoDrive - DeviceHelp' document?,A5,The purpose is to ensure smooth operation by adjusting the speed controller's gain at low speeds to prevent oscillations.,2.625,2.640625,3.84375,1.3046875,0.54296875
40,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the role of the voltage controller in field weakening for synchronous motors in the 'MSD ServoDrive - DeviceHelp' document?,A1,"The voltage controller ensures adequate voltage reserves for speed control at higher speeds, with settings for gain (P 345[0] - CON_FM_VConKp) and reset time (P 346[0] - CON_FM_VConTn).",2.28125,2.34375,3.4375,1.8125,0.84375
41,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the role of the voltage controller in field weakening for synchronous motors in the 'MSD ServoDrive - DeviceHelp' document?,A2,"It maintains necessary voltage reserves for stable operation at elevated speeds, configurable through specific gain and reset time parameters.",2.15625,2.171875,3.40625,1.5859375,0.6015625
42,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the role of the voltage controller in field weakening for synchronous motors in the 'MSD ServoDrive - DeviceHelp' document?,A3,"The document describes the voltage controller as crucial for maintaining voltage reserves in field weakening, adjustable via gain and reset time settings.",2.046875,1.9765625,3.40625,1.6328125,0.6953125
43,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the role of the voltage controller in field weakening for synchronous motors in the 'MSD ServoDrive - DeviceHelp' document?,A4,"Its role is to guarantee sufficient voltage for high-speed operation, with parameters for gain and reset time allowing precise control.",2.125,2.109375,3.40625,1.546875,0.59375
44,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What is the role of the voltage controller in field weakening for synchronous motors in the 'MSD ServoDrive - DeviceHelp' document?,A5,"The voltage controller's function is to secure operational voltage at higher speeds, with configurable gain and reset time for optimal performance.",1.921875,1.984375,3.4375,1.5625,0.6015625
45,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What precautions does the 'MSD ServoDrive - DeviceHelp' document mention regarding field weakening for synchronous motors?,A1,"Precautions include ensuring the induced voltage does not exceed the device's overvoltage threshold to prevent destruction, requiring external safety measures if necessary.",2.265625,2.140625,3.53125,1.484375,0.72265625
46,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What precautions does the 'MSD ServoDrive - DeviceHelp' document mention regarding field weakening for synchronous motors?,A2,"The document warns against exceeding the overvoltage threshold during field weakening, advising additional safety measures to avoid damage.",2.109375,2.140625,3.59375,1.4140625,0.6328125
47,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What precautions does the 'MSD ServoDrive - DeviceHelp' document mention regarding field weakening for synchronous motors?,A3,"It cautions about the risks of induced voltage surpassing safe limits in field weakening, suggesting external safeguards for protection.",2.140625,2.203125,3.65625,1.34375,0.6640625
48,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What precautions does the 'MSD ServoDrive - DeviceHelp' document mention regarding field weakening for synchronous motors?,A4,"Precautions involve monitoring induced voltage to stay within safe bounds, with external precautions recommended for high-speed operations.",2.0,1.921875,3.640625,1.3671875,0.61328125
49,msd_servo_drive.txt,51,3244dc6a299dae63a9b5e8bcacb7bc874febb330e6c865c29d698d36b6b81d19,"Gain (KP)
2. Integral-action time (I)
3. Scaling factor for gain
4. With these filters it is possible to filter noise in the actual speed value and increase the attenuation of resonance frequencies.
5. Advanced speed control (observer), see Section ""Advanced speed control"" on page 133
6. Analysis of speed control, see Section ""Analysis of Speed control"" on page 137
7. Actual speed filter

Legend for “Speed controller” screen

# Adaptation of parameters

Acceleration and braking phases generate a variation which the speed control has to balance out. With speed pre-control the necessary acceleration or braking moment determined from the change in speed over time is applied to the output of the speed controller.

If the travel range is not limited, it is advisable to optimize the speed controller by means of step responses. In this, the motor model must be adapted precisely to the individual motor. In the standard motor data set, the speed controller is preset for a moderately stiff mechanical system. The speed controller may need to be adjusted to the moment of inertia and the rigidity of the mechanism.

All parameters take effect online. The scaling parameter P 322[0] - CON_SCON_KpScale is transferred in defined real time (according to the speed controller sampling time).

The following steps are needed to set the speed control loop depending on the application:

|No.|Action|
|---|---|
|1|Adapt the speed controller gain to the existing external mass inertia. For this, either the known moment of inertia from the motor data can be used directly or the automatic mass inertia definition function in the Motor Identification subject area can be used.|
|2|If the system's moment of inertia is defined manually, it must be reduced to the motor.|

Legend for “Relevant variables”

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2695|CON_SCON_ScaleTF| |Scaling filter time constant|
|2695|ScaleMaxSpeedFil|ms|Speed scaling filter time constant|
|2695|ScaleMaxTorqueFil|ms|Torque scaling filter time constant|
|320|CON_SCON_Kp|Nm/rpm|Speed control gain|
|321|CON_SCON_Tn|ms|Speed control integration time constant|
|322|CON_SCON_KpScale|%|Speed control gain scaling factor|
|351|CON_SCALC_TF|ms|Speed calculation filter time constant, speed control|
|371|CON_IP_RefTF|ms|Speed reference filter time constant (SCON mode)|

Table 7.12: “Speed controller” parameter

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 132

# 7 Control

# 7 Control

MOOG                          ID No.:CB40859-001 Date:11/2020                                                                                         MSD ServoDrive   - DeviceHelp      133

|ID|Index Name| |Unit|Description| |
|---|---|---|---|---|---|
|304|0|CON_SConTS|ms|Speed control sampling time| |
|2939|0|CON_SCON_TorqueTF|ms|Actual torque filter time| |
| | | | |Digital filter / speed controller settings| |
|325| |CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
|325|0|CON_SCON_FilterFreq|Hz|1st center/cutoff| |
|325|1|CON_SCON_FilterFreq|Hz|1st width| |
|325|2|CON_SCON_FilterFreq|Hz|2nd center/cutoff| |
|325|3|CON_SCON_FilterFreq|Hz|2nd width| |
|326|0|CON_SCON_FilterAssi| |Digital filter design assistant| |
|327| |CON_SCON_FilterPara| |Coefficients of digital filter| |
|327|0|FilterPara b0| |b0*x(k)| |
|327|1|FilterPara b1| |b1*x(k-1)| |
|327|2|FilterPara b2| |b2*x(k-2)| |
|327|3|FilterPara b3| |b3*x(k-3)| |
|327|4|FilterPara b4| |b4*x(k-4)| |
|327|5|FilterPara a1| |a1*y(k-1)| |
|327|6|FilterPara a2| |a2*y(k-2)| |
|327|7|FilterPara a3| |a3*y(k-3)| |
|327|8|FilterPara a4| |a4*y(k-4)| |
|1550|0|SCD_NotchType| |Adaptive Notch filter: Method| |
|1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word| |
|1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies| |
|1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency| |
|1552|1|SCD_NotchLambda|Hz/min^-2|Adaptive Notch filter: Coefficient| |
|1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency| |
|1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency| |
|1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency change (in each iteration)| |

# 7.4.1.1 Speed observer

The speed observer is a simple model of the path with motor current as input, as estimation of load torque and feedback of the estimated error from encoder position for speed control. The observer generates an estimation of motor speed that is used as an alternative to the measured, filtered speed of the axis.

# Procedure for using the observer

- Make sure that the mass inertia of the system (P 1516[0] - SCD_JSum) is known. To do so, determine the inertia of the system (see section “Section ""Automatic inertia detection"" on page 111”), if this has not yet been done.

# 7 Control

# 7.4.1.2 Reduction of gain at low speeds.

With speed controllers set to be very dynamic, undesirable oscillation of the speed controller may occur at low speeds or at zero speed. An appropriate setting of P 336 - CON_SCON_KpScaleSpeedZero reduces this tendency to oscillate.

# 7.4.1.3 Quick stop without sensor

In the event of a wire break on the encoder system the drive is shut down in sensorless mode on the preset quick-stop ramp (see Section ""Error reactions"" on page 325 and Section ""Stop ramps"" on page 248). Due to the lack of dynamism at low speeds, the sensorless control is very ""imprecise"". To enable the drive nevertheless to be run down smoothly to speed 0, as from the speed threshold parameterized in P 355[0] - LowSpeedLimit the controller switches to a current/frequency (IF) control. For stabilization, an additional, cumulative d-current must be injected that can be set via the P 355[1] - d-current Injection parameter. The speed controller gain is reduced by the factor P 355[2] - SpeedControlGainScale.

Another criterion for a reliable knowledge of mass inertia is functioning torque feed forward control (see Section ""Pre-control"" on page 140). Multiply the currently configured value of P 1516[0] - SCD_JSum by P 376 - CON_IP_TFFScale and set P 376 - CON_IP_TFFScale back to 100%.

Set P 350[0] - SEL_ObserverMethod = OBS1(1) and P 354[0] - CON_SCALC_ObsDesignAssi = DR(2).

Start the control. The setting parameter for the observer is the time constant P 353[0] - Tf. Use twice the time constant of the previously used speed filter P 351[0] - CON_SCALC_Tf as an initial value. Configuration is also a compromise between input signal smoothing and phase shift in the control circuit. However, the observer does not have such a great effect on phase shift in the speed control circuit as a filter.

# Image 7.23: Reduction of gain at low speeds.

# Image 7.24: Quick stop without sensor

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 134

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# 7.4.1.4 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|352|CON_SCON_Kd| |Advanced control structure gains|
|352|CON_SCON_K_d| |D control / acceleration feedback|
|352|CON_SCON_K_dvlm| |Speed difference feedback|
|352|CON_SCON_K_dmlm| |Torsional torque feedback|
|352|CON_SCON_K_mload| |Load torque compensation|
|352|CON_SCON_TFd| |Kalman: Setting|
|352|CON_SCON_TF_d| |D control / acceleration feedback|
|352|CON_SCON_TF_dvlm| |Speed difference feedback|
|352|CON_SCON_TF_dmlm| |Torsional torque feedback|
|352|CON_SCON_TF_mload| |Load torque compensation|
|353|CON_SCON_KpScaleSpeedZero| |Adaptation of speed control gain at zero speed|
|353|KpScale_Zero| |Speed control gain for low/zero speed|
|353|SpeedLimit|rpm|Speed limit to detect zero speed|
|353|Filter_Zero|ms|Filter time for change from higher to zero speed|
|353|Filter_High|ms|Filter time for change from zero to higher speed|
|353|KvScale_Zero| |Position control gain for low/zero speed|
|353|CON_SCON_Kalman| |Kalman: Setting|
|354|Tf_Kalman|ms|Kalman: Integration time|
|354|KpScale_Kalman|%|Kalman: Gain|
|355|CON_SCALC_SEL| |Selection of speed calculation method|
|355|SEL_ObserverMethod| |Selection of speed calculation method|
|355|SEL_FeedbackMethod| |Select test or operational mode|
|355|CON_SCALC_ObsPara| |Observer parameters (effect depends on CON_SCALC_SEL)|
|355|CON_SCALC_ObsPara| | |
|2696|CON_SCALC_ObsPara| | |
|2698|CON_SCALC_ObsPara| | |
|2699|CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |
| |CON_SCALC_ObsPara| | |

Table 7.13: “Speed controller - Advanced speed control” parameter

|Index Name|Unit|Description|
|---|---|---|
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |
|CON_SCALC_ObsPara| | |

“Speed controller - Advanced speed control” parameter (continue)

# 7.4.2 Digital filter

# Bode diagrams PT1 to PT4

# Bode plots for band-stop filters (notch filters)

To filter any noise on the actual speed value, or to damp resonance frequencies, various filter combinations can be used. A range of filter variants are available. The coefficients of the transfer function are automatically determined as soon as the values for the middle and limit frequency and the width have been entered.

**Table 7.14: Filter Bode plots**
|No.|Action|
|---|---|
|1|Scope setting: isq (unfiltered, torque-forming current) Set shortest sampling time Create scope plot without notch filtering On the oscilloscope click the ""Mathematical functions"" > FFT (Fourier analysis) icon. From the following pop-up menu choose isq. Disturbance frequency is displayed.|
|2|Select filter|
|3|Enter middle/limit frequency|
|4|Width: Enter the bandwidth of the limit frequency; the width has no effect when using PTx filters|
|5|Create scope plot with notch filtering|

**Table 7.15: Instructions for FFT signal analysis**
| | |
|---|---|

Image 7.25: “Speed controller - Digital filter” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 136

# 7 Control

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

|FFT without filtering|FFT with filtering|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|
| | |325|CON_SCON_FilterFreq| |Filter frequencies of digital filter| |
| | |0|CON_SCON_FilterFreq|Hz|1st center/cutoff|
| | |1|CON_SCON_FilterFreq|Hz|1st width|
| |2| |CON_SCON_FilterFreq|Hz|2nd center/cutoff|
| |3| |CON_SCON_FilterFreq|Hz|2nd width|
| | |0|CON_SCON_FilterAssi| |Digital filter design assistant|
| | |327|CON_SCON_FilterPara| |Coefficients of digital filter| |
| | |0|FilterPara b0| |b0*x(k)|
| | |1|FilterPara b1| |b1*x(k-1)|
| |2| |FilterPara b2| |b2*x(k-2)|
| |3| |FilterPara b3| |b3*x(k-3)|
| | |4|FilterPara b4| |b4*x(k-4)|
| | |5|FilterPara a1| |a1*y(k-1)|
| | |6|FilterPara a2| |a2*y(k-2)|
| |7| |FilterPara a3| |a3*y(k-3)|
| | |8|FilterPara a4| |a4*y(k-4)|
| |1550|0|SCD_NotchType| |Adaptive Notch filter: Method|
| |1551|0|SCD_NotchCntl| |Adaptive Notch filter: Control word|
| |1552| |SCD_NotchFreq| |Adaptive Notch filter: Frequencies|
| |1552|0|SCD_NotchFreq|Hz|Adaptive Notch filter: Frequency|
| |1552|1|SCD_NotchLambda|Hz/min|Adaptive Notch filter: Coefficient|
| |1552|2|SCD_NotchMinFreq|Hz|Adaptive notch filter: Minimum frequency|
| |1552|3|SCD_NotchMaxFreq|Hz|Adaptive notch filter: Maximum frequency|
| |1552|4|SCD_NotchDeltaFreq|Hz|Adaptive Notch filter: Maximum frequency|

NOTE

- Note that the filters not only have an effect on the amount but also on the phase of the frequency response. At lower frequencies higher-order filters (PT3, PT4) should not be used, as the phase within the control bandwidth is negatively influenced.
- The coefficients can also be specified directly via parameter P 327 - CON_SCON_FilterPara. They take effect directly, so changing them is only recommended when the control is switched off.
- A large bandwidth will result in a lower attenuation of the cut-off frequency.

# 7.4.3 Analysis of Speed control

The speed controller is executed as a PI controller. The gain (P-component) and the integral-action time (I-component) of the individual controllers are programmable. In order to optimize the speed control loop, two rectangular reference steps are preset. For automatic controller optimization the step response and transfer function wizards are available.

# Image 7.26: “Advanced analysis of the speed controller” screen

# Image 7.27: Step response to rated speed

|No.|Action|
|---|---|
|1|The speed and time settings are generated automatically from the motor data.|
|2|ISDSH and ENPO (hardware enable) must be set to ""High"".|
|3|Click ""Start test signal"" button|
|4|Observe the safety notice: When you confirm the safety notice a step response is executed.|
|5|The oscilloscope is set automatically.|
|6|The faster the actual value approaches the setpoint, the more dynamically the controller is set. The overshoot of the actual value should not be more than 5-10 % of the setpoint (general figure) during the settling process.|

# Table 7.18: Instructions for optimization of the speed controller

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 138

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

Image 7.29: Speed controller transfer function

- ① Green curve = amount

Y-axis left = absolute value of nact/ndiff
- ② Blue curve = phase response

Y-axis right = Phase response nact/ndiff

# Legend for Speed controller transfer function

Image 7.28: “Noise amplitude, sampling time” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|401|0|CON_SCON_AddTRef|Nm (N) Additive torque reference|
|402|0|CON_SCON_AddSRef|1/min Additive speed reference value (without ramp)|

# Table 7.19: “Speed controller - Analysis of Speed control” parameter

# NOTE

- The speed control loop should be evaluated in the linear range.

Check to be sure that the torque in the recording does not reach the limitation.
- An overshoot of 40% is customary for dynamic applications.

(“Symmetrical optimum”)

# 7.5 Position controller settings

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |276|0|MPRO_FG_UsrActPos|mDegree|Actual position in user units|
| |277|0|MPRO_FG_UsrRefPos|mDegree|Setpoint position in user units|
| |279|0|MPRO_FG_UsrPosDiff|mDegree|Position tracking error in user units|
| |305|0|CON_PConTS|ms|Position control sampling time|
| |360|0|CON_PCON_Kp|1/min|Position control gain|

Table 7.20: “Position controller” parameters

# 7.5.1 Pre-control

The pre-control of the acceleration torque relieves the strain on the speed controller and optimizes the control response of the drive. To be able to pre-control the acceleration torque, the mass inertia referred to the motor shaft must be known. If the parameter for the overall mass inertia of the system (P 1516[0] - SCD_Jsum) has a value ≠ 0, that value will be automatically used to pre-control the acceleration torque.

1. Delay time and scaling for torque pre-control
2. Delay time and scaling for speed pre-control
3. Delay time for position pre-control
4. Scaling of friction torque

The pre-control of the speed reference is set to 100% via P 375[0] - CON_IP_SFF_Scale. This value should not be changed. The acceleration torque pre-control can be optimized with P 376[0] - CON_IP_TFF_Scale. Reducing this reduces the pre-control value; conversely, increasing this value also increases the pre-control value.

The position tracking error can be further reduced by predictive torque and speed pre-control – that is, in advance of the position reference setting. The higher the dynamism of the speed controller, the more dynamically the position controller can be set and the tracking error minimized. The variables for the pre-control of the speed and position controller are additionally determined either from the change in reference values or alternatively are already calculated and outputted by the motion control.

The time-related values for the position, speed and torque are transmitted to the drive control. If the dynamic change in these values is within the limits which the drive is able to follow dynamically, the load on the controllers is significantly reduced. In order to improve the dynamism of the position controller, the following screen is provided to optimize the speed and acceleration pre-control.

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 140

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 141

|ID|Index Name|Unit|Description|NOTE|
|---|---|---|---|---|
|372|0|CON_IP_SFFTF|ms|Speed feedforward filter time constant (PCON l Torque feed-forward control will be disabled if linear interpolation is used.)|
|374|0|CON_IP_EpsDly|ms|Delay pos. reference by integer no. of cycles|
|375|0|CON_IP_SFFScale|%|CON_PConTS l The overall moment of inertia in P 1516[0] - SCD_Jsum must not be changed to optimize the pre-control, because this would also have an effect on other controller settings!|
|376| |CON_IP_TFFScale| |Scaling of torque feedforward|
|376|0|TFFScale_PCON| |Scaling of torque feedforward (PCON mode)|
|376|1|TFFScale_SCON| |Scaling of torque feedforward (SCON mode) l In multi-axis applications requiring precise three-dimensional axis coordination, such as in the case of machine tools, the delay of the position signal must be equally set on all axes via P 374[0] - IP_EpsDly. Otherwise the synchronization of the axes may suffer, leading to three-dimensional path errors.|
|377| |CON_IP_EnableFF| |Enable feedforward|
|377|0|CON_IP_EnableFF| |Enable feedforward|
|377|1|CON_IP_EnableFF| |Enable feedforward|
|378|0|CON_IP_ACCFFTF|ms|Acceleration feedforward filter time constant (PCON, SCON mode)|
|379| |CON_IP_FFMode| |Feed-forward calculation mode|
|379|0|PosHighRes| |Position high resolution|
|379|1|Speed| |Speed pre-control|
|379|2|Torque| |Torque pre-control|
|386| |CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque l Friction torque compensation settings|
|386|0|CON_SCON_TFric|%|Friction torque compensation settings|
|386|1|CON_SCON_TFric|%|Compensation value 1|
|386|2|CON_SCON_TFric|%|Compensation value 2|
|386|3|CON_SCON_TFric|%|Compensation value 3|
|386|4|CON_SCON_TFric|%|Compensation value 4|
|387| |CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limits|
|387|1|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 1|
|387|2|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 2|
|387|3|CON_SCON_TFricSpeed|rpm|Friction torque compensation: Speed limit 3|
|387|4|CON_SCON_TFricSpeed|rpm| |
|388|0|CON_SCON_TConst|%|Friction torque compensation: Constant (independent of direction)|
|1516|0|SCD_Jsum|kg|Total inertia of motor and plant m*m|

# Table 7.21: “Position controller - Pre-control” parameters

The screen view can only be used to configure P 386[0] - CON_SCON_TFric. In order to access all the friction torque compensation parameters, please switch to the list view by using the “CTRL + L” key combination.

# Image 7.31: “Position control” screen

|ID|Index Name|Unit|Description|
|---|---|---|---|
|386|CON_SCON_TFric| |Dry friction comp., normalized to motor rated torque|
|386|0|%|Friction torque compensation settings The table values 0 to 2 are always applicable while table values 3 to 4 only take effect in the acceleration range.|
|386|1|%|Compensation value 1|
|386|2|%|Compensation value 2|
|386|3|%|Compensation value 3|
|386|4|%|Compensation value 4|
|387|CON_SCON_TFricSpeed| |Friction torque compensation: Speed limits|
|387|0|rpm|Friction torque compensation: Speed limits has five basic functions, each having the Torque and Speed parameters. The basic function runs proportionally up to the point (Speed, Torque), the function value remains constant at higher speeds.|
|387|1|rpm|Friction torque compensation: Speed limits|
|387|2|rpm|Friction torque compensation: Speed limits|
|387|3|rpm|Friction torque compensation: Speed limits|
|387|4|rpm|Friction torque compensation: Speed limits|
|388|0|%|Friction torque compensation: Constant (independent of direction)|

# Table 7.22: “Position controller - Feed-forward control” parameters (friction torque compensation extract)

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 142

# 7 Control

# 7 Control

# 7.6 Asynchronous motor field weakening

Up to rated speed the asynchronous motor runs with a full magnetic field and so is able to develop a high torque. Above the rated speed, the magnetic field is reduced because the maximum output voltage of the Servo Drive has been reached. The motor is operated in the field-weakening range at reduced torque.

To use field weakening for asynchronous motors, the motor parameters must be known very accurately. This applies in particular to the dependency of the main inductance on the magnetizing current. The field-weakening mode requires that a motor identification and an optimization in the basic setting range be carried out. In the process, default values for the control circuits and the ""magnetic operating point"" are set based on the rated motor data and the magnetizing current presetting in P 340[0] - CON_FM_Imag. For field weakening when using an asynchronous motor, a characteristic curve is always internally calculated (independently of P 435[0] - CON_FM_FWMode) and a voltage controller is superimposed.

Configuring the characteristic curve with P 341[0] - ImagSLim:

- Variant 1: P 341[0] ≠ 0 signifies selection of the 1/n characteristic (default)
- Variant 2: P 341[0] = 0 signifies selection of the modified 1/n characteristic

isd = f(n).

Combination of ""pre-control via 1/n characteristic"" + voltage controller. The motor identification sets the voltage controller so that the voltage supply in a weakened field is adequate. If the Servo Drive is at the voltage limit, it reduces the d-current and thus the rotor flux. The 1/n characteristic curve is calculated with operating speed SNom * ImagSLim.

As the Servo Drive has only limited dynamism, and starts to oscillate if larger gain factors are set, it is possible to use variant 2.

Image 7.33: Structure of field weakening for asynchronous motors

# 7.6.2 Variant 2: Modified characteristic

Combination of ""pre-control with modified 1/n characteristic (isd=f(n)) + voltage controller. This characteristic describes the magnetizing current as a percentage of the nominal value of P 340[0] - CON_FM_Imag dependent on the speed. The choice between the modified 1/n characteristic and the static characteristic is based on P 341[0] - CON_FM_ImagSLim. The speed is specified relative to the rated speed in P 458[0] - MOT_SNom, the d-current relative to the magnetizing current in P 340[0]. A constant magnetizing current P 340[0] is injected up to the field-weakening speed. The d current will be set as a function of speed based on the configurable characteristic curve. The characteristic curve is configured with P 342 CON_FM_SpeedTab and P 343 - CON_FM_ImagTab; when using an asynchronous motor, only values 0–7 from ImagTab will be relevant; values 8–15 are intended for synchronous motor field weakening.

| | |(0)| |100|100|
|---|---|---|---|---|---|
| | |(1)| |110|100|
| | |(2)|Inom= 120| |100|
| | |(3)|1800 rpm|130|100|
| | |(4)|Imag eff = 140| |90|
| | |(5)|100 %|150|70|
| | |(6)| |160|55|
| | |(7)| |170|0|

# 7.6.3 Voltage controller

The superimposed voltage controller will be a PI controller with gain P 345[0] - CON_FM_VConKp and reset time P 346[09] - CON_FM_VConTn. In addition, the measured DC link voltage can be smoothed with a P 344[0] - CON_FM_VConTF PT1 filter. After a motor identification the voltage controller is always active, as the rule parameters are preset. With P 345[0] - CON_FNVConKp = 0 the voltage controller is deactivated. The voltage setpoint that needs to be achieved is specified using P 347[0] - CON_FM_VRef.

| |ID|Index Name| |Unit|Description|
|---|---|---|---|---|---|
| |430|0|CON_FM_VModel| |Weighting of voltage path in field model|
|340|0|CON_FM_Imag|A Magnetizing current (RMS)| | |
| |341| |CON_FM_ImagSettings| |Settings of magnetizing behaviour|
|341|0|ImagSLim|% Speed where field-weakening starts| | |
| |341|1|Imag0|% Magnetizing current during start-up| |
| |342|CON_FM_SpeedTab| | |Speed values for magnetizing current scaling|
|342| |0|CON_FM_SpeedTab|%| |
|342| |1|CON_FM_SpeedTab|%| |
|342|2|CON_FM_SpeedTab|%| | |
|342|3|CON_FM_SpeedTab|%| | |
|342|4|CON_FM_SpeedTab|%| | |
|342|5|CON_FM_SpeedTab|%| | |

# Table 7.24: “Field-weakening” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 144

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 145

|ID|Index Name|Unit|Description|ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|342|6|CON_FM_SpeedTab|%|421|CON_FM_FWTabIdx| |Table index for field weakening / reluctance torque utilization|
|342|7|CON_FM_SpeedTab|%|421|0|CON_FM_FWTabIdx|Speed index|
|343| |CON_FM_ImagTab|Magnetizing current scaling vs. speed|421|1|CON_FM_FWTabIdx|Torque index|
|343|0|CON_FM_ImagTab|%|422|0|CON_FM_FWTabId|A d-current table entry|
|343|1|CON_FM_ImagTab|%|423|0|CON_FM_FWTabIq|A q-current table entry|
|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|Table 7.25: “Field weakening - Interior permanent magnet synchronous motor (IPMSM)” parameters|
|343|2|CON_FM_ImagTab|%| | | | |
|343|3|CON_FM_ImagTab|%| | | | |
|343|4|CON_FM_ImagTab|%| | | | |
|343|5|CON_FM_ImagTab|%| | | | |
|343|6|CON_FM_ImagTab|%| | | | |
|343|7|CON_FM_ImagTab|%| | | | |
|343|8|CON_FM_ImagTab|%| | | | |
|343|9|CON_FM_ImagTab|%| | | | |
|343|10|CON_FM_ImagTab|%| | | | |
|343|11|CON_FM_ImagTab|%| | | | |
|343|12|CON_FM_ImagTab|%| | | | |
|343|13|CON_FM_ImagTab|%| | | | |
|343|14|CON_FM_ImagTab|%| | | | |
|344|0|CON_FM_VConTF|ms| | | |Voltage control filter time constant|
|345|0|CON_FM_VConKp|A/V| | | |Voltage control gain|
|346|0|CON_FM_VConTn|ms| | | |Voltage control integration time constant|
|347|0|CON_FM_VRef|%| | | |Voltage control reference (relative to maximum voltage)|
|348|0|CON_FM_SlipCon|%| | | |Slip control gain for field weakening|
|435|0|CON_FM_FWMode| | | | |Mode of field weakening / d-current calculation|
|436|0|CON_FM_FWSpeedScale|%| | | |Speed scaling for field weakening (table mode)|
|437|0|CON_FM_FWCurrScale|%| | | |q-current scaling for field weakening (table mode)|
|438|0|CON_FM_FWMaxBackEMF|V| | | |Maximum back-EMF in field weakening mode (DC link voltage)|

Table 7.24: “Field-weakening” parameters (continue)

A certain voltage reserve is required for stable operation. This is specified using P 347[0] - CON_FM_VRef (&lt; 100%). The value should be set high (≤ 90%) where there are high demands in terms of dynamic performance. When using a lower dynamic performance instead, the maximum achievable torque can be optimized in relation to the current by using higher values (&gt; 90%).

# 7.7 Field weakening and LookUpTable (LUT)

|P No.|Index Name|Unit|Description|
|---|---|---|---|
|344|CON_FM_VConTF|ms|Time constant of voltage controller actual value synchronous motor filter|
|345|CON_FM_VConKp|A/V|Voltage controller gain factor Kp|
|346|CON_FM_VConTn|ms|Voltage controller integral-action time Tn LookUp Table, LUT|
|347|CON_FM_VRef|%|Voltage controller reference (as % of the current DC link voltage) If the value 0 % is set, the controller is not active.|
|458|MOT_SNom|rpm|Motor rated speed|

For better control of motors with a torque reluctance component. For motors with different inductances on the d and q axis, a reluctance torque can contribute to obtaining better utilization of the overall torque. The d and q current have feed forward control in dependence on the target torque and the actual speed by means of tables (LUT). As this approach also subjects the d component of the current to feed forward control in exactly the same manner as the field weakening designed to achieve higher speeds as described below, the LUT usually considers both the torque and the field weakening simultaneously for the d current.

# Field weakening

Synchronous motors can also be operated above their rated speed at rated voltage by reducing their voltage consumption through the injection of a current component.

# Features

- The method is relatively robust against parameter fluctuations.
- The voltage controller can only follow rapid speed and torque changes to a limited degree.
- A non-optimized voltage controller may cause oscillation; the controller must be optimized.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 146

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 147

# Conditions

First of all, there are two variants for field weakening with synchronous motors, variants 1 and 2. They can be selected via P 435[0] - CON_FW_FWMode.

To effectively reduce the voltage consumption, the ratio of stator inductance P 471[0] - MOT_Lsig multiplied by the rated current P 457[0] - MOT_CNom to rotor flux P 462[0] - MOT_FluxNom must be sufficiently large. In contrast to field-weakening of asynchronous motors, synchronous motors can also be operated in the field-weakening range with full rated torque at the nominal value of the q-current. Power beyond the rated power output can therefore be drawn from the machine in field-weakening mode, even at rated current. This must be taken into consideration when configuring the motor.

CNom * Lsig > Faktor * FluxNom

A value greater than 0.2 is recommended for Factor.

# Voltage demand

Rotor flux * Maximum speed (in rad/s) * Number of pole pairs * < 800 V (400 V devices)

400 V (230 V devices)

|P 458|P 328|P 462[0]|[0]|[0]|*|* P 463[0]|* < 800 V (400 V devices)|
|---|---|---|---|---|---|---|---|
|400 V (230 V devices)| | | | | | | |

CAUTION! Your system/motor may be damaged if put into operation in an uncontrolled or inappropriate manner. Improper conduct can cause damage to your system/machine.

If the speed achieved by field-weakening is so high that the induced voltage exceeds the overvoltage threshold of the device (for 400 V devices approximately 800 V, for 230 V devices approximately 400 V), this will result in destruction of the Servo Drive if no additional external safety measures are applied.

Image 7.34: Structure of field-weakening of synchronous motors

Additional modes (corresponding to P 435[0] - CON_FW_FWMode in the figure at positions 0, 1 and 2) with their feed forward control of the d current are coupled with additional multiplexer settings here as an alternative.

The voltage control implementation is active in all modes! This ensures by means of P 347 CON_FM_VRef that adequate voltage reserves are available to maintain a functional speed control at higher speeds.

# 7.7.1 Variant 1 (Table)

- Deactivate table: P 340[0] - CON_FM_Imag = 0
- Select P 435[0] - CON_FM_FWMode = TABLE(1)
- Run-up slowly to required speeds
- Set scope: Isdref / sqrt(2)*Imag = % = field-weakening speed. The maximum amount of the field-weakening d-current is defined by parameter P 340[0] - CON_FM_Imag (specification of effective value).
- Enter the values in the table; P 342[0] - CON_FM_SpeedTab

# Example

The speeds in P 342[0] - CON_FM_SpeedTab must continuously increase from index 0 -7.

**Table 7.27: Example of speeds in P 342 - CON_FM_SpeedTab**
|Index|Rated speed; P 340|Field-weakening speed P 342 (0-7) [%]|Magnetizing current in field-weakening mode P 343 (0-7) [%]|
|---|---|---|---|
|(0)|100|0| |
|(1)|110|55| |
|(2)|Irated= 120|70| |
|(3)|1800 rpm|130|90|
|(4)|Imag rms = 140|100| |
|(5)|100%|150|100|
|(6)|160|100| |
|(7)|170|100| |

# 7.7.2 Variant 2 (Calc)

In the case of very rapid speed or load changes in the field-weakening range, the setting P 435[0] - CON_FM_FwMode = CALC(2) must be selected. A characteristic for higher control dynamism is calculated internally.

",What precautions does the 'MSD ServoDrive - DeviceHelp' document mention regarding field weakening for synchronous motors?,A5,"The document advises vigilance against overvoltage in field weakening, highlighting the need for external safety measures to prevent device damage.",2.46875,2.5625,3.734375,1.46875,0.6875
