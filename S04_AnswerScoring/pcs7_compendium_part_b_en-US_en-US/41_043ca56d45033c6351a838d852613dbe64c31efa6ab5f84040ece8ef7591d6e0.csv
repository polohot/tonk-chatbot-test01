,NODE_FILE_NAME,NODE_NUMBER,NODE_HASH,NODE_TEXT,Q,A_NUMBER,A,helpfulness,correctness,coherence,complexity,verbosity
0,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is an F-startup triggered according to 'Compendium Part B - Process Safety (V9.0)'?,A1,After a CPU STOP with an F-CPU warm restart or after an F-STOP with a positive edge at the RESTART input of F_SHUTDN.,1.8515625,1.8125,3.25,1.4375,0.5703125
1,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is an F-startup triggered according to 'Compendium Part B - Process Safety (V9.0)'?,A2,Triggered by a warm restart post CPU STOP or a positive RESTART input edge post F-STOP.,1.953125,2.078125,3.40625,1.2578125,0.46484375
2,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is an F-startup triggered according to 'Compendium Part B - Process Safety (V9.0)'?,A3,Via warm restart after CPU STOP or positive RESTART input edge after F-STOP.,1.515625,1.6171875,3.234375,1.1875,0.451171875
3,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is an F-startup triggered according to 'Compendium Part B - Process Safety (V9.0)'?,A4,An F-startup occurs after CPU STOP with warm restart or F-STOP with RESTART input edge.,1.203125,1.1171875,3.15625,1.1796875,0.419921875
4,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is an F-startup triggered according to 'Compendium Part B - Process Safety (V9.0)'?,A5,Initiated by warm restart following CPU STOP or RESTART input signal after F-STOP.,1.2421875,1.2265625,3.0625,1.140625,0.392578125
5,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is the shutdown behavior defined in the event of an F-STOP according to 'Compendium Part B - Process Safety (V9.0)'?,A1,Through the 'Safety Program' dialog using the 'Shutdown behavior' button.,1.2734375,1.1796875,3.21875,1.15625,0.337890625
6,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is the shutdown behavior defined in the event of an F-STOP according to 'Compendium Part B - Process Safety (V9.0)'?,A2,It's configured in the dialog under 'Safety Program' by selecting 'Shutdown behavior'.,1.078125,1.421875,3.34375,1.2265625,0.185546875
7,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is the shutdown behavior defined in the event of an F-STOP according to 'Compendium Part B - Process Safety (V9.0)'?,A3,Defined via the 'Shutdown behavior' option in the safety program settings.,0.67578125,0.66796875,3.0,1.0703125,0.23828125
8,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is the shutdown behavior defined in the event of an F-STOP according to 'Compendium Part B - Process Safety (V9.0)'?,A4,By setting the shutdown behavior in the safety program's configuration dialog.,0.62890625,0.6640625,3.015625,1.1015625,0.17578125
9,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",How is the shutdown behavior defined in the event of an F-STOP according to 'Compendium Part B - Process Safety (V9.0)'?,A5,Using the 'Shutdown behavior' button in the 'Safety Program' dialog for configuration.,0.6875,0.5703125,2.921875,1.1328125,0.275390625
10,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the requirements for reintegration following elimination of errors as per 'Compendium Part B - Process Safety (V9.0)'?,A1,Automatic reintegration without user acknowledgment or prompt for user acknowledgment.,0.984375,1.0,3.203125,0.984375,0.1552734375
11,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the requirements for reintegration following elimination of errors as per 'Compendium Part B - Process Safety (V9.0)'?,A2,Either automatic or user-acknowledged reintegration post error correction.,1.1953125,1.0703125,3.0625,1.171875,0.283203125
12,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the requirements for reintegration following elimination of errors as per 'Compendium Part B - Process Safety (V9.0)'?,A3,Reintegration can be automatic or require user acknowledgment based on settings.,0.65234375,0.65234375,3.0625,0.875,0.1689453125
13,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the requirements for reintegration following elimination of errors as per 'Compendium Part B - Process Safety (V9.0)'?,A4,"Depending on ACK_NEC input, reintegration may need user acknowledgment.",0.69921875,0.86328125,3.03125,1.0859375,0.220703125
14,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the requirements for reintegration following elimination of errors as per 'Compendium Part B - Process Safety (V9.0)'?,A5,Errors can be reintegrated automatically or after user acknowledgment.,0.8515625,0.84765625,3.125,0.890625,0.0238037109375
15,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the two types of shutdown behaviors available in the 'Compendium Part B - Process Safety (V9.0)'?,A1,Complete shutdown and partial shutdown.,2.265625,2.5,3.640625,1.0078125,0.09765625
16,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the two types of shutdown behaviors available in the 'Compendium Part B - Process Safety (V9.0)'?,A2,The options are complete shutdown and partial shutdown.,2.359375,2.421875,3.765625,1.0703125,0.1875
17,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the two types of shutdown behaviors available in the 'Compendium Part B - Process Safety (V9.0)'?,A3,Complete shutdown shuts all groups; partial shuts only the faulty one.,2.046875,2.234375,3.625,1.046875,0.291015625
18,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the two types of shutdown behaviors available in the 'Compendium Part B - Process Safety (V9.0)'?,A4,Two behaviors: complete (all groups) and partial (only faulty group).,1.8203125,1.859375,3.578125,1.046875,0.29296875
19,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What are the two types of shutdown behaviors available in the 'Compendium Part B - Process Safety (V9.0)'?,A5,Complete and partial shutdown are the two available behaviors.,2.65625,2.640625,3.671875,1.21875,0.265625
20,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What does passivation mean in the context of 'Compendium Part B - Process Safety (V9.0)'?,A1,Switching channels to a safe state in the event of an error.,1.1796875,1.3984375,3.171875,1.1484375,0.365234375
21,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What does passivation mean in the context of 'Compendium Part B - Process Safety (V9.0)'?,A2,It means setting channels to a safe state during errors.,1.703125,1.875,3.453125,1.0390625,0.3203125
22,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What does passivation mean in the context of 'Compendium Part B - Process Safety (V9.0)'?,A3,Passivation is the process of making channels safe during faults.,0.9609375,0.890625,3.25,1.0703125,0.3359375
23,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What does passivation mean in the context of 'Compendium Part B - Process Safety (V9.0)'?,A4,The act of de-energizing channels to ensure safety upon error detection.,2.109375,2.28125,3.578125,1.34375,0.484375
24,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What does passivation mean in the context of 'Compendium Part B - Process Safety (V9.0)'?,A5,Ensuring channels are in a safe state when errors occur.,1.5546875,1.59375,3.46875,1.0546875,0.298828125
25,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What happens to the outputs of the F signal modules when F shutdown groups are shut down in the book 'Compendium Part B - Process Safety (V9.0)'?,A1,The outputs are passivated.,2.0625,2.234375,3.65625,1.046875,0.1689453125
26,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What happens to the outputs of the F signal modules when F shutdown groups are shut down in the book 'Compendium Part B - Process Safety (V9.0)'?,A2,"They are set to a safe state, specifically passivated.",2.3125,2.46875,3.78125,1.1953125,0.330078125
27,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What happens to the outputs of the F signal modules when F shutdown groups are shut down in the book 'Compendium Part B - Process Safety (V9.0)'?,A3,"Outputs become passivated, ensuring safety.",1.4453125,1.4609375,3.453125,1.0859375,0.2001953125
28,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What happens to the outputs of the F signal modules when F shutdown groups are shut down in the book 'Compendium Part B - Process Safety (V9.0)'?,A4,"In the event of shutdown, outputs are immediately passivated.",1.8671875,2.015625,3.609375,1.0546875,0.173828125
29,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What happens to the outputs of the F signal modules when F shutdown groups are shut down in the book 'Compendium Part B - Process Safety (V9.0)'?,A5,"Passivation occurs, de-energizing the outputs.",1.9453125,1.9765625,3.609375,1.1875,0.1591796875
30,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What is the purpose of the F_QUITES block in 'Compendium Part B - Process Safety (V9.0)'?,A1,To signal an F-startup of the safety program with the initial values.,0.90625,0.80859375,3.09375,1.1328125,0.2578125
31,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What is the purpose of the F_QUITES block in 'Compendium Part B - Process Safety (V9.0)'?,A2,It indicates an F-startup has been triggered with initial values.,0.53125,0.294921875,2.8125,0.91015625,0.10498046875
32,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What is the purpose of the F_QUITES block in 'Compendium Part B - Process Safety (V9.0)'?,A3,The block signals the safety program's startup with initial values.,0.75,0.75390625,3.03125,1.0234375,0.177734375
33,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What is the purpose of the F_QUITES block in 'Compendium Part B - Process Safety (V9.0)'?,A4,Used for signaling the initiation of an F-startup with defaults.,0.69140625,0.546875,2.953125,0.9296875,-0.1064453125
34,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What is the purpose of the F_QUITES block in 'Compendium Part B - Process Safety (V9.0)'?,A5,Indicates the safety program's startup using initial values.,0.44921875,0.26953125,2.859375,0.8828125,-0.02490234375
35,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What must be ensured before deactivating safety mode according to 'Compendium Part B - Process Safety (V9.0)'?,A1,The process is in a non-critical state and monitored by an operator.,2.25,2.40625,3.578125,1.0,0.447265625
36,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What must be ensured before deactivating safety mode according to 'Compendium Part B - Process Safety (V9.0)'?,A2,Ensure the process is safe and under operator supervision.,1.7265625,1.8515625,3.484375,0.88671875,0.423828125
37,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What must be ensured before deactivating safety mode according to 'Compendium Part B - Process Safety (V9.0)'?,A3,The process should be non-critical and under monitored operation.,1.5859375,1.7109375,3.421875,0.97265625,0.34765625
38,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What must be ensured before deactivating safety mode according to 'Compendium Part B - Process Safety (V9.0)'?,A4,Process must be in a safe state with operator monitoring.,1.625,1.765625,3.328125,1.0234375,0.314453125
39,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What must be ensured before deactivating safety mode according to 'Compendium Part B - Process Safety (V9.0)'?,A5,Non-critical process state and operator monitoring are prerequisites.,1.71875,1.875,3.515625,1.0625,0.3984375
40,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What steps does a redundant F CPU complete before going into F-STOP as described in 'Compendium Part B - Process Safety (V9.0)'?,A1,Performs a master-to-standby switchover.,1.0859375,1.1640625,2.421875,0.73828125,0.08544921875
41,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What steps does a redundant F CPU complete before going into F-STOP as described in 'Compendium Part B - Process Safety (V9.0)'?,A2,The system switches from master to standby before F-STOP.,0.7265625,0.68359375,2.90625,0.83203125,0.1318359375
42,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What steps does a redundant F CPU complete before going into F-STOP as described in 'Compendium Part B - Process Safety (V9.0)'?,A3,"First, it executes a master-to-standby switchover.",1.1015625,1.078125,2.890625,0.99609375,0.212890625
43,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What steps does a redundant F CPU complete before going into F-STOP as described in 'Compendium Part B - Process Safety (V9.0)'?,A4,A switchover from master to standby is performed prior to F-STOP.,0.99609375,0.953125,3.1875,0.95703125,0.1416015625
44,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What steps does a redundant F CPU complete before going into F-STOP as described in 'Compendium Part B - Process Safety (V9.0)'?,A5,Completes a master-to-standby transition before entering F-STOP.,1.265625,1.1796875,3.171875,1.09375,0.310546875
45,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What triggers a full shutdown irrespective of the parameter assignment for F-STOP in 'Compendium Part B - Process Safety (V9.0)'?,A1,A cyclic interrupt OB request error.,1.375,1.21875,3.0625,1.125,0.140625
46,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What triggers a full shutdown irrespective of the parameter assignment for F-STOP in 'Compendium Part B - Process Safety (V9.0)'?,A2,Errors like CPU/OB overload causing cyclic interrupt OB request errors.,1.6171875,1.5,2.96875,1.171875,0.33203125
47,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What triggers a full shutdown irrespective of the parameter assignment for F-STOP in 'Compendium Part B - Process Safety (V9.0)'?,A3,Cyclic interrupt OB request errors always trigger full shutdown.,1.53125,1.4453125,3.15625,1.171875,0.37109375
48,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What triggers a full shutdown irrespective of the parameter assignment for F-STOP in 'Compendium Part B - Process Safety (V9.0)'?,A4,Full shutdown is unconditionally triggered by cyclic interrupt OB errors.,1.7890625,1.8125,3.328125,1.2421875,0.212890625
49,pcs7_compendium_part_b_en-US_en-US.txt,41,043ca56d45033c6351a838d852613dbe64c31efa6ab5f84040ece8ef7591d6e0,"The F CPU's standard user program will continue to run in the event of an F STOP.

When F shutdown groups are shut down:

- The outputs of the F signal modules driven by the F shutdown group are passivated.
- As of S7 F Systems Lib V1_3: The F channel drivers of the F shutdown group set the outputs QBAD to ""1"" and QUALITY to ""0"".
- Safety-related communication between the F shutdown group and other F CPUs is interrupted.
- Data exchange between the F shutdown group and other F shutdown groups is interrupted.
- Where data exchange between the safety program and the standard user program is concerned, the standard user program is supplied with the last valid values.
- Block F_SHUTDN generates messages which are displayed automatically on the PCS 7 OS. With S7 F Systems Lib V1_3 SP2, the messages have the following message text:
- Safety program: Partial shutdown
- Safety program: Complete shutdown
- The corresponding diagnostics events are written to the F CPU's diagnostics buffer.

# 7.4.1 Complete shutdown

All of the F-CPU's F-shutdown groups are shut down. Shutdown proceeds in the following order:

- First, the F-shutdown group in which the error was detected is shut down.
- All other F-shutdown groups are then shut down within double the time period you set as the F monitoring time for the slowest cyclic interrupt OB.

# 7.4.2 Partial shutdown

Only the F-shutdown group in which the error was detected is shut down.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.3 Parameter assignment for shutdown behavior

From S7 F Systems V6.0 with S7 F Systems Lib V1_3 and higher, the shutdown behavior in the event of an F-STOP is defined in the ""Safety Program"" dialog using the ""Shutdown behavior"" button.

Hsafety program KOHP VB100 CPU81 [CPUA1OF [CPU 410-SHI5783515

|Offline|Online|Rack:|Slot:|
|---|---|---|---|
|Current compilation: 12/09/201 _ 08.05.59|Collective signature: 1e54e701|Logs|Reference: 12/08/2014 01:11.25|
|Collective signature: cb28d37e|Compare:|Last online change: 12/08/201 _ 01.02.51|Collective 426a3bdf|

FShutdown behavior__ According the configuration of SHUTDN Save reference

Safety program view: Blocks Runtime group: Charts Shutdown groups

|Block|F-Shutdown behavior|Library version|
|---|---|---|
|FC7IO|Select the behavior of the safety program when an error detected:|Systems Lib V1_3|
|FC?55| | |
|FC757|Full shutdown| |
|FC7BO| | |
|FC764|According the configuration of SHUTDN| |
|FC?65| | |
|FC766|Cancel|Help Safety mode__|
|FC767|Unknown| |
|FC768| | |
|FC??0|af9a| |
|FC771|d5d9|Password .|
|FC??3|3070| |
|FC774|cfe6|Print _|
|FC775|a70| |

You can use the ""Shutdown behavior"" dialog to select how the safety program should behave when an error is detected (in other words, in the event of an F-STOP):

- ""Complete shutdown"": All F-shutdown groups associated with a safety program are shut down the first time an error is detected in an F-shutdown group.
- ""Acc. to parameter assignment at F_SHUTDN"": Block F_SHUTDN is located in the @F_ShutDn chart. At the SHUTDOWN input, you can choose from:
- ""Partial"": The faulty F-shutdown group(s) is (are) shut down the first time an error is detected in an F-shutdown group (partial shutdown).
- ""Full"":

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

All F shutdown groups associated with a safety program are shut down the first time an error is detected in an F shutdown group.

Properties Input/Output

|Block:|SHUTDNF_SHUTDN|
|---|---|
|V/0:|SHUTDOWN (INIBOOL)|
|Value:|Inverted|
|Text|Partial|
|Invisible|ingerte|
|Text1:|Watched|
|Comment:|SHUTDOWN MODE|
|Archive:|No archiving|
|Operator authorization level:|OS additional text:|

If you change the shutdown behavior, you must recompile the F program. This applies even if you have changed the shutdown behavior online in CFC.

# 7.4.4 Causes of errors

Errors that trigger an F-STOP:

- Distortion of:
- Data
- Program sequence
- Code
- CPU error

Errors that always trigger an F-STOP with full shutdown:

Irrespective of the parameter assignment for F-STOP, a full shutdown is always triggered in the event of a cyclic interrupt OB request error (caused by a CPU/OB overload, for example).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.4 F-STOP

# 7.4.5 Execution of an F-STOP in S7 F/FH systems

# F-STOP illustration

|Error in RAM (Master)|Reaction|
|---|---|
|Error in RAM (Reserve)|Reaction|
|Error in RAM (F-STOP)|Reaction|
|Error| |
|RUN (Master)|STOP|
|Standard program|F-Program|

Error in master:

Before a safety program in a redundant F CPU goes into F-STOP, it completes the following steps:

- The S7 F/FH system performs a master-to-standby switchover.
- The previous master goes into the configured operating state (default setting: TROUBLESHOOTING).

If no errors are detected, the F CPU reconnects.

Note

Refer to the following manuals for more information:

- ""SIMATIC High Availability Systems S7-400H""
- ""SIMATIC PCS 7 Process Control System CPU 410 Process Automation""

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

If an error is detected, the previous master goes into FAULT mode (all LEDs on the affected CPU flash).

On redundant F CPUs, errors on one communications partner will not stop program execution.

# Error in both F CPUs:

The safety program goes into F-STOP immediately.

# 7.4.6 Exiting an F-STOP

Run an F-startup as described in the following chapter.

# 7.5 F startup and (re)start protection

# 7.5.1 F-startup

S7 F-systems do not make a distinction between a CPU cold restart and a CPU warm restart. Exceptions to this rule are the F-blocks F_CHG_BO, F_CHG_R (component of the Safety Data Write function), F_MOV_R (as of S7 F Systems Lib V1_3), F_SWC_CB and F_SWC_CR (component of the ""Secure Write Command++"" function).

Both a CPU cold restart and a CPU warm restart will generate an F-startup. With an F-startup, the safety program launches automatically with the initial values.

An F-startup is performed:

- After a CPU STOP, when you perform an F-CPU warm restart
- After an F-STOP, when the ""F_SHUTDN"" F-block detects a positive edge at the RESTART input

Following a partial shutdown of the safety program, only the F-shutdown groups involved in the F-STOP perform an F-startup. F shutdown groups with errors remain in F-STOP.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.5 F startup and (re)start protection

# 7.5.2 (Re)start protection

If the process does not permit the safety program to start up automatically with the initial values, you will need to program a response to F-startup.

The F_START F-block is used to signal an F-startup of the safety program with the initial values. The COLDSTRT output parameter tells you that an F-startup has been triggered.

Ireiberbauateine Kerden beir Anlauf paa3iviert_ die Ireiber aktivieren nu3 der Anlaufrerker Bediener zuruckgeaetzt verden

Channel driver vill paa3ivated after 3tart cperator ha3 re3et 3tart lacch activace che channe driver3

| | | |CH_DC|CB3|Fail-|13/3|
|---|---|---|---|---|---|---|
|CHADDR|FASS CUI|16#0|CHADDR|QBAD| | |
|CH_INF|QSIK|16#0|CH_INF_R|VALUE| | |
|QUALIIY|SIART_UP|SIART_UF_LAICH|SIN I|ACK_REQ| | |
|SIARI|C337|SR_FF|C337|SIM_KOD| | |
|:Ccld3|1341|:SR-Fl|1342|SIX CN| | |
|CCLDSIRI| |FASS|ACK_NEC| | | |
|RES_SIART_UP|QUIIES|CB3;|:Acknc|CUI| | |

In this example, a flip-flop is set when the F-program is started up, which passivates the output drivers. Once all the process conditions have been fulfilled, the operator can release the F-output signals by resetting the flip-flop using the F-acknowledgment function (F_QUITES block).

As of S7 F Systems V6.2 with S7 F Systems Lib V1_3 SP2, you can control the restart of F I/Os via the ES/OS with ""Safety Write Command++"" (""SWC++"") (F_SWC_BO and SWC_QOS). You can find additional information about using SWC_QOS in the section Fail-safe acknowledgment (SWC_QOS) (Page 120).

Note Additional options for programming a startup (and restart) protection and ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming"" (https://support.industry.siemens.com/cs/ww/en/view/109742100).

Compendium Part B - Process Safety (V9.0) Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.6 I/O access via F channel driver blocks

In S7 F systems, F signal modules are accessed via F channel driver blocks and not via the process image. For this purpose, the following driver blocks are used in the program:

- F channel driver (e.g. F_CH_xx) for access to the input/output channels of F signal modules. One F-channel driver is required for every input or output channel used. Only one F-channel driver is required for redundant channels.

In your safety program, F channel drivers provide the interface with a channel of an F signal module and perform signal processing. F channel drivers vary depending on the F-signal modules. They are placed and interconnected in the safety program by the user.

|FI_111_CH|CH_AI|C337|:Fail-|1542|
|---|---|---|---|---|
|@F_(1} (4,1} (FAIexlsBit_HAR_1|CHADDR|FASS CUI|CHADDRIO6|ADDRESS|
|INFUI FRCCESS DAIA BXTE|16#0|CHADDR|Q3AD| |
|FI_111|EW513|VALUE|QSIY| |
|Reactor prea3ure|Reaktordruck|VHRANGE|0.0|VLRANGE|
|CH_F_CN|V_DATA|CH_F_AL|QUALITY|CH_F_LL|
|V_XOD|SIY|ACK_REQ|SIY_CN|Su3S_|
|Su33_CN|FASS_CN|ACK_NEC| | |
|Plant_AlReactcrA|Ackncvledgrentl|F_ACK(4,1)|QUIT_CRI|ACK REI|
|CUI|CUIFUI|SIOP|CH_DI|CB37|
|:Fail-|15/3_|CHADDRIOQ|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V_1|
|CHADDR|FASS_CUI|CHADDR_R|QBAD| |
|CHADDRI03|ADDRESS|@F_ (1) (4,2) ! FDIZ4xDCZ4V|CH_INF|QSIK|
|CH_INF_R|16#0| | | |
|""E_SICP""|E16.0| | | |
|Scop|Erergency bucton Dot pre3zed|Nct-=|nicht aktiv| |
|SIY_|Q_DATA|SIX CN|QUALITY|FASS|
|Q_KOD|ACK NEC|ACK_REQ|ACK REI| |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The CFC compiler creates and interconnects one F-module driver per module for PROFIsafe communication purposes.

Note

When changing the address of an F_CH_AI channel driver block via delta download, read the following FAQ:
What do you have to consider if you want to transfer an address change to an F_CH_AI channel driver module via a delta download?

# 7.7 Passivation - general

Passivation means that in the event of an error, one or a number of channels on an F signal module are switched to a safe state.
In the event of a channel error (a faulty sensor, for example), only the affected channel is passivated.

In the event of a module error (a communication error, for example), all channels on the fail-safe I/O module are passivated.

If an F signal module detects an error, it switches the affected channel or all of its channels to the safe state;
in other words, the channels on this module are passivated. The fail-safe F signal module sends a message to the F channel driver
and the PCS 7 OS to indicate that it has detected an error.

|8-_100_Ck|C_DI|7193 _ OdI|QEAD|
|---|---|---|---|
|CHADDR|3133_O0z|Eanal|Baugruppenfehler|
|CHADDR|QEAD|Channel|033|
|iuie fail12|VALDE|33_|313O%|
|QWALITY|10848|Oroe|3133 O%|
|XOD|ACE_KEC|1CE_REQ|#CEREZ|

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

The PASS_ON input can also be used to activate and deactivate the passivation of a channel in the safety program, e.g. by using a specific condition in the program sequence or restart protection.

When output channels are passivated, the outputs are de-energized (set to a zero-current or zero-voltage state). The F channel driver of a passivated digital output channel issues a substitute value with the quality code (QUALITY) 16#48 and the QBAD output is set to 1.

When input channels are passivated, substitute values are forwarded to the safety program, regardless of the actual process signal. The F channel driver of a passivated digital input channel outputs substitute value 0 with quality code (QUALITY) 16#48 and the QBAD output is set to 1. In accordance with the parameter assignment at the SUBS_ON input, the F channel driver of an analog input channel will output either a substitute value with quality code (QUALITY) 16#48 or the last valid value with quality code (QUALITY) 16#44. The QBAD output is also set to 1 and, if a substitute value is output, the QSUBS output is set to 1.

# 7.7.2 Group passivation

If, during passivation of an F-I/O or a channel of an F-I/O, you wish to activate passivation of other F-I/Os, you can use the PASS_OUT output/PASS_ON input to perform group passivation of related F-I/Os.

Group passivation via PASS_OUT/PASS_ON can be used, for example, to force the simultaneous re-integration of all F I/Os after the S7 F system starts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

To enable group passivation, you must link all PASS_OUT outputs of the F-channel drivers in this group with F_OR4 F-blocks, and interconnect the OUT output result of F_OR4 with all PASS_ON inputs of the F-channel drivers in this group.

|Ch_DI_00I| |GRCUE_PASS| | | |
|---|---|---|---|---|---|
|Ch_DI|0337|CR4|7| | |
|CHADCR|PASS_CUT| | | | |
|1620|CHADER|QBAD|12| | |
|1600|OSIV|In3| | | |
|1040|ch_INP|VALVE| | | |
|SI_I|O_DATA| | | | |
|SI_C%|CUALITY| | | | |
|Pass_C|o_od| |Ch__0oi| | |
|ACE MEC|ACK_REQ| | |0b3n| |
|AcI REI| | | | | |
| | | |1g20- chadcR|PASS_CUI| |
| | | |166|CHADDR|QBAD|
|Ch_DI|032-| | | | |
| | | |1640|Ch_IME_R|VALUE|
|{7af-| | | | | |
|162@|CHADER|PAS5_CuT| | | |
|1600=|CHACCR|QBAD| | | |
|Ca_IE|VALDE| | | | |
|Si_|Q_RATA| | | | |
|SIC|QUALITY| | | | |
|PASS_oY|0_~cF| | | | |
|ACk_""EC|AcK_RECF| | | | |
|ACE_REI| | | | | |
|Ch_DI_003|:ail-|0335| | | |
|1670=|CHADCR|PaSS_CUI| | | |
|CHADER|QBAD| | | | |
|Ch_IITE|OSIX| | | | |
|1040|CA_IME|VALVE|Q_DATA| | |
|SIN| | | | | |
|SIN_CY|QUALITY| | | | |
|PASS_O|0_""odF| | | | |
|AcX NEC|ACK_RER| | | | |

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

107

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.3 Reintegration following elimination of errors

Reintegration means:

- Valid process values start to be output again at the output channels of the fail-safe output modules.
- The F-channel drivers associated with the fail-safe input modules resume the forwarding of valid process values to the safety program.
- Once a channel error has been eliminated, a channel on a fail-safe module can be reintegrated automatically or following user acknowledgment. You can use the ACK_NEC input of an F-channel driver to specify whether or not user acknowledgment is required:

|Value 0|Automatic reintegration without user acknowledgment|
|---|---|
|Value 1|Prompt for user acknowledgment for reintegration following error elimination|

E_STOP_Ch AcK_EEC

CH_DI 0333

:Fail 15/: Quictieredforderung Jach gegangenes Kcnalfehier (ACK_REQ

CHADDR PASS_cuT

1640 CHADDR QBAD Acknorledge ceolesc chanel filuf2 gone (Ac%_REQ

ch_IMF RSiX

1640_ CE_INE

VALOE

SIM_ Q_DATA

SIK_ON CWALITY

PASS_ON Q_Kod

ACK_NEC ACK_REQ

KKREL

If passivation was triggered by setting PASS_ON = 1, user acknowledgment will not be required for reintegration.

Note

The ACK_NEC input can only be set to 0 if the process permits automatic reintegration from a safety-related point of view.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

# 7.7.4 Automatic reintegration on channel error

If the ACK_NEC input is not set and once a channel error has been corrected, the affected channel is reintegrated automatically (depassivated) as follows:

- With input modules - immediately
- With output modules - within a matter of minutes (due to required test signal injections, after 2 successful test cycles).

Note
User acknowledgment is always required for reintegration following module errors (ACK_REQ output set), even if ACK_NEC has not been set. An interconnection of the ACK_REI input with an automatically generated signal is not permitted.

# 7.7.5 Programming reintegration following module errors or channel errors requiring acknowledgment

A value of 1 at the ACK_REQ output of the F-channel driver indicates that the error has been eliminated and user acknowledgment for reintegration is possible. When the ACK_NEC input is set, reintegration of the input or output channel is only performed on a positive edge at the ACK_REI input of the F-channel driver.

# Options for user acknowledgment

- An acknowledgment button is connected to a fail-safe digital input module
- Manual input of an ES or a local operating station via the F_QUITES block

Note
The figure is available in its original size as appendix to the manual in the ZIP download of the checklists.

Compendium Part B - Process Safety (V9.0)
Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.7 Passivation and reintegration of input/output channels

If you use an acknowledgment button for user acknowledgment, in the event of a module error on the F-signal module group to which the acknowledgment button has been connected, you will no longer be able to trigger acknowledgment to reintegrate this F-signal module group. An additional acknowledgment option must be provided for this module group, for example: using an ""F_QUITES"" block.

Note

Automatic user acknowledgment is not permitted.

Note

You can find additional information about programming fail-safe acknowledgment with ""Secure Write Command++"" in the manual ""SIMATIC Industrial software S7 F/FH Systems - Configuring and Programming (https://support.industry.siemens.com/cs/ww/en/view/109742100)"".

# Procedure for programming the fail-safe user acknowledgment via an operator station

1. Add the F_QUITES F-block to your safety program. You can access the acknowledgment signal for evaluation for user acknowledgments at the output OUT of F_QUITES.
2. Interconnect the OUT output of F_QUITES with the ACK_REI input of the F-channel drivers.
3. Collect the ""ACK_REQ"" channel driver outputs via an OR (OR04 or OR08) in the standard user program. Signal the output signal of the OR logic operation as an acknowledgment request on the operating station.
4. Set up a button or a text box on your operator station for writing the ""6"" acknowledgment value (1st acknowledgment step).
5. Optional: After the first operating step, the Q output of the F_QUITES block displays the request for the second operating step for 60s. You can use the signal to display a second key or second text box.
6. Set up a second button or a text box on your operating station for writing the ""9"" acknowledgment value (2nd acknowledgment step).
7. After the second operating step, the F_QUITES block outputs a pulse at the OUT output with which the connected F channel drivers are acknowledged.

Note

Automatic reintegration using F_QUITES: The non-safety-related input IN of F_QUITES must not be interconnected with a signal or described by a signal which generates the above condition (change from 6 to 9 within a minute) automatically for a fail-safe acknowledgment. Fail-safe acknowledgment must only be generated by means of a conscious manual entry on the ES/OS (not automatically in the program).

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# 7.8 Compiling the F-program

If an S7 program contains charts with F blocks, these will be compiled when the CFC charts are compiled. Measures for eliminating errors will also be expanded and additional safety-relevant checks carried out.

# 7.8.1 Password protection for safety-related functions and settings

A password protects the fail-safe program and the parameters of the F-modules against unauthorized changes. The password is requested when accessing fail-safe parts of the system, e.g. when editing a fail-safe CFC, when compiling changes in the safety program or when opening the properties of a fail-safe module in the hardware configuration.

As of S7 F Systems V6.2, you can use a more secure password by activating the ""Increased password security"" option box; this must comply with the ""Conditions for a secure password"":

- Password length: minimum 8, maximum 32 characters
- At least one capital letter of the Latin alphabet (A - Z); also diacritical characters (umlauts and letters with accents)
- At least one lowercase letter of the Latin alphabet (a- z); also ""ÃŸ"" and diacritical characters (umlauts and letters with accents)
- At least one digit (0-9)
- At least one of the following special characters: ~ ! @ # $ % ^ & * _ - + = ` | \ ( ) { } [ ] : ; ' "" < > , . ? /

Note

We recommend using the ""Increased password security"" option in the ""Create password for safety program"" dialog, but this option can only be used in ""F-Systems"" projects without the Safety Matrix.

For projects with Safety Matrix, this option must be disabled unless otherwise stated in the Safety Matrix product. For more information, refer to the documentation of the respective version of Safety Matrix.

If the password is entered, it remains valid for one hour. If you have finished your work, reset the password's period of validity.

To do this, in the SIMATIC Manager select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant dialog. There you can find the ""Password"" button that opens the ""Create Password for Safety Program"" window. The ""Clear"" button sets the validity period to ""0"".

# Configuring the safety program

# 7.8 Compiling the F-program

You also have the option of changing the password.

|Create password for safety program| | |
|---|---|---|
|Target system:|CPU 410-5H| |
|Program name:|ASOIICPU 410-5H{S7 Program(2)| |
|Old password| | |
|New password| | |
|Reenter password| | |
|Increased password security| | |
|Access permission| | |
|Remaining validity (in minutes):| | |
|Logout|Cancel|Help|

If a standard user program and a fail-safe program are running in one CPU, changes to the standard part can be compiled without the need to enter the F-password. This assumes that no changes have been made to the safety program.

# 7.8.2 Parameterizing the maximum F cycle monitoring time

The F-CPU runs F-cycle time monitoring for every cyclic interrupt OB containing F-runtime groups. The first time the F-program is compiled, for each cyclic interrupt OB which contains an F-program you will be prompted to enter a value for the maximum cycle time (MAX_CYC) that may elapse between two calls of this cyclic interrupt OB.

|Safety program|FSustems|Compilation|
|---|---|---|
|Cancel| | |
|Enter value| | |
|Enter value for MAX_CYC (in ms) for Task OB37|Current value: 0 ms|3000|
| |Help| |

The default for the maximum F-cycle time is 3,000 milliseconds.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

Check whether this setting is suitable for your process. Change the default if necessary.

Note

You can change the default value at the MAX_CYC input of the F_CYC_CO block in chart @F_CycCo-OB3x whenever you wish.

You can find information about setting the F-monitoring time and response times in section ""Monitoring times and system response times (Page 137)"".

# 7.8.3 Compiling the S7 program

During compilation, the S7 program is automatically expanded to include diagnostics drivers (contained in the @ system charts) and F-specific parts. F system blocks are stored in @F_xxxx charts.

|VB1 HP (Component view)|D:|Project|HuellerDikomp|VB1|KONP_V81|KOHP_VB1|
|---|---|---|---|---|---|---|
|KOMP_v81_MP_B|Object name|Version|PH Assignment|Type| | |
|KOMP_V810_CPU8I| |0001|CFC| | | |
|CPU4IOF| |0001|CFC| | | |
|CPU 410-5H| | |cfc| | | |
|S7Basis| |0001| | | | |
| |Sources-Quellen| |CFC| | | |
| |Blocks-Bausteine| |7| | | |
|Charts aene| | | | | | |
|Matrizen| | | | | | |
|CP 443-1|@CPU_RT| | | | | |
|CP 4435Ext|@F_(1)| | | | | |
|F_TYPICAL|@F_CycCo-OB37| | | | | |
|CPU4IOFH| | | | | | |
|ESSO|@F_Dblnit1| |CFC| | | |
|WinCC Appl:|@F_Init1| |CFC| | | |
|0S104|@F_RtgDiagl| |CFC| | | |
|Shared Declarations|@F_RtgDiag2| | | | | |
|KOMP_V8100_Lib|@F_ShutDn| |CFC| | | |
| |estMode| |CFC| | | |
| |@FMatrices| |CFC| | | |
| |@PA_CPU| |CFC| | | |

Note

Placements, interconnections, and parameter assignments for F-system blocks completed automatically during the compilation process must not be changed.

You must not change or delete F blocks in the block container.

The CFC compiler also automatically places F system blocks needed for the operation of the safety program in runtime groups. The names of these runtime groups begin with ""@F_"".

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.8 Compiling the F-program

|0336 [Cyclic interrupt6] (50 ms)|Contents 0f 0B371'|Txpe|Sampin|Conment| |
|---|---|---|---|---|---|
|OB37 [Cydlic interrupt7] (300 ms)|@CPU_RTI@CPU_RT|CPU_RT|1 / -|300 ms|CPU Performance Bloxk|
|@CPU_RTI@CPU_RT|ShutDn_37|Runtme group|2 / -|300 ms|inserted by FTool|
|@F_Shuton_37 (300 ms)|ShutDn|Runtme group| |300 ms|inserted by FTool|
|@F_shutDhIOR_0B37|@7_CycCo-0337|Runtme Group|4[ -|300 ms|inserted by FTool|
|@F_ShutDnl@F_CycCo-OB3_229|@7_Tesu ode|Runtme group|5 [ -|300 ms|inserted by FTool|
|@F_Shutonlef_OUT_37_0_164|@7JIN_37_|Runtme group|6 / -|300 ms|Tool_internal|
|@F_shutlni@F_OUT_37_0_116|INV_NUM|Runtme group|7 [ -|300 ms| |
|@F_ShutOnl@F_Test lode|ACK|Runtme group|8 [ -|300 ms| |
|@F_ShutDn (300 ms)|START|Runtme group|9 / -|300 ms| |
|@F_ShutonIF_SHUTDN|SFC_109_F|Runtme group|10 [ -|300 ms| |
|@F_CycCo-OB37 (300 ms)|110_|Runtme group|11/ -|300 ms| |
|@F_CycCo~0B37VF_CYC_CO-0337|PT_112_113]|Runtme group|12 / -|300 ms| |
|@F_CycCo-QB37IF_TEST|AJJ|Runtme group|13 / -|300 ms| |
|@F_CycCo-OB3ZIF_TESTC|HS104 F|Runtne group|14/ -|300 ms| |
|@F_Testxlode (300 ms)|AB_SEND_| |15 / -|300 ms| |
|@F_Testlode =_TESIM|SafetyMatrix37|Runtme group| | | |
|@FJN_37_0 (300 ms)| |Runtme group|16 / -|300 ms|Safety Matix|
|INV_NUM (300 ms)|@7_OUT_37_0|Runtme group|17 [ -|J00 ms|JTool_internal|
|F_ACK (Z0Q ms)|@7 IN_37_1|Runtme group|18 | -|300 ms|internal|
|F_START (300 ms)|AB_REC F|Runtme group| |300 ms| |
|SFC_109 (300 ms)|@_OU_37 _|Runtme group|20 | -|300 ms|JTool_internal|
|PT_I10_F (300 ms)|07 Dbinit1|Runtne group|21 / -|300 ms|inserted by FTool|
|PT_12_13J (300 ms)|@F_OUT_ 0337|Runtme group|22/ -|300 ms|inserted by FTool|
|AI F (300 ms)|m_SafetyMatix37|Runtme group|23 / =|300 ms|Safety =Matix|
|HS104_F (300 ms)| | | | | |
|AB_SENDJF (300 ms)| | | | | |
|SafetyMatix37 (300 ms)| | | | | |
|@F_OUT_37_0 (300 ms)| | | | | |
|@FJN_37_1 (300 ms)| | | | | |
|AB_REC F (300 ms)| | | | | |
|@F_OUT_37_1 (300 ms)| | | | | |
|@F_DbInitz (300 ms)| | | | | |
|@F_OUT_$_0337 (300 ms)| | | | | |
|SafetyMatrix37 (Z0Q ms)| | | | | |
|0B33 [Cyclic interrupta] (10 ms)| | | | | |

Note

The CFC charts and runtime groups with fail-safe blocks appear in yellow and are marked ""F"" to distinguish them from standard charts.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Safety mode of the safety program in the F-CPU can be temporarily deactivated and reactivated. This enables you to make changes to the safety program in RUN mode.

# 7.9.1 Information on safety mode

An S7-400 F/FH system containing a fail-safe program automatically goes into safety mode when it starts up. In safety mode, all functions present in the system for system error detection and for the fail-safe user program are activated. In this state it is not possible to modify the safety program in active operation (RUN).

In order to make online changes to fail-safe parameters from the CFC online, or to download changes in the fail-safe program, part of the diagnostics functions must be switched off. Safety mode must be deactivated for this purpose, before changes are made online or downloaded.

Prior to deactivating safety mode, you must ensure that the process is in a non-critical state and is being monitored by an operator during this time (monitored operation).

To download program changes in deactivated safety mode, the monitoring parts are switched off, which would detect software changes and trigger an F-STOP. ""Random hardware faults"" continue to be detected and the diagnostics for the modules remain active. The safety program continues to be processed to ensure that a ""Demand"" from the field leads to activation of the safety function.

Once the changes have been made, or at the end of the download process, safety mode must be reactivated immediately. The risk analysis may reveal details of other measures that are required.

# 7.9.2 Deactivating safety mode

Safety mode can be deactivated/activated if a relevant system prompt appears, or from the SIMATIC Manager. To do this, select the CPU that contains the safety program and use the ""Options > Edit Safety Program"" menu command to open the relevant window.

The field underneath the ""Safety Mode..."" button shows you whether safety mode is ""activated"" or ""deactivated"". If the safety program does not match the safety program in the F-CPU or communication with the F-CPU has failed, ""unknown"" will appear here.

If there is a connection between the engineering station and the CPU, the current status of the safety program is displayed and can be changed using the ""Safety Mode..."" button. An additional prompt appears before the status is changed.

The safety mode status is entered in the CPU diagnostic buffer and reported on the OS, and can be checked in chart @F_Shutdn at the SAFE_M output of the F_SHUTDN block.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

# Preconditions for deactivating safety mode

- The CPU must be in the RUN state (mode switch in RUN or RUN-P).
- Safety mode must be activated.

# Procedure

1. Select the CPU or its S7 program in the SIMATIC Manager.
2. Select the menu command ""Options > Edit Safety Program"".

|Safety program|KOMP V8100_CPU8|CPU41OFI|CPU 410-SH|S7basi5|
|---|---|---|---|---|
|Offline|Online|Rack:|Slot:| |
|Current compilation:|11/17/2017 09.00.54|Collective signature:|abf6szbc|Logs|
|Reference:|11/17/2017 08.28.44|Collective signature:|bac44862|Compare;|
|Last online change:|None|Collective signature:| | |
|FShutdown behavior|According the configuration of SHUTDN|Save reference| | |
|Safety progra|Customize safety program|Ision| | |
|Block|Target system:|CPU 410-5H|LibvI_3| |
|FC5S|Programname;|CPU4IOFICPU 410-5H{S7Basis| | |
|FC775|Should safety mode be deactivated (monitored operation)?|FC776|FC777|FC?79|
|FC785|Yes|Help|ppde;| |
|C788| |Activated| | |
|FB301|AND4|89b0|6837| |
|FB313|CMP_R|689a|602e| |
|FB335|SwC|7add|5a86|Password _.|
|FB336|SwC_BO|ebcd|87b0| |
|FB337|F_SwC_R|1939|e2b9| |
|FB360|DIAG|40fc|ddf4|Print_.|
|Cose|Update| |Help| |

Click the ""Safety mode"" button and (if applicable) enter the password for the safety program.
Confirm the deactivation of the safety mode.

# Note

The F_SHUTDN block generates a message when safety mode is activated/deactivated. The parameter for the message repetition time is assigned at the F_SHUTDN block in chart @F_ShutDn.

Compendium Part B - Process Safety (V9.0)

Operating Manual, 04/2018, A5E43228905-AA

# Configuring the safety program

# 7.9 Safety mode and downloading the safety program

Please note the following when deactivating safety mode:

Manual intervention in the safety mode of fail-safe systems requires particular care and attention.

- Any changes must be made in accordance with current change management guidelines.
",What triggers a full shutdown irrespective of the parameter assignment for F-STOP in 'Compendium Part B - Process Safety (V9.0)'?,A5,"Irrespective of settings, cyclic interrupt OB errors cause full shutdown.",2.015625,2.03125,3.375,1.3828125,0.431640625
