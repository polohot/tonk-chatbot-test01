,NODE_FILE_NAME,NODE_NUMBER,NODE_HASH,NODE_TEXT,Q,A1,A2,A3,A4,A5
0,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",What is the purpose of the parameter MOT_TorqueSat in the MSD ServoDrive?,MOT_TorqueSat compensates for the reduction in output-side torque due to rising losses in the overload range.,"It is used to adjust the motor torque as a function of the current, compensating for iron/copper losses.",The parameter helps in maintaining torque by compensating losses that occur in the overload range.,"To ensure consistent torque output, MOT_TorqueSat addresses the issue of rising losses during overload.",Compensates the torque reduction in overload conditions caused by increasing iron and copper losses.
1,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",How does the current observer improve the performance of current control in the MSD ServoDrive?,"By predicting current a scanning step ahead, it eliminates dead time in the current control circuit.",The current observer enhances performance by predicting current and suppressing harmonic components.,"It removes dead time and suppresses harmonics, improving the current control's effectiveness.",Improvement is achieved through dead time elimination and harmonic suppression in the control circuit.,Enhances current control by ahead prediction and harmonic suppression for smoother operation.
2,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",What is overmodulation in the context of the MSD ServoDrive?,Overmodulation allows the output voltage to exceed the DC link voltage's circular limit by using a hexagonal limit.,It's a method to extend the output voltage beyond the usual limits by utilizing a hexagonal voltage boundary.,Overmodulation refers to exceeding the DC link voltage's circular limit through hexagonal modulation.,This technique enables higher output voltages by switching to a hexagonal from a circular voltage limit.,A process where output voltage limits are expanded by adopting a hexagonal instead of circular boundary.
3,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",What are the advantages and disadvantages of hexagonal modulation in the MSD ServoDrive?,Advantage: Reduced switching losses. Disadvantage: Higher harmonics and less smooth running at high speeds.,Pros include lower switching losses; cons involve increased current harmonics and reduced smoothness.,Hexagonal modulation cuts switching losses but introduces more harmonics and less smooth operation.,"Benefits are fewer switching losses, while drawbacks are higher harmonics and operational smoothness issues.","While it decreases switching losses, it also leads to more harmonics and less smooth high-speed running."
4,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",How is the controller gain determined in the torque control with defined bandwidth in the MSD ServoDrive?,"Through autotuning by activating test signals, with calculations performed in the servo drive.","Autotuning via test signals determines the gain, with the servo drive handling the calculations.",The gain is set via autotuning processes that involve test signal activation within the drive.,"Determined by autotuning with test signals, where the servo drive computes the necessary adjustments.","Autotuning, involving test signals and internal calculations, establishes the controller gain."
5,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",What is the significance of the 3dB bandwidth in the MSD ServoDrive's torque control?,"It specifies the closed loop's bandwidth, with advisable settings up to 2000 Hz at 8 kHz switching frequency.","The 3dB bandwidth defines the control loop's effective range, recommended up to 2000 Hz for 8 kHz switching.","Signifies the operational bandwidth, with optimal settings reaching 2000 Hz at an 8 kHz switching rate.","Indicates the control loop's bandwidth, ideally set below 2000 Hz when switching at 8 kHz.","Represents the control loop's bandwidth, with maximum effective settings around 2000 Hz for 8 kHz switching."
6,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",What role does enhanced feed forward control play in high-power applications of the MSD ServoDrive?,It aids in achieving high bandwidth control of test signals by supplementing current control limitations.,Enhances performance in high-power scenarios by addressing current control's bandwidth constraints.,"Provides additional control in high-power settings, overcoming current control's bandwidth limits.",Supports high bandwidth requirements in power-intensive applications by augmenting current control.,Facilitates superior control in demanding applications by compensating for current control shortcomings.
7,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",How is the voltage drop across the stator resistance feed forward controlled in the MSD ServoDrive?,It depends on P 470 MOT_Rstat and can be scaled with P 434.4 for enhanced feed forward control.,"Controlled via P 470 MOT_Rstat, with scaling adjustments possible through P 434.4.",The feed forward control is based on MOT_Rstat (P 470) and adjustable with P 434.4.,"Utilizes MOT_Rstat (P 470) for control, with P 434.4 allowing for scaling modifications.","Governed by P 470 MOT_Rstat, with P 434.4 providing scaling options for feed forward control."
8,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",What is the function of the parameter CON_CCON_VFF in the MSD ServoDrive?,It selects the current control or limitation mode for enhanced operational flexibility.,Determines the current control or limitation mode to be used in the system.,Used to choose between different current control or limitation modes available.,Enables selection of the desired current control or limitation mode for the drive.,Facilitates the choice of current control or limitation mode to suit operational needs.
9,msd_servo_drive.txt,50,9c7ce5d24b8a69830448e7206b54e68fea9fcaacef20ce6b16e262e95ef22c4c,":CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 126

# Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

|ID|Index Name|Unit|Description|
|---|---|---|---|
|471|0 MOT_Lsig|mH|Motor leakage inductance (ASM) / stator inductance (PSM)|
|472|MOT_LsigDiff| |q-axis stator inductance variation (relative to MOT_Lsig)|
|472|0 Lsig_q@I0|%|Inductance @ CurrentI0|
|472|1 Lsig_q@I1|%|Inductance @ CurrentI1|
|472|2 Lsig_q@I2|%|Inductance @ CurrentI2|
|472|3 Lsig_q@I3|%|Inductance @ CurrentI3|
|472|4 CurrentI0|%|Current I0 relative to MOT_CNom|
|472|5 CurrentI1|%|Current I1 relative to MOT_CNom|
|472|6 CurrentI2|%|Current I2 relative to MOT_CNom|
|472|7 CurrentI3|%|Current I3 relative to MOT_CNom|

Table 7.6: “Advanced torque control - Saturation characteristic” parameters

# 7.3.6.1.2 K-T characteristic

In the overload range the output-side torque is reduced due to rising losses (iron/copper losses). This behaviour can be compensated by P 479[0] - MOT_TorqueSat.

|P No.|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|479| |MOT_TorqueSat| |Motor torque as a function of the current|
| |0 to 4| |Nm|Torque; interpolation points 0 to 4.|
| |5 to 9| |A|Current; interpolation points 5 to 9.|

Table 7.7: “K-T characteristic” parameters

# 7.3.6.2 Current observer

In the current control circuit, the calculation of voltage setpoints and PWM runtime appears as dead time. This is the main factor determining the possible performance of current control. The current observer eliminates this dead time to the greatest possible extent by predicting current by means of a scanning step. In addition, many synchronous servomotors exhibit harmonic components in the current control circuit. The current observer suppresses these harmonic components so that they cannot.

|ID|Index Name|Unit|Description|
|---|---|---|---|
|433|0 CON_CCON_ObsMode| |Select current observer mode|
|434|CON_CCON_ObsPara| |Current observer parameters|
|434|0 TF|ms|Observer time constant|
|434|1 Kp|1/s|Proportional feedback gain|
|434|2 Tn|ms|Integral feedback time constant|
|434|3 Decoup|%|Scale decoupling|
|434|4 StatFF|%|Scale static voltage feed-forward|
|434|5 DynFF|%|Scale dynamic voltage feed-forward|
|434|6 FilterFF|ms|Filter voltage feed-forward|

Table 7.8: “Advanced torque control - Observer” parameters

# 7.3.6.3 Overmodulation

The ""usqref"" and ""usdref"" components permit so-called overmodulation of the DC link voltage (limitation to hexagon instead of circle). The maximum output voltage which can be set for each phase angle results from the circle which fits in the voltage hexagon (see diagram Section ""“Circle and hexagon voltages” diagram"" on page 128).

By setting the hexagonal modulation to ""HEX_PHASE(3)"" using P 432 - CON_CCON_Mode, the length of the vector for the output voltage can be placed in the range of the DC link voltage (red). As a result only two of the three half-bridges are switched in each switching interval. The third remains at the upper or lower potential of the DC link voltage for a period of 60° of the output frequency.

This method has only two thirds of the switching losses of modulation with all three phases. Disadvantages are higher harmonics of the motor currents and thus less smooth running at high motor speeds.

Image 7.18: “Circle and hexagon voltages” diagram Representation of the eight vectors of the three-phase voltage system (3 half-bridges each with 2 states [23]). The vectors correspond to the DC link voltage UZK and form a voltage hexagon.

UN Mains voltage

UL Voltage at inductor

Uu Inverter voltage

Uzk DC link voltage

α Phase angle

# Legend for “Circle and hexagon voltages” diagram

|ID|Index Name|Unit|Description| | |
|---|---|---|---|---|---|
| |431|0|CON_CCON_VLimit|%|Voltage limit for first current controller|
| |432|0|CON_CCON_Mode| |Select current control / limitation mode|

Table 7.9: “Advanced torque control - Overmodulation” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 128

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 129

# 7.3.7 Torque control with defined bandwidth

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|ENC_OFFSET (1)| |Start encoder offset determination (power stage will be switched on!)| | |
|MOT_ID (2)| |Start electrical motor identification (power stage will be switched on!)| | |
|IMP (3)| |Measure impedance| | |
|LH_TUNE (4)| |Tune Lm characteristics| | |
|ASM_OP (5)| |Set operation point for asynchronous motor| | |
|BANDWIDTH (6)| |Tune current controller by bandwidth| | |
|MOTPHASE (7)| |Check motor/encoder wiring| | |
|COM_ALL (8)| |Motorid., enc.-offset and inertia detection, motor phase check| | |
|J_SUM (9)| |Identification of whole inertia| | |
|CANCEL (10)| |Cancel the current action| | |

The controller gain is determined by activating test signals (Autotuning). The calculations and the relevant autotuning are carried out in the servo drive. The advanced settings are made in P 1530[0] - SCD_SetMotorControl, P 1531[0] - SCD_Action_Sel and P 1533[0] - SCD_AT_Bandwidth.

- The 3dB bandwidth of the closed loop is specified as the bandwidth.
- Advisable bandwidth settings at 8 kHz switching frequency are up to approximately 2000 Hz; at 16 kHz switching frequency up to approximately 3000 Hz.
- The P-gain CCON_Kp is calculated according to the amount optimum.
- The integral-action time CCON_Tn is interpolated between the amount optimum and the symmetrical optimum, so that the I-content is sufficient, resulting in reduced interference response.

|P no.|Index|Name / Setting|Unit|Function|
|---|---|---|---|---|
|1530|0|SCD_SetMotorControl| |Torque controller setting with defined bandwidth|
| |Fault(-1)|Error during calculation| | |
| |Ready(0)|Calculation ready| | |
| |CALC_CON(1)|Control with motor data calculation| | |
| |CALC_ASM(2)|Calculate asm motor from rated data| | |
| |BANDWIDTH(3)|Calculate current controller by bandwidth| | |
| |DEADBEAT(4)|This setting parameterizes a dead-beat controller. The structure is switched to feedback with observer, the observer is designed (to a specific equivalent time constant – for setting see P 434[0] - CON_CCON_ObsPara– and the speed controller gains are calculated accordingly.| | |
| |FAULT (-1)|Selected function stopped with fault| | |
| |READY (0)|Ready to start function / last call successfully ended| | |

# 7.3.8 Enhanced feed forward control of voltage

For high-power applications, the current control setting is often limited. If, at the same time, a high bandwidth is required for the control of test signals, for example, feed-forward voltage control is helpful.

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|434| |CON_CCON_Para| |Current observer parameters|
|434|0|TF|ms|Current observer time constant|
|434|1|Kp|1/s|Current observer feedback gain|
|434|2|Tn|ms|Current observer feedback time constant|

Table 7.11: Parameter - Enhanced feed forward control

# 7 Control

|ID|Index Name|Unit|Description|isdref|Pi-Regler|
|---|---|---|---|---|---|
|434|3|Decoup|%|Scale decoupling|isd|
|434|4|StatFF|%|Scale static voltage feed-forward| |
|434|5|DynFF|%|Scale dynamic voltage feed-forward| |
|434|6|FilterFF|ms|Filter voltage feed-forward|-ω* Lsig*LsigDiff(isq) P 434[3] decoup|
|471|0|MOT_Lsig|mH|Motor leakage inductance (ASM) / stator|P 434[6] FilterFF|
| | | | |inductance (PSM)|Lsig*LsigDiff(isq) d/dt|
|472| |MOT_LsigDiff| |q-axis stator inductance variation (relative to|MOT_Lsig)|
|472|0|Lsig_q@I0|%|Inductance @ CurrentI0|Error-Voltage-Model|
|472|1|Lsig_q@I1|%|Inductance @ CurrentI1|ω* Lsig*LsigDiff(isq) + ω*Ψ|
|472|2|Lsig_q@I2|%|Inductance @ CurrentI2| |
|472|3|Lsig_q@I3|%|Inductance @ CurrentI3|P 434[3] decoup P 434[4] StatFF P 434[5] DynFF|
|472|4|CurrentI0|%|Current I0 relative to MOT_CNom|isqref|
|472|5|CurrentI1|%|Current I1 relative to MOT_CNom| |
|472|6|CurrentI2|%|Current I2 relative to MOT_CNom|isq|
|472|7|CurrentI3|%|Current I3 relative to MOT_CNom| |
|1976|0|CON_CCON_VFF| |Select current control / limitation mode| |

Table 7.11: Parameter - Enhanced feed forward control (continue)

Image 7.19: Extended pre-control structure shows the extended pre-control structure. This is activated with P 1976 = ON. This delays the current setpoint by one controller cycle; this is not suitable for high-performance speed control.

The feed forward control of the voltage drop across the stator resistance of the machine depends on P 470 MOT_Rstat. The feed forward control of the fault voltage of the power stage depends on P 302 CON_SwitchFreq. Both can be subjected to feed forward control and scaled with P 434.4.

The voltage to change the current over the stator inductance depends on P 471 MOT_Lsig. The feed forward control can be scaled with P 434.5.

P 434.6 enables filtering of the voltage thus set, which reduces noise. Do not set this filter too high, otherwise there will no longer be an increase in bandwidth.

MOOG                          ID No.:CB40859-001 Date:11/2020

MSD ServoDrive   - DeviceHelp     130

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 131

To set these functions, use the test signal generator (not yet described - to do) to apply a sweep signal to the d-current setpoint and record the setpoint and actual values with the scope.

# 7.4 Speed controller

1. ",How does the extended pre-control structure in the MSD ServoDrive affect current setpoint?,"It delays the current setpoint by one controller cycle, which may not suit high-performance speed control.","The structure introduces a one-cycle delay to the current setpoint, potentially limiting speed control performance.","By delaying the current setpoint one cycle, it could hinder high-speed control applications.","A one controller cycle delay on the current setpoint is added, affecting high-performance speed control.","Results in a single cycle delay for the current setpoint, making it less ideal for demanding speed control tasks."
