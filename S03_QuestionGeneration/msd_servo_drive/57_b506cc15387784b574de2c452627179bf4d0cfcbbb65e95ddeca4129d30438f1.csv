,NODE_FILE_NAME,NODE_NUMBER,NODE_HASH,NODE_TEXT,Q,A1,A2,A3,A4,A5
0,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",What is the purpose of the rate limiter in the process controller as described in the 'MSD ServoDrive - DeviceHelp'?,The rate limiter limits the changes to the control variable per sampling segment to ensure smooth operation.,"It parameterizes the limitation of the control variable steepness per millisecond, enhancing control precision.","By limiting the control variable change each time interval, it prevents abrupt speed changes on the motor shaft.","The rate limiter ensures that the process controller's output does not cause excessive speed variations, maintaining system stability.","Its main function is to restrict the rate at which the control variable can change, thereby protecting the system from rapid fluctuations."
1,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",How can the conversion from user units to user-specific units be tracked according to the 'MSD ServoDrive - DeviceHelp'?,"Tracking depends on whether the user units are set up as per CiA 402, SERCOS, or with a user-specific format.","The method used for setup can be viewed via P 283[0] - MPRO_FG_Type, indicating the conversion tracking possibility.",Conversion tracking is feasible if the user units adhere to standardized formats like CiA 402 or SERCOS.,It's possible to monitor the conversion when user units are configured according to specific industry standards or custom formats.,"The ability to track conversions is determined by the setup method of user units, as detailed in the device documentation."
2,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",What parameters are involved in the process controller's rate limiting function in the 'MSD ServoDrive - DeviceHelp'?,P 2680[0] - CON_PRC_Rate Limiter parameterizes the limitation of the control variable steepness per millisecond.,The rate limiter's functionality is adjusted through specific parameters that define its operational limits.,Key parameters include those that set the maximum allowable change rate of the control variable to ensure system stability.,Parameters such as P 2680[0] allow for the customization of the rate limiter's impact on the control variable.,The device's documentation lists parameters that configure how aggressively the rate limiter restricts control variable changes.
3,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",How is the I-component reduction activated in the process controller according to the 'MSD ServoDrive - DeviceHelp'?,"By way of index (1), reduction of the I-component is activated in the process controller.","Activation occurs through specific indexing within the controller's parameters, enabling I-component adjustment.",The process controller allows for I-component reduction via indexed parameters to fine-tune system response.,"Index (1) serves as the trigger for I-component reduction, optimizing the controller's integral action.",Documentation specifies that selecting index (1) within relevant parameters initiates I-component reduction for improved control.
4,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",What is the significance of P 270[0] - MPRO_FG_PosNorm in the 'MSD ServoDrive - DeviceHelp'?,"It indicates how many increments correspond to one motor revolution, crucial for position reference calculations.","This parameter defines the positional normalization factor, linking increments to motor revolutions.",Understanding P 270[0] is essential for converting between increments and revolutions in motion control.,"It serves as a conversion factor, enabling precise control over motor position based on increment counts.",The parameter's value is key to accurately translating motor movements into positional increments and vice versa.
5,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",How does the 'MSD ServoDrive - DeviceHelp' describe the calculation for converting rpm to Inc/ms?,The conversion involves multiplying the rpm by the position normalization factor and then by 1/60000 to account for time units.,"It's calculated as rpm * P 270[0] [Inc/rev] * 1/60 [min/s] * 1/1000 [s/ms], translating speed to positional change rate.",This formula ensures that speed changes are accurately reflected in terms of increments per millisecond.,The conversion process accounts for both the motor's positional resolution and the desired time frame.,"Detailed in the documentation, this calculation bridges motor speed and positional increments over milliseconds."
6,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",What role does the P2t shutdown function play in pump protection according to the 'MSD ServoDrive - DeviceHelp'?,It protects the pump against continuous operation with built-up pressure and low speeds by monitoring critical limits.,The function calculates a critical limit integral to prevent overheating or damage under adverse conditions.,"By evaluating speed and pressure, it ensures the pump operates within safe thermal and mechanical boundaries.",This protective measure triggers alerts or shutdowns when operational parameters exceed safe thresholds.,"It's a safeguard that dynamically adjusts to pump conditions, preventing long-term damage from improper use."
7,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",How is the gear ratio between pump and pump motor configured in the 'MSD ServoDrive - DeviceHelp'?,"The gear ratio is entered in P 2851[9] - HYD_Pump, allowing for precise mechanical linkage adjustment.","Configuration involves specifying the ratio directly in the designated parameter, ensuring accurate speed translation.","For direction correction, a factor of '-1' can be used, aligning motor and pump rotation directions.",This parameter enables the customization of the drive system's mechanical advantage between components.,"Documentation outlines how to input the gear ratio, including options for reversing rotation direction if needed."
8,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",What are the key parameters for hydraulic signal scaling in the 'MSD ServoDrive - DeviceHelp'?,"Parameters like P 2846 and P 2847 define scaling, offset, and limits for pressure, flow rate, and speed signals.",Critical settings include scaling factors and offsets for accurate signal interpretation and control.,The documentation details parameters that adjust signal ranges to match operational requirements.,Signal scaling ensures that inputs and outputs are correctly proportioned for system compatibility.,Adjustable parameters allow for the fine-tuning of hydraulic system responses to meet specific application needs.
9,msd_servo_drive.txt,57,b506cc15387784b574de2c452627179bf4d0cfcbbb65e95ddeca4129d30438f1,"These user units can be found under “Motion Profile --> Standardization/Units” in the operating tool. It may be possible to track the conversion between user units and user-specific units depending on whether the user units have been set up as per CiA 402, SERCOS, or with a user-specific format. P 283[0] - MPRO_FG_Type can be used to view which setup method was used.

# 7.10.3 Rate Limiter

Downstream of the control variable limiter there is another limitation which limits the changes to the control variable per sampling segment. By P 2680[0] - CON_PRC_Rate Limiter the limitation of the control variable steepness per millisecond can be parameterized. By way of index (0) the limitation is active in standard process.

# 7.10.4 Parameters

By way of index (1) reduction of the I-component is activated (see table). With P 2672[0] - CON_PRC_OUTSEL = 3 the process controller delivers an additive position reference value. The rate limiter limits the possible control variable change. The control variable change each time interval by the process controller results in a speed change on the motor shaft.

# Example

The amount of the process controller to change the speed on the motor shaft should not be higher than 100 revolutions per minute. To achieve this, the value of parameter P 2680[0] - CON_PRC_RateLimiter must be parameterized with a value corresponding to the user unit. The unit of this parameter is [x/ms]. The x stands for the respective unit of the process controller output variable. In this example the control variable (additive position reference) has the unit ""Increments"" (see also P 270[0] - MPRO_FG_PosNorm). This parameter indicates how many increments correspond to one motor revolution.

# Conversion from [rpm] to [Inc/ms]

nchange
100 rpm

# P 270[0] - MPRO_FG_PosNorm in Inc/rev

Internal position resolution = 1048576 inc/rev (default)

To reduce the I-component, the same method is applicable P 2680[1] - CON_PRC_Rate Limiter [Inc/ms]).

# P 2680[0] - CON_PRC_Rate Limiter = n change*1048576 *1/60000

P 2680[0] [Inc/ms]
100 [rpm] * P 270[0] [Inc/rev] * 1/60 [min/s*] * 1/1000 [s/ms]

# Table 7.48: “Process controller” parameters

| |ID|Index Name|Unit|Description|
|---|---|---|---|---|
| |2659|0|CON_PRC_Kp|Process controller: gain|
|2660|0|CON_PRC_KP_SCALE|%|Process controller: gain scaling|
|2661|0|CON_PRC_Tn|ms|Process controller: integral action time|
|2662|0|CON_PRC_REFOFFSET| |Offset of the technological controller output|
|2663|0|CON_PRC_LIMPOS| |Positive limitation of the actuator variables|
|2664|0|CON_PRC_LIMNEG| |Negative limitation of the actuator variables|
|2665|0|CON_PRC_CDIFF_SIGN| |Process controller: sign modification|
|2666|0|CON_PRC_REFVAL| |Process controller: setpoint|
|2667|0|CON_PRC_REFSCALE| |Scaling factor for setpoint|
|2668|0|CON_PRC_ACTSEL| |Process controller: selection of the actual value|
|2669|0|CON_PRC_ACTOFFSET| |Input calibration: offset|
|2670|0|CON_PRC_ACTTF|ms|Process controller: Time constant for filtering|
|2671|0|CON_PRC_ACTSCALE| |Scaling of the filtered input signal|
|2672|0|CON_PRC_OUTSEL| |Process controller: Selection of the output variable|
|2673|0|CON_PRC_RAW_ACTVAL| |Actual value of the input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2675|0|CON_PRC_CDIFF| |Process controller: control deviation|
|2676|0|CON_PRC_OUTVAL| |Process controller: output value|
|2677|0|CON_PRC_ACTVAL_FIELDBUS| |Current fieldbus value|
|2678|0|CON_PRC_OUTSEL_MOPRO| |Process controller: output value for motion profile|
|2679|0|CON_PRC_RefReached|USER|“Reference value reached” window|
|2680|0|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting|
|2680|1|CON_PRC_RateLimiter|x/ms|Process controller: rate limiting, reset I-component|

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 172

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# 7.11 Hydraulic control

|ID|Index|Name|Unit|Description|
|---|---|---|---|---|
|2681|0|CON_PRC_CtrlWord| |Process controller: control word|
|2682|0|CON_PRC_StatWord| |Process controller: status word|
|2683|0|CON_PRC_REFSEL| |Process controller: selection of the reference value|
|2684|0|CON_PRC_REFVAL_User| |Process controller: reference value from user|

Firmware with a version range of V174.xx-xx includes special hydraulic parameters in addition to the standard firmware. These can be used to control pressure, volumetric flow rate, cylinder speed, and cylinder position, making it easy to implement hydraulic system applications. The firmware is available for MSD Servo Drive, MSD Single-Axis Servo Drive Compact and MSD Servo Drive Functional Safety.

# 7.10.5 Scope signals

|ID|Index|Parameter name|Unit|Function|
|---|---|---|---|---|
|2675|0|CON_PRC_Cdiff_| |Technological controller: control deviation|
|2666|0|CON_PRC_RefVal| |Technological controller: setpoint|
|2673|0|CON_PRC_Raw_ActVal| |Actual value of input signal|
|2674|0|CON_PRC_ACTVAL| |Input signal after scaling and filtering|
|2676|0|CCON_PRC_Outval| |Technological controller: output value|

Table 7.49: Parameters relevant for visualizing the process control circuit in the scope

Image 7.49: “Hydraulic basic settings” screen

# 7.11.2 Pump setting

In the “Hydraulic basic settings” screen, under the “Basic settings” button, set selector P 165[0] - MPRO_REF_SEL for the reference setpoint to ""HYDRAULIC(12) = Hydraulic application"".

Image 7.50: “Hydraulic basic settings – Basic settings” screen

# Possible encoder selections

- P 520[0] - ENC_MCon: Encoder for commutation and torque control
- P 521[0] - ENC_SCon: Encoder for motor and pump speed control
- P 522[0] - ENC_PCon: Encoder for cylinder position and cylinder speed control

|ID|Index|Value|Name|Description|
|---|---|---|---|---|
|165|0| |MPRO_REF_SEL|Motion profile: Selection|
| | |12|HYDRAULIC|(HYD) = Hydraulic profile (software specific)|
|300|0| |CON_CgfCon|Select control mode|
| | |1|TCON|Torque control / Hydraulic control|
|520|0| |ENC_MCon|Channel selection for motor commutation|
|521|0| |ENC_SCon|Channel selection for speed control|
|522|0| |ENC_PCon|Channel selection for position control|

# Physical variables

- Q: Volumetric flow rate
- p: differential pressure
- n: Speed
- M: Torque

Image 7.51: “Hydraulic - Pump” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

# MSD ServoDrive - DeviceHelp

# Pump characteristics and data

If you specify eta_(Vol,N), the servo drive will internally calculate k_L automatically as follows:

- V_g: Geometric displacement volume (P 2851[0] (ccm/rev))
- eta_Vol,N: Volumetric efficiency at the pump’s rating point (P 2851[4] (%))
- k_L = V_g ∙ n_N ∙ (1 - eta_(Vol,N) ) ∙ p_N

Theoretical volumetric flow rate Q_th is proportional to the speed:

- Q_th = V_g ∙ n

Internal pump leakage volumetric flow rate Q_L must be subtracted from the actual volumetric flow rate:

- Q = Q_th - Q_L = V_g ∙ n - Q_L

It will typically be proportional to the pressure:

- Q_L = p ∙ k_L(ϑ)

However, pump data sheets often do not specify the leakage volume rate constant, but instead specify a “volumetric efficiency” ηvol,N for the pump’s rated point, in which case:

- Q_N = V_g ∙ n_N ∙ η_(vol,N)
- Q_N [l/min] = V_g [cm³/rev] ∙ n_N [rev/min] ∙ eta_(Vol,N) [100 %]

For the torque at the pump (= motor torque):

- M = V_g / 2π ∙ p + (M_friction); (make sure to use SI units)

NOTE

- Make sure to convert to SI units!

The friction torque is normally unknown and negligible (M_friction ~ 0). This means that a “torque constant” c_M in [Nm/bar] can be calculated using the following formula:

- c_M [Nm/bar] = 1/(20pi) * V_g [cm^3/rev] = M [Nm] / p [bar]

# Example

- eta_(Vol,N) = 95 %, n_N = 1500 rev/min, v_G = 10 cm³/rev -> Q_N = 14,2 l/min

Displacement volume V_g is usually specified in data sheets. In contrast, if there is a pressure measurement available, the torque constant is easier to determine experimentally if necessary. In this case, a constant pressure can be built up on the drive in a steady state and the delivered motor torque can be used to calculate the displacement volume.

Example                                                                                  Example

Running the pump, e.g. at a low speed “against” the built-up pressure. Scope plot (Moog DRIVEADMINISTRATOR 5) for Scope ID 11 – m_act yields a mean value of M = 15.9 [Nm]. The built-up pressure at the pressure sensor is p = 100 [bar] => c_M = 0.159 [Nm/bar] => V_g = 10 [ccm/rev]

Accordingly, both parameters (P 2851[0; 1] - HYD_Pump) can be set. However, only one of the two values should be set. The other one will be automatically calculated afterwards and will be shown accordingly.

P 2851[2] - HYD_Pump is used to set the nominal pressure. P 2851[3] - HYD_Pump specifies the volumetric efficiency at this rating point. This information will then be used to calculate the leakage volumetric flow rate, which is used internally to control the volumetric flow rate.

For pumps with variable-displacement volume, a second pump data set can be created P 2873 HYD_Pump2. This can be selected via P 2863 HYD_TabCtrl bit 8 for the respective motion block (7.11.6 Hydraulic Motion profile). Alternatively, the displacement volume can also be adjusted online via a pump scaling using P 2879 [2] Pump1_DisplScalePDO and P 2879[3] Pump2_DisplScalePDO. This allows the displacement volume to be changed variably during the process.

# 7.11.2.1 Speed limits

The pump’s minimum and maximum speeds can be set in P 2851[4; 5] - HYD_Pump. The control system will not exceed or fall below the values set there.

MOOG                       ID No.:CB40859-001 Date:11/2020                                                                            MSD ServoDrive  - DeviceHelp   176

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020 MSD ServoDrive - DeviceHelp 177

# 7.11.2.2 Pump protection functions

Meanwhile, the speed is taken into account linearly, i.e. at half the speed, half the duration will be tolerated.

# 7.11.2.2.1 P2t shutdown

Reason: The speed / the volumetric flow rate proportional to the speed results in a proportional heat removal.

Usually, the pump needs to be protected against continuous operation with built-up pressure and low speeds. To this end, a critical minimum speed n_crit can be specified so that, at nominal pressure p_N, it will only be allowed to fall below this speed for a critical duration of t_crit. The following critical limit integral is calculated continuously in the servo drive for this purpose:

l i_G = 1 / τ_crit ∙ ∫ ((p/p_N)² - n / n_crit) dt

This takes into account the power loss that has an approximately quadratic relationship to the pressure, as well as the heat removal that is proportional to the speed. If the nominal pressure were requested in a stopped state (n = 0), for example, i_G would increase to a value of 1.0 before t_crit would elapse. At half the critical speed, twice that time would be required. Meanwhile, a different pressure would have a quadratic effect, meaning that half the nominal pressure would be allowed to be present four times the critical duration time.

This function can be used to open a bypass circuit when a configurable limit (i_G = 0.9) is reached. Normally, this will result in the pump speed increasing and, after a certain hysteresis (i_G = 0.8) is fallen below, the bypass will be closed again in order to reduce the power loss. If i_G increases all the way to 1.0 instead, an error will be triggered and the drive will be stopped in order to protect the pump.

At the nominal pressure, the critical speed should not be fallen below for a time longer than the critical duration. The square of the pressure is included in the calculation here, i.e. at half the pressure, four times the duration will be tolerated.

Reason: Leakage losses have an approximately quadratic relationship to the pressure.

# Example

Critical speed: 500 bar, Nominal pressure: 100 bar, Critical time: 10 s.

- This pump can be run at 500 rpm, 100 bar as long as necessary.
- At very low speeds close to a full stop, and with a pressure of 100 bar, it would only be permissible to run the pump for 10 s. After 9 s, the bypass valve (if any) would be opened. If this did not result in the speed increasing,

an error would be triggered one second later and, normally, the drive would be stopped.

If continuous pressure is permissible even at full stop, the corresponding pressure can be entered in P 2851[10] - HYD_Pump.

# 7.11.2.2.2 Pressure-dependent speed regulation characteristic

The speed (P 2851.5 nMin and P 2851.6 nMax) from the pump configuration are used for nMin and nMax. Thus, a negative pump speed is permitted as of the set minimum pressure for high pressures. The entire speed range can be utilized above the specified maximum pressure. In the transition range from minimum to maximum pressure, the speed curve is linear. The speed characteristic of the pump then behaves as follows:

P 2851.6 nMax
P 2851.14 pMin
P 2851.15 pMax
p

For some types of pumps (e.g. internal-gear pumps), negative speeds for very low pressures (0 bar) are not permitted because in these operating areas, the lubrication of the pump gear can no longer be ensured. This is why it is possible to configure the pump characteristic curve in dependence on pressure, which makes it possible to protect the pump from mechanical destruction (P 2840.14 PumpSpdProt = 1). It is nonetheless still possible to quickly relieve a high pressure through a negative pump speed. Using P 2851[14,15]-HYD_Pump, it is possible to configure a minimum and maximum pressure for negative speeds.

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 178

# 7 Control

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

179

# 7.11.2.3 Gear ratio between pump and pump motor

If there is gearing between the pump and the pump motor, the gear ratio needs to be entered in P 2851[9] - HYD_Pump. If only the direction of rotation needs to be changed (motor turns in a negative direction when the pump turns in the positive, ""correct"" direction), a factor of ""-1"" can be entered to correct the direction of rotation.

# 7.11.2.3.1 Parameters

|ID|Index Name|Unit|Description|
|---|---|---|---|
|2851|HYD_Pump|Pump parameters| |
|2851|0|displ|ccm/rev Offset|
|2851|1|cTorque|Nm/bar Torque constant|
|2851|2|pNom|bar Nominal pressure|
|2851|3|nNom|rpm Rated speed|
|2851|4|etaVol|% Volumetric efficiency at nominal pressure, rated speed|
|2851|5|nMin|rpm Minimum speed|
|2851|6|nMax|rpm Maximum speed|
|2851|7|nCritical|rpm Critical speed (@ nominal pressure)|
|2851|8|TCritical|s Max. permissible time at low speed and nominal pressure|
|2851|9|iGearPump|Gear ratio between pump and motor|
|2851|10|p0|bar Max. permissible stationary pressure at a standstill|
|2851|11|cLeakage|(l/min)/bar Leakage constant|
|2851|12|stopramp|(1/min)/s Stop ramp (during valve switching etc.)|
|2851|13|tSwValve|ms Valve switching time|
|2851|14|pMin|bar Minimum pressure (depending on pump protection function)|
|2851|15|pMax|bar Maximum pressure (depending on pump protection function)|

Table 7.51: “Hydraulic - Pump” parameters

# Hydraulic signal settings, analog inputs

- Pressure reference value (pRefSrc)
- Volumetric flow rate reference value (QRefSrc)
- Pressure actual value (pActCalc)
- Pressure limitation (Minimum/maximum values) (pMinSrc/pMaxSrc)
- Volumetric flow rate limitation (minimum/maximum values) (QMinSrc/QMaxSrc)
- Volumetric flow actual value (QActCalc)
- Leakage volumetric flow rate (QLeakEst)
- Speed reference value (nRefSrc)
- Hydraulic cylinder valve control (CylValveSwSel)

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|2840|HYD_Cfg| |Configure Hydraulic System Control|
|2840|0|Reserved|Reserved|
|2840|1|pRefSrc|Hydraulics: Selection of pressure reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|2|QRefSrc|Flow rate, selection of reference source|
| | |0: ANA|Setpoint of analog input|
| | |1: PROFILE|Setpoint from profile|
|2840|3|pActCalc|Hydraulic: Pressure actual value calculation method|
| | |0: PACT|pAct will be used for control|
| | |1: PACT2|pAct2 will be used for control|
| | |2: DIFF_PACT_PACT2|pAct-pAct2 will be used for control|
| | |3: PRIO|Both values will be used with Current Priority|
| | |4: PMOTT|Calculation from motor torque|
| | |5: PACTSEL|Selection between pAct and pAct2 per parameter|
|2840|4|pMinSrc|Minimum pressure source selector|
| | |0: PressCon|Min. pressure value from HYD_PressCon_pMin|
| | |1: Neg_pRef|Min. pressure, negative value from HYD_Val_pRef|
| | |2: Pos_pRef|Min. pressure value from HYD_Val_pRef|
|2840|5|pMaxSrc|Maximum pressure source selector|

The signal sources for the reference values, actual values, and signal limits are selected with P 2840 - HYD_Cfg. A variety of signal sources can be set for the following variables:

Table 7.52: “Selection of signal sources” parameters

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 180

# 7 Control

# MOOG

ID No.: CB40859-001 Date: 11/2020

# MSD ServoDrive - DeviceHelp

181

# 7.11.3.2 Signal scaling

|ID|Index Name / Setting|Unit|Description|
|---|---|---|---|
|0|PressCon| |Max. pressure value from HYD_PressCon_pMax|
|1|Pos_pRef| |Max. pressure value from HYD_Val_pRef|
|2|Neg_pRef| |Max. negative pressure value from HYD_Val_pRef|
|2840|6 QMinSrc| |Minimum flow rate source selector|
|0|PressCon| |Min. pressure value from HYD_PressCon_QMin|
|1|Neg_QRef| |Min. pressure, negative value from HYD_Val_QRef|
|2|Pos_QRef| |Min. pressure value from HYD_Val_QRef|
|2840|7 QMaxSrc| |Maximum flow rate source selector|
|0|PressCon| |Max. volume flow value from HYD_PressCon_QMax|
|1|Pos_QRef| |Max. volume flow value from HYD_Val_QRef|
|2|Neg_QRef| |Max. negative volume flow value from HYD_Val_QRef|
|2840|8 QActCalc| |Flow rate calculation method|
|0|MEAS| |From the measurement|
|1|CYL| |From the cylinder speed|
|2840|9 QLeakEst| |Flow rate leakage estimation method|
|0|NONE| |No leakage compensation|
|1|OBS| |Observer|
|2|MEAS| |Directly measured|
|3|CTRL| |PI controller|
|2840|10 nRefSrc| |Pump speed reference source selector|
|0|ANA| |Setpoint from profile|
|1|PROFILE| |Reference value from profile|
|2840|11 CylValveSwSel| |Function selector for the valve switchover of the cylinder|
|0|Para| |Manual valve control|
|1|Spd| |Automatic valve switchover via speed setpoint|
|2|Tab| |Valve switchover via motion block table|
|3|Pos| |Automatic valve switching via Pos. Diff.|
|2840|12 AltPosCon| |Alternative position controller|
|2840|13 AltSpdCon| |Alternative cylinder speed controllers|
|2840|14 PumpSpdProt| |Pump speed protection|
|2840|15 PumpP2tProt| |p2t protection for pump|
|2840|16 AltPressCon| |Alternative pressure controller|
|2840|17 AltPressConLimit| |Alternative pressure limit controller|

Table 7.52: “Selection of signal sources” parameters (continue)

There are two scaling paths available for the actual pressure, actual pressure 1 (pact1) and actual pressure 2 (pact2). This allows two sensor signals to be processed. A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference pressure (pref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.2 Signal scaling, volumetric flow rate

A scaling path is available for the actual volumetric flow rate (QAct). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference volumetric flow rate (Qref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

# 7.11.3.2.3 Signal scaling, pump speed

P 2845 - HYD_Input_Val displays the unscaled pump speed reference value of the pump speed control.

Further processing and scaling is carried out in P 2846 - HYD_Input_Adapt. A scaling factor, an offset, and a signal limit (nRef_Min and nRef_Max) can be set.

The actual speed is evaluated via the respective encoder input (see Section ""Encoder selection"" on page 53). A selection between an analog input or the hydraulic motion profile as the signal source can be made for the reference speed (nref).

The result after the scaling will be shown in P 2847 - HYD_Val. These values will also be used for control purposes.

Image 7.58: “Hydraulic signal scaling, volumetric flow rate” screen

Image 7.59: “Hydraulic signal scaling, pump speed” screen

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 182

# 7 Control

MOOG ID No.:CB40859-001 Date:11/2020

MSD ServoDrive - DeviceHelp 183

The individual parameters for configuring the signals are shown in the following table.

| | | | |ID|Index Name|Unit|Description| |
|---|---|---|---|---|---|---|---|---|
| | | | |2846|21|nRef_Offset|1/min|Offset|
| | | | |2846|22|nRef_Min|1/min|Min|
| | | | |2846|23|nRef_Max|1/min|Max|
|2845| |HYD_Input_Val| |Input values for hydraulics system| | | | |
|2845| | | | |0|pAct|bar|Hydraulics: Pressure actual value|
|2845|1|pAct2| | | |bar|Hydraulics: Pressure actual value (sensor2)| |
|2845|2| | | | |pRef|bar|Hydraulics: Pressure setpoint|
|2845| | | | |3|QRef|l/min|Flow rate, setpoint|
|2845|4|QAct|l/min|Flow rate, actual value| | | | |
|2845|5|nRef|1/min|Pump set speed| | | | |
| | | | |2847| |HYD_Val| |Hydraulics: Setpoints and actual values|
| | | | |2847|0|pAct|bar|Hydraulics: Pressure actual value|
| | | | |2847|1|pAct2|bar|Hydraulics: Pressure actual value (sensor2)|
| | | | |2847|2|pRef|bar|Hydraulics: Pressure setpoint|
| | | | |2847|3|QRef|l/min|Flow rate, setpoint|
| | | | |2847|4|QAct|l/min|Flow rate, actual value|
| | | | |2847|5|nRef|1/min|Pump set speed|

| | | | |ID|Index Name|Unit|Description|
|---|---|---|---|---|---|---|---|
|2846|0|pAct_Scale|bar|Scaling| | | |
|2846|1|pAct_Offset|bar|Offset| | | |
|2846|2|pAct_Min|bar|Min| | | |
|2846|3|pAct_Max|bar|Max| | | |
|2846|4|pAct2_Scale|bar|Scaling| | | |
|2846|5|pAct2_Offset|bar|Offset| | | |
|2846|6|pAct2_Min|bar|Min| | | |
|2846|7|pAct2_Max|bar|Max| | | |
|2846|8|pRef_Scale|bar|Scaling| | | |
|2846|9|pRef_Offset|bar|Offset| | | |
|2846|10|pRef_Min|bar|Min| | | |
|2846|11|pRef_Max|bar|Max| | | |
|2846|12|QRef_Scale|l/min|Scaling| | | |
|2846|13|QRef_Offset|l/min|Offset| | | |
|2846|14|QRef_Min|l/min|Min| | | |
|2846|15|QRef_Max|l/min|Max| | | |
|2846|16|QAct_Scale|l/min|Scaling| | | |
|2846|17|QAct_Offset|l/min|Offset| | | |
|2846|18|QAct_Min|l/min|Min| | | |
|2846|19|QAct_Max|l/min|Max| | | |
|2846|20|nRef_Scale|1/min|Scaling| | | |

Table 7.53: “Signal scaling” parameters

# 7.11.3.3 Example of application for volume/mass sensors

""negative"" pressures can also be present in an application with pressure difference measurement, a negative value must also be entered or permitted in the HYD_PressCon.pMin parameter. If these pressure limits are reached, the pump speed is limited accordingly dynamically. In addition, the source of the limiting pressure value can be selected using P 2840[5] - pMaxSrc and P 2840[6] - pMinSrc.

It is possible to toggle between parameter P 2850[6] - pMax and the reference value P 2843[0] - pRef by selecting PressCon(0), Pos_pRef(1) and Neg_pRef(2). This allows the pressure limitation to be specified via the analog input of the pressure reference value, for example.

The pressure limitation control uses the same controller parameters P 2850[0] Kp and P 2850[2] Tn as the standard pressure control. However, the control structure differs from the standard pressure controller. The pressure limiting controller tends to oscillate when the control is set very dynamically. Consequently, we recommend choosing a setting with low gain factors and then increasing it according to the requirements. In addition, the setting of the integral-action time (the integral part) is absolutely necessary for the function of the limiting controller. Our recommendation is values in the high two-digit or lower three-digit range. ",How does the 'MSD ServoDrive - DeviceHelp' recommend setting up the pump's minimum and maximum speeds?,"Speeds are configured in P 2851[4; 5] - HYD_Pump, defining operational bounds to protect the pump.",The setup involves specifying minimum and maximum values to ensure the pump operates within safe limits.,"By adjusting these parameters, users can prevent the pump from exceeding or falling below critical speeds.",Documentation guides the entry of speed thresholds to safeguard pump integrity during operation.,These settings are crucial for maintaining pump performance and longevity by adhering to manufacturer-recommended speeds.
